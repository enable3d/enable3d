{"version":3,"sources":["webpack://ENABLE3D/webpack/universalModuleDefinition","webpack://ENABLE3D/webpack/bootstrap","webpack://ENABLE3D/external \"THREE\"","webpack://ENABLE3D/../common/dist/logger.js","webpack://ENABLE3D/./node_modules/eventemitter3/index.js","webpack://ENABLE3D/../common/dist/applyMixins.js","webpack://ENABLE3D/../common/dist/extendedObject3D.js","webpack://ENABLE3D/../common/dist/defaultMaterial.js","webpack://ENABLE3D/../common/dist/extendedMesh.js","webpack://ENABLE3D/../common/dist/physicsLoader.js","webpack://ENABLE3D/../common/dist/types.js","webpack://ENABLE3D/../common/dist/serverClock.js","webpack://ENABLE3D/(webpack)/buildin/global.js","webpack://ENABLE3D/../common/dist/physicsBody.js","webpack://ENABLE3D/../common/dist/factories.js","webpack://ENABLE3D//home/yannick/enable3d/node_modules/eventemitter3/index.js","webpack://ENABLE3D/../common/dist/wasmLoader.js","webpack://ENABLE3D//home/yannick/enable3d/node_modules/timers-browserify/main.js","webpack://ENABLE3D//home/yannick/enable3d/node_modules/setimmediate/setImmediate.js","webpack://ENABLE3D//home/yannick/enable3d/node_modules/process/browser.js","webpack://ENABLE3D/./src/convexObjectBreaker.ts","webpack://ENABLE3D/./src/shapes.ts","webpack://ENABLE3D/./src/constraints.ts","webpack://ENABLE3D/./src/events.ts","webpack://ENABLE3D/./src/debugDrawer.ts","webpack://ENABLE3D/./src/physics.ts","webpack://ENABLE3D/./src/three-to-ammo.js","webpack://ENABLE3D/./src/torusShape.ts","webpack://ENABLE3D/./src/raycaster/closestRayResultCallback.ts","webpack://ENABLE3D/./src/raycaster/allHitsRayResultCallback.ts","webpack://ENABLE3D/./src/raycaster/raycaster.ts","webpack://ENABLE3D/./src/lib/Clock.ts","webpack://ENABLE3D/./src/index.ts","webpack://ENABLE3D/./src/bundle.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","default","msg","console","error","has","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","__proto__","eventNames","events","names","slice","getOwnPropertySymbols","concat","listeners","handlers","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","derivedCtor","baseCtors","forEach","baseCtor","getOwnPropertyNames","getOwnPropertyDescriptor","extendStatics","__extends","b","setPrototypeOf","__","constructor","__importDefault","mod","index_1","logger_1","ExtendedObject3D","_super","_this","vector3","Vector3","hasBody","anims","currentAnimation","id","theta","worldTheta","phi","worldPhi","configurable","getWorldDirection","Math","atan2","x","z","acos","y","setAction","_a","mixer","action","clipAction","time","stopAllAction","fadeIn","play","Object3D","DefaultMaterial","_defaultMaterial","MeshLambertMaterial","color","ExtendedMesh","geometry","material","Mesh","wasmLoader_1","PhysicsLoader","path","callback","__loadPhysics","Ammo","then","extendedObject3D_1","extendedMesh_1","AnimationMixer","AnimationClip","AnimationAction","Material","Line","Points","Group","ServerClock","fps","autoStart","tickLengthMs","previousTick","Date","now","actualTicks","_delta","_isRunning","_highAccuracy","start","disableHighAccuracy","startTime","loop","stop","isRunning","getDelta","getElapsedTime","onTick","onTickCallback","_onTickCallback","setTimeout","setImmediate","enableHighAccuracy","g","Function","e","eventemitter3_1","PhysicsBody","physics","ammo","offset","errors","checkCollisions","breakable","collided","didUpdate","_emitUpdateEvents","_needUpdate","tmpEuler","Euler","tmpQuaternion","Quaternion","tmpBtVector3","btVector3","tmpBtQuaternion","btQuaternion","setupEventEmitter","eventEmitter","set","need","onUpdateEvent","updateCallback","update","collision","collisionCallback","onCollision","data","bodies","transform","tmpTrans","getMotionState","getWorldTransform","refresh","setWorldTransform","setRotation","q","setFromEuler","setValue","ammoQuat","w","getRotation","qx","qy","qz","qw","angle","sqrt","setPosition","getOrigin","getLinearVelocity","getAngularVelocity","setVelocity","setLinearVelocity","setVelocityX","velocity","setVelocityY","setVelocityZ","setAngularVelocity","setAngularVelocityX","angularVelocity","setAngularVelocityY","setAngularVelocityZ","applyForce","applyCentralImpulse","applyForceX","applyForceY","applyForceZ","setCollisionFlags","getCollisionFlags","setRestitution","setBounciness","setFriction","setGravity","setLinearFactor","setAngularFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","__assign","assign","__rest","indexOf","propertyIsEnumerable","defaultMaterial_1","Factories","scene","isHeadless","defaultMaterial","plane","planeConfig","materialConfig","makePlane","box","boxConfig","makeBox","sphere","sphereConfig","makeSphere","cylinder","cylinderConfig","makeCylinder","cone","coneConfig","makeCone","torus","torusConfig","makeTorus","extrude","extrudeConfig","makeExtrude","mesh","addMesh","existing","addExisting","addPlane","addBox","ground","groundConfig","addGround","addSphere","addCylinder","addCone","addTorus","addExtrude","addMaterial","_i","add","isArray","createMesh","position","obj","_b","_c","type","castShadow","receiveShadow","shape","autoCenter","bufferGeometry","rest","_d","depth","_e","bevelEnabled","ExtrudeBufferGeometry","ExtrudeGeometry","center","PlaneBufferGeometry","width","height","widthSegments","heightSegments","PlaneGeometry","side","DoubleSide","SphereBufferGeometry","phiStart","phiLength","thetaStart","thetaLength","SphereGeometry","BoxBufferGeometry","depthSegments","BoxGeometry","rotateX","MathUtils","degToRad","CylinderBufferGeometry","radiusTop","radiusBottom","radiusSegments","openEnded","CylinderGeometry","ConeBufferGeometry","PI","TorusBufferGeometry","tube","radialSegments","tubularSegments","arc","TorusGeometry","keys","MeshBasicMaterial","basic","MeshNormalMaterial","normal","MeshStandardMaterial","standard","lambert","MeshPhongMaterial","phong","physical","MeshPhysicalMaterial","MeshToonMaterial","toon","LineBasicMaterial","line","PointsMaterial","points","custom","wasmSupported","WebAssembly","instantiate","module_1","Module","Uint8Array","of","Instance","loadScriptAsync","url","doneCallback","tag","document","createElement","onload","onerror","Error","async","src","head","appendChild","self","Timeout","clearFn","_id","_clearFn","scope","clearTimeout","setInterval","clearInterval","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","global","clearImmediate","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","attachTo","getPrototypeOf","toString","process","handle","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","port2","documentElement","script","onreadystatechange","removeChild","random","source","addEventListener","attachEvent","task","run","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","prependListener","prependOnceListener","binding","cwd","chdir","dir","umask","v1","objectsAmmo","config","mass","collisionFlags","translateX","toAmmoV3","v","lock","body","targetBody","fixed","pointToPoint","hinge","slider","spring","coneTwist","bodyA","bodyB","frameA","frameB","dof","getTransform","v2","dx","dy","dz","transformB","btTransform","setIdentity","transformA","setOrigin","getCenterOfMassTransform","inverse","op_mul","zero","angularLowerLimit","angularUpperLimit","constraint","btFixedConstraint","physicsWorld","addConstraint","pivotA","pivotB","pivotV3","targetPivotV3","btPoint2PointConstraint","axisA","axisB","axisV3","targetAxisV3","btHingeConstraint","linearLowerLimit","linearUpperLimit","rotationA","setEulerZYX","rotationB","btSliderConstraint","setLowerLinLimit","lll","setUpperLinLimit","lul","setLowerAngLimit","all","setUpperAngLimit","aul","stiffness","damping","angularLock","btGeneric6DofSpringConstraint","setLinearLowerLimit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","enableSpring","setStiffness","setDamping","rbAFrame","rbBFrame","btConeTwistConstraint","setAngularOnly","btGeneric6DofConstraint","destroy","addCollider","object1","object2","eventCallback","AmmoDebugConstants","world","options","debugDrawMode","drawOnTop","maxBufferSize","vertices","Float32Array","colors","setAttribute","setUsage","index","vertexColors","depthTest","renderOrder","frustumCulled","enabled","debugDrawer","DebugDrawer","drawLine","drawContactPoint","reportErrorWarning","draw3dText","setDebugMode","getDebugMode","setDebugDrawer","enable","disable","remove","attributes","needsUpdate","debugDrawWorld","setDrawRange","from","to","heap","HEAPF32","fromX","fromY","fromZ","setXYZ","toX","toY","toZ","pointOnB","normalOnB","distance","_lifeTime","warningString","warn","Pointer_stringify","warnedOnce","_location","_textString","debugMode","ConvexObjectBreaker","minSizeForBreak","smallDelta","tempLine1","tempPlane1","tempPlane2","tempPlane_Cut","tempCM1","tempCM2","tempVector3","tempVector3_2","tempVector3_3","tempVector3_P0","tempVector3_P1","tempVector3_P2","tempVector3_N0","tempVector3_N1","tempVector3_AB","tempVector3_CB","tempResultObjects","segments","prepareBreakableObject","isBufferGeometry","userData","clone","subdivideByImpact","pointOfImpact","maxRadialIterations","maxRandomIterations","debris","addVectors","setFromCoplanarPoints","maxTotalIterations","subdivideRadial","subObject","startAngle","endAngle","numIterations","copy","constant","sub","applyAxisAngle","cutByPlane","obj1","obj2","output","coords","normals","numPoints","numFaces","indices","getIndex","getVertexIndex","faceIdx","vert","idx","points1","points2","delta","numPointPairs","p0","p1","n0","n1","b1","c1","b2","c2","dot","localPlane","updateMatrix","transformPlaneToLocalSpace","matrix","va","vb","vc","segment","i0","i1","mark0","distanceToPoint","mark1","end","intersection","intersectLine","segmentedObject1","segmentedObject2","newMass","radius1","numPoints1","divideScalar","max","radius2","numPoints2","numObjects","quaternion","transformFreeVector","elements","transformFreeVectorInverse","transformTiedVectorInverse","resultPlane","referencePoint","coplanarPoint","rigidBodies","earlierDetectedCollisions","ptr","values","removeRigidBody","splice","setup","convexBreaker","objectsToRemove","numObjectsToRemove","setupPhysicsWorld","updateDebugger","gravity","collisionConfiguration","btDefaultCollisionConfiguration","dispatcher","btCollisionDispatcher","broadphase","btDbvtBroadphase","solver","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","createDebrisFromBreakableObject","parent","fragmentDepth","removeDebris","impactPoint","impactNormal","detectedCollisions","deltaTime","stepSimulation","maxSubSteps","fixedTimeStep","il","objThree","ms","isKinematicObject","needUpdate","getWorldQuaternion","getWorldPosition","tmpVector3","contactPoint","impulse","pos","vel","angVel","fragment","contactManifold","getManifoldByIndexInternal","getBody0","body0","castObject","btRigidBody","body1","getBody1","ptr0","ptr1","threeObject0","threeObject1","breakable0","breakable1","collided0","collided1","checkCollisions0","checkCollisions1","sort","find","el","combinedName","contact","maxImpulse","jl","getNumContacts","getContactPoint","getDistance","getAppliedImpulse","get_m_positionWorldOnB","get_m_normalWorldOnB","emptyV3","physicsBody","getNumManifolds","split","obj0","TYPE","FIT","hasUpdateMatricesFunction","createCollisionShapes","createBoxShape","createCylinderShape","createCapsuleShape","createConeShape","createSphereShape","createHullShape","createHACDShapes","createVHACDShapes","createTriMeshShape","createHeightfieldTerrainShape","_setOptions","fit","halfExtents","_computeHalfExtents","_computeBounds","minHalfExtent","maxHalfExtent","btHalfExtents","collisionShape","btBoxShape","_finishCollisionShape","_computeScale","cylinderAxis","btCylinderShape","btCylinderShapeX","btCylinderShapeZ","btCapsuleShape","btCapsuleShapeX","btCapsuleShapeZ","btConeShape","btConeShapeX","btConeShapeZ","isNaN","sphereRadius","_computeRadius","btSphereShape","vertex","bounds","btVertex","originalHull","btConvexHullShape","setMargin","margin","min","multiplyScalar","vertexCount","_iterateGeometries","geo","maxVertices","hullMaxVertices","adjustGeometryTranslateEXPERIMENTAL","components","applyMatrix4","addPoint","getNumVertices","shapeHull","btShapeHull","buildHull","getPointer","getVertexPointer","numVertices","scale","triCount","hacd","HACD","SetCompacityWeight","compacityWeight","SetVolumeWeight","volumeWeight","SetNClusters","nClusters","SetNVerticesPerCH","nVerticesPerCH","SetConcavity","concavity","_malloc","triangles","SetPoints","SetTriangles","SetNPoints","SetNTriangles","pptr","tptr","HEAPF64","HEAP32","Compute","_free","GetNClusters","shapes","hull","nPoints","GetNPointsCH","nTriangles","GetNTrianglesCH","hullPoints","hullTriangles","GetCH","pi","px","py","pz","count","vhacd","VHACD","params","Parameters","set_m_resolution","resolution","set_m_depth","set_m_concavity","set_m_planeDownsampling","planeDownsampling","set_m_convexhullDownsampling","convexhullDownsampling","set_m_alpha","alpha","set_m_beta","beta","set_m_gamma","gamma","set_m_pca","pca","set_m_mode","set_m_maxNumVerticesPerCH","maxNumVerticesPerCH","set_m_minVolumePerCH","minVolumePerCH","set_m_convexhullApproximation","convexhullApproximation","set_m_oclAcceleration","oclAcceleration","nHulls","GetNConvexHulls","ch","ConvexHull","GetConvexHull","get_m_nPoints","get_m_points","bta","btb","btc","triMesh","btTriangleMesh","ai","bi","ci","addTriangle","concave","btBvhTriangleMeshShape","btConvexTriangleMeshShape","resources","heightfieldDistance","heightfieldData","heightScale","upAxis","hdt","heightDataType","PHY_SHORT","PHY_FLOAT","flipQuadEdges","heightStickLength","heightStickWidth","minHeight","Number","POSITIVE_INFINITY","maxHeight","NEGATIVE_INFINITY","btHeightfieldTerrainShape","setLocalScaling","includeInvisible","orientation","res","localScale","cb","getInverse","matrixWorld","traverse","isMesh","identity","updateMatrices","multiplyMatrices","fromGeometry","maxRadiusSq","cx","cy","cz","getCenter","subVectors","clampScalar","minX","Infinity","minY","minZ","maxX","maxY","maxZ","computeBoundingBox","target","boundingBox","makeTranslation","getHitPointWorld","h","_btRayCallback","get_m_hitPointWorld","getCollisionObject","get_m_collisionObject","size","hh","at","getCollisionObjects","obs","get_m_collisionObjects","setRayFromWorld","_btRayFrom","set_m_rayFromWorld","setRayToWorld","_btRayTo","set_m_rayToWorld","hasHit","rayTest","_tmpBtVector3","ClosestRayResultCallback","AllHitsRayResultCallback","ClosestRaycaster","Raycaster","AllHitsRaycaster","oldTime","elapsedTime","running","performance","diff","newTime","log","collider","constraints","addConstraints","raycaster","addCompoundShape","compoundShape","btCompoundShape","tmp","addChildShape","quat","addRigidBody","addChildren","defaultParams","children","child","test","parameters","Shape","addShape","addRigidBodyToShape","addBodyProperties","opts","SIMD_PI","subdivisions","gap","cos","cylinderShape","forward","rotation","rotate","addTorusShape","createRigidBody","physicsShape","motionState","btDefaultMotionState","localInertia","calculateLocalInertia","rbInfo","btRigidBodyConstructionInfo","threeObject","rigidBody","setActivationState","friction"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,EAAQG,QAAQ,UACR,mBAAXC,QAAyBA,OAAOC,IAC9CD,OAAO,CAAC,SAAUJ,GACQ,iBAAZC,QACdA,QAAkB,SAAID,EAAQG,QAAQ,UAEtCJ,EAAe,SAAIC,EAAQD,EAAY,OARzC,CASGO,QAAQ,SAASC,GACpB,O,YCTE,IAAIC,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUT,QAGnC,IAAIC,EAASM,EAAiBE,GAAY,CACzCC,EAAGD,EACHE,GAAG,EACHX,QAAS,IAUV,OANAY,EAAQH,GAAUI,KAAKZ,EAAOD,QAASC,EAAQA,EAAOD,QAASQ,GAG/DP,EAAOU,GAAI,EAGJV,EAAOD,QA0Df,OArDAQ,EAAoBM,EAAIF,EAGxBJ,EAAoBO,EAAIR,EAGxBC,EAAoBQ,EAAI,SAAShB,EAASiB,EAAMC,GAC3CV,EAAoBW,EAAEnB,EAASiB,IAClCG,OAAOC,eAAerB,EAASiB,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEV,EAAoBgB,EAAI,SAASxB,GACX,oBAAXyB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAerB,EAASyB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBQ,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAASlC,GAChC,IAAIiB,EAASjB,GAAUA,EAAO6B,WAC7B,WAAwB,OAAO7B,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAO,EAAoBQ,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRV,EAAoBW,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG7B,EAAoBgC,EAAI,GAIjBhC,EAAoBA,EAAoBiC,EAAI,I,gBClFrDxC,EAAOD,QAAUM,G,6BCCjBc,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IAItD3B,EAAQ0C,QAHK,SAAUC,GACnBC,QAAQC,MAAM,iBAAmBF,EAAM,IAAK,sC,6BCDhD,IAAIG,EAAM1B,OAAOkB,UAAUC,eACvBQ,EAAS,IASb,SAASC,KA4BT,SAASC,EAAGC,EAAIC,EAASC,GACvBC,KAAKH,GAAKA,EACVG,KAAKF,QAAUA,EACfE,KAAKD,KAAOA,IAAQ,EActB,SAASE,EAAYC,EAASC,EAAON,EAAIC,EAASC,GAChD,GAAkB,mBAAPF,EACT,MAAM,IAAIO,UAAU,mCAGtB,IAAIC,EAAW,IAAIT,EAAGC,EAAIC,GAAWI,EAASH,GAC1CO,EAAMZ,EAASA,EAASS,EAAQA,EAMpC,OAJKD,EAAQK,QAAQD,GACXJ,EAAQK,QAAQD,GAAKT,GAC1BK,EAAQK,QAAQD,GAAO,CAACJ,EAAQK,QAAQD,GAAMD,GADhBH,EAAQK,QAAQD,GAAKE,KAAKH,IADlCH,EAAQK,QAAQD,GAAOD,EAAUH,EAAQO,gBAI7DP,EAUT,SAASQ,EAAWR,EAASI,GACI,KAAzBJ,EAAQO,aAAoBP,EAAQK,QAAU,IAAIZ,SAC5CO,EAAQK,QAAQD,GAU9B,SAASK,IACPX,KAAKO,QAAU,IAAIZ,EACnBK,KAAKS,aAAe,EAxElB1C,OAAOY,SACTgB,EAAOV,UAAYlB,OAAOY,OAAO,OAM5B,IAAIgB,GAASiB,YAAWlB,GAAS,IA2ExCiB,EAAa1B,UAAU4B,WAAa,WAClC,IACIC,EACAlD,EAFAmD,EAAQ,GAIZ,GAA0B,IAAtBf,KAAKS,aAAoB,OAAOM,EAEpC,IAAKnD,KAASkD,EAASd,KAAKO,QACtBd,EAAIjC,KAAKsD,EAAQlD,IAAOmD,EAAMP,KAAKd,EAAS9B,EAAKoD,MAAM,GAAKpD,GAGlE,OAAIG,OAAOkD,sBACFF,EAAMG,OAAOnD,OAAOkD,sBAAsBH,IAG5CC,GAUTJ,EAAa1B,UAAUkC,UAAY,SAAmBhB,GACpD,IAAIG,EAAMZ,EAASA,EAASS,EAAQA,EAChCiB,EAAWpB,KAAKO,QAAQD,GAE5B,IAAKc,EAAU,MAAO,GACtB,GAAIA,EAASvB,GAAI,MAAO,CAACuB,EAASvB,IAElC,IAAK,IAAIxC,EAAI,EAAGC,EAAI8D,EAASC,OAAQC,EAAK,IAAIC,MAAMjE,GAAID,EAAIC,EAAGD,IAC7DiE,EAAGjE,GAAK+D,EAAS/D,GAAGwC,GAGtB,OAAOyB,GAUTX,EAAa1B,UAAUuC,cAAgB,SAAuBrB,GAC5D,IAAIG,EAAMZ,EAASA,EAASS,EAAQA,EAChCgB,EAAYnB,KAAKO,QAAQD,GAE7B,OAAKa,EACDA,EAAUtB,GAAW,EAClBsB,EAAUE,OAFM,GAYzBV,EAAa1B,UAAUwC,KAAO,SAActB,EAAOuB,EAAIC,EAAIC,EAAIC,EAAIC,GACjE,IAAIxB,EAAMZ,EAASA,EAASS,EAAQA,EAEpC,IAAKH,KAAKO,QAAQD,GAAM,OAAO,EAE/B,IAEIyB,EACA1E,EAHA8D,EAAYnB,KAAKO,QAAQD,GACzB0B,EAAMC,UAAUZ,OAIpB,GAAIF,EAAUtB,GAAI,CAGhB,OAFIsB,EAAUpB,MAAMC,KAAKkC,eAAe/B,EAAOgB,EAAUtB,QAAIsC,GAAW,GAEhEH,GACN,KAAK,EAAG,OAAOb,EAAUtB,GAAGrC,KAAK2D,EAAUrB,UAAU,EACrD,KAAK,EAAG,OAAOqB,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,IAAK,EACzD,KAAK,EAAG,OAAOP,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,IAAK,EAC7D,KAAK,EAAG,OAAOR,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,EAAIC,IAAK,EACjE,KAAK,EAAG,OAAOT,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,EAAIC,EAAIC,IAAK,EACrE,KAAK,EAAG,OAAOV,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,EAAIC,EAAIC,EAAIC,IAAK,EAG3E,IAAKzE,EAAI,EAAG0E,EAAO,IAAIR,MAAMS,EAAK,GAAI3E,EAAI2E,EAAK3E,IAC7C0E,EAAK1E,EAAI,GAAK4E,UAAU5E,GAG1B8D,EAAUtB,GAAGuC,MAAMjB,EAAUrB,QAASiC,OACjC,CACL,IACIM,EADAhB,EAASF,EAAUE,OAGvB,IAAKhE,EAAI,EAAGA,EAAIgE,EAAQhE,IAGtB,OAFI8D,EAAU9D,GAAG0C,MAAMC,KAAKkC,eAAe/B,EAAOgB,EAAU9D,GAAGwC,QAAIsC,GAAW,GAEtEH,GACN,KAAK,EAAGb,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,SAAU,MACpD,KAAK,EAAGqB,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,QAAS4B,GAAK,MACxD,KAAK,EAAGP,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,QAAS4B,EAAIC,GAAK,MAC5D,KAAK,EAAGR,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,QAAS4B,EAAIC,EAAIC,GAAK,MAChE,QACE,IAAKG,EAAM,IAAKM,EAAI,EAAGN,EAAO,IAAIR,MAAMS,EAAK,GAAIK,EAAIL,EAAKK,IACxDN,EAAKM,EAAI,GAAKJ,UAAUI,GAG1BlB,EAAU9D,GAAGwC,GAAGuC,MAAMjB,EAAU9D,GAAGyC,QAASiC,IAKpD,OAAO,GAYTpB,EAAa1B,UAAUqD,GAAK,SAAYnC,EAAON,EAAIC,GACjD,OAAOG,EAAYD,KAAMG,EAAON,EAAIC,GAAS,IAY/Ca,EAAa1B,UAAUc,KAAO,SAAcI,EAAON,EAAIC,GACrD,OAAOG,EAAYD,KAAMG,EAAON,EAAIC,GAAS,IAa/Ca,EAAa1B,UAAUiD,eAAiB,SAAwB/B,EAAON,EAAIC,EAASC,GAClF,IAAIO,EAAMZ,EAASA,EAASS,EAAQA,EAEpC,IAAKH,KAAKO,QAAQD,GAAM,OAAON,KAC/B,IAAKH,EAEH,OADAa,EAAWV,KAAMM,GACVN,KAGT,IAAImB,EAAYnB,KAAKO,QAAQD,GAE7B,GAAIa,EAAUtB,GAEVsB,EAAUtB,KAAOA,GACfE,IAAQoB,EAAUpB,MAClBD,GAAWqB,EAAUrB,UAAYA,GAEnCY,EAAWV,KAAMM,OAEd,CACL,IAAK,IAAIjD,EAAI,EAAGyD,EAAS,GAAIO,EAASF,EAAUE,OAAQhE,EAAIgE,EAAQhE,KAEhE8D,EAAU9D,GAAGwC,KAAOA,GACnBE,IAASoB,EAAU9D,GAAG0C,MACtBD,GAAWqB,EAAU9D,GAAGyC,UAAYA,IAErCgB,EAAON,KAAKW,EAAU9D,IAOtByD,EAAOO,OAAQrB,KAAKO,QAAQD,GAAyB,IAAlBQ,EAAOO,OAAeP,EAAO,GAAKA,EACpEJ,EAAWV,KAAMM,GAGxB,OAAON,MAUTW,EAAa1B,UAAUsD,mBAAqB,SAA4BpC,GACtE,IAAIG,EAUJ,OARIH,GACFG,EAAMZ,EAASA,EAASS,EAAQA,EAC5BH,KAAKO,QAAQD,IAAMI,EAAWV,KAAMM,KAExCN,KAAKO,QAAU,IAAIZ,EACnBK,KAAKS,aAAe,GAGfT,MAMTW,EAAa1B,UAAUuD,IAAM7B,EAAa1B,UAAUiD,eACpDvB,EAAa1B,UAAUgB,YAAcU,EAAa1B,UAAUqD,GAK5D3B,EAAa8B,SAAW/C,EAKxBiB,EAAaA,aAAeA,EAM1B/D,EAAOD,QAAUgE,G,6BC7UnB5C,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IAUtD3B,EAAQ0C,QARU,SAAUqD,EAAaC,GACrCA,EAAUC,SAAQ,SAAUC,GACxB9E,OAAO+E,oBAAoBD,EAAS5D,WAAW2D,SAAQ,SAAUhF,GAE7DG,OAAOC,eAAe0E,EAAYzD,UAAWrB,EAAMG,OAAOgF,yBAAyBF,EAAS5D,UAAWrB,Y;;;;;GCDnH,IACQoF,EADJC,EAAajD,MAAQA,KAAKiD,YACtBD,EAAgB,SAAUrF,EAAGuF,GAI7B,OAHAF,EAAgBjF,OAAOoF,gBAClB,CAAEvC,UAAW,cAAgBW,OAAS,SAAU5D,EAAGuF,GAAKvF,EAAEiD,UAAYsC,IACvE,SAAUvF,EAAGuF,GAAK,IAAK,IAAI/D,KAAK+D,EAAOA,EAAEhE,eAAeC,KAAIxB,EAAEwB,GAAK+D,EAAE/D,MACpDxB,EAAGuF,IAErB,SAAUvF,EAAGuF,GAEhB,SAASE,IAAOpD,KAAKqD,YAAc1F,EADnCqF,EAAcrF,EAAGuF,GAEjBvF,EAAEsB,UAAkB,OAANiE,EAAanF,OAAOY,OAAOuE,IAAME,EAAGnE,UAAYiE,EAAEjE,UAAW,IAAImE,KAGnFE,EAAmBtD,MAAQA,KAAKsD,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAI9E,WAAc8E,EAAM,CAAE,QAAWA,IAExDxF,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAIkF,EAAU,EAAQ,GAClBC,EAAWH,EAAgB,EAAQ,IAInCI,EAAkC,SAAUC,GAE5C,SAASD,IACL,IAAIE,EAAQD,EAAOnG,KAAKwC,OAASA,KAMjC,OALA4D,EAAMC,QAAU,IAAIL,EAAQM,QAC5BF,EAAMG,SAAU,EAChBH,EAAMI,MAAQ,GACdJ,EAAMK,iBAAmB,GACzBL,EAAMhG,KAAO,UAAYgG,EAAMM,GACxBN,EA6CX,OArDAX,EAAUS,EAAkBC,GAU5B5F,OAAOC,eAAe0F,EAAiBzE,UAAW,QAAS,CAEvDf,IAAK,WACD,MAAO,CACHiG,MAAOnE,KAAKoE,WACZC,IAAKrE,KAAKsE,WAGlBrG,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe0F,EAAiBzE,UAAW,aAAc,CAE5Df,IAAK,WAED,OADA8B,KAAKwE,kBAAkBxE,KAAK6D,SACrBY,KAAKC,MAAM1E,KAAK6D,QAAQc,EAAG3E,KAAK6D,QAAQe,IAEnD3G,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe0F,EAAiBzE,UAAW,WAAY,CAE1Df,IAAK,WAED,OADA8B,KAAKwE,kBAAkBxE,KAAK6D,SACrBY,KAAKI,KAAK7E,KAAK6D,QAAQiB,IAElC7G,YAAY,EACZsG,cAAc,IAElBb,EAAiBzE,UAAU8F,UAAY,SAAUnH,GAC7C,IAAIoH,EACJ,GAAIhF,KAAKiF,OAASjF,KAAKgE,MAAM9E,eAAetB,GAAO,CAC/C,IAAIsH,EAA+B,QAArBF,EAAKhF,KAAKiF,aAA0B,IAAPD,OAAgB,EAASA,EAAGG,WAAWnF,KAAKgE,MAAMpG,IAC7FsH,EAAOE,KAAO,EACdpF,KAAKiF,MAAMI,gBACXH,EAAOI,OAAO,IACdJ,EAAOK,OACPvF,KAAKiE,iBAAmBrG,OAGxB6F,EAASpE,QAAQ,kCAAoCzB,IAGtD8F,EAtD0B,CAuDnCF,EAAQgC,UACV7I,EAAQ0C,QAAUqE,G,6BCnFlB3F,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAIkF,EAAU,EAAQ,GAClBiC,EAAiC,WACjC,SAASA,IACLzF,KAAK0F,iBAAmB,IAAIlC,EAAQmC,oBAAoB,CAAEC,MAAO,WAKrE,OAHAH,EAAgBxG,UAAUf,IAAM,WAC5B,OAAO8B,KAAK0F,kBAETD,EAPyB,GASpC9I,EAAQ0C,QAAUoG,G;;;;;GCNlB,IACQzC,EADJC,EAAajD,MAAQA,KAAKiD,YACtBD,EAAgB,SAAUrF,EAAGuF,GAI7B,OAHAF,EAAgBjF,OAAOoF,gBAClB,CAAEvC,UAAW,cAAgBW,OAAS,SAAU5D,EAAGuF,GAAKvF,EAAEiD,UAAYsC,IACvE,SAAUvF,EAAGuF,GAAK,IAAK,IAAI/D,KAAK+D,EAAOA,EAAEhE,eAAeC,KAAIxB,EAAEwB,GAAK+D,EAAE/D,MACpDxB,EAAGuF,IAErB,SAAUvF,EAAGuF,GAEhB,SAASE,IAAOpD,KAAKqD,YAAc1F,EADnCqF,EAAcrF,EAAGuF,GAEjBvF,EAAEsB,UAAkB,OAANiE,EAAanF,OAAOY,OAAOuE,IAAME,EAAGnE,UAAYiE,EAAEjE,UAAW,IAAImE,KAGnFE,EAAmBtD,MAAQA,KAAKsD,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAI9E,WAAc8E,EAAM,CAAE,QAAWA,IAExDxF,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAIkF,EAAU,EAAQ,GAClBC,EAAWH,EAAgB,EAAQ,IACnCuC,EAA8B,SAAUlC,GAExC,SAASkC,EAAaC,EAAUC,GAC5B,IAAInC,EAAQD,EAAOnG,KAAKwC,KAAM8F,EAAUC,IAAa/F,KAMrD,OALA4D,EAAMC,QAAU,IAAIL,EAAQM,QAC5BF,EAAMG,SAAU,EAChBH,EAAMI,MAAQ,GACdJ,EAAMK,iBAAmB,GACzBL,EAAMhG,KAAO,UAAYgG,EAAMM,GACxBN,EA6CX,OArDAX,EAAU4C,EAAclC,GAUxB5F,OAAOC,eAAe6H,EAAa5G,UAAW,QAAS,CAEnDf,IAAK,WACD,MAAO,CACHiG,MAAOnE,KAAKoE,WACZC,IAAKrE,KAAKsE,WAGlBrG,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe6H,EAAa5G,UAAW,aAAc,CAExDf,IAAK,WAED,OADA8B,KAAKwE,kBAAkBxE,KAAK6D,SACrBY,KAAKC,MAAM1E,KAAK6D,QAAQc,EAAG3E,KAAK6D,QAAQe,IAEnD3G,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe6H,EAAa5G,UAAW,WAAY,CAEtDf,IAAK,WAED,OADA8B,KAAKwE,kBAAkBxE,KAAK6D,SACrBY,KAAKI,KAAK7E,KAAK6D,QAAQiB,IAElC7G,YAAY,EACZsG,cAAc,IAElBsB,EAAa5G,UAAU8F,UAAY,SAAUnH,GACzC,IAAIoH,EACJ,GAAIhF,KAAKiF,OAASjF,KAAKgE,MAAM9E,eAAetB,GAAO,CAC/C,IAAIsH,EAA+B,QAArBF,EAAKhF,KAAKiF,aAA0B,IAAPD,OAAgB,EAASA,EAAGG,WAAWnF,KAAKgE,MAAMpG,IAC7FsH,EAAOE,KAAO,EACdpF,KAAKiF,MAAMI,gBACXH,EAAOI,OAAO,IACdJ,EAAOK,OACPvF,KAAKiE,iBAAmBrG,OAGxB6F,EAASpE,QAAQ,kCAAoCzB,IAGtDiI,EAtDsB,CAuD/BrC,EAAQwC,MACVrJ,EAAQ0C,QAAUwG,G,6BChFlB,IAAIvC,EAAmBtD,MAAQA,KAAKsD,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAI9E,WAAc8E,EAAM,CAAE,QAAWA,IAExDxF,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAI2H,EAAe3C,EAAgB,EAAQ,KAU3C3G,EAAQuJ,cATY,SAAUC,EAAMC,GACV,oBAAXpJ,SACPA,OAAOqJ,eAAgB,GAC3BJ,EAAa5G,QAAQ8G,GAAM,WACvBG,OAAOC,MAAK,WACRH,Y;;;;;GCLZ,IAAI9C,EAAmBtD,MAAQA,KAAKsD,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAI9E,WAAc8E,EAAM,CAAE,QAAWA,IAExDxF,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAIkI,EAAqBlD,EAAgB,EAAQ,IACjD3G,EAAQ+G,iBAAmB8C,EAAmBnH,QAC9C,IAAIoH,EAAiBnD,EAAgB,EAAQ,IAC7C3G,EAAQkJ,aAAeY,EAAepH,QAGtC,IAAImE,EAAU,EAAQ,GACtB7G,EAAQ+J,eAAiBlD,EAAQkD,eACjC/J,EAAQgK,cAAgBnD,EAAQmD,cAChChK,EAAQiK,gBAAkBpD,EAAQoD,gBAClCjK,EAAQ6I,SAAWhC,EAAQgC,SAC3B7I,EAAQqJ,KAAOxC,EAAQwC,KACvBrJ,EAAQkK,SAAWrD,EAAQqD,SAC3BlK,EAAQmK,KAAOtD,EAAQsD,KACvBnK,EAAQoK,OAASvD,EAAQuD,OACzBpK,EAAQqK,MAAQxD,EAAQwD,O,8BCzBxB;;;;;;AAMAjJ,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO;;;;;;AAUtD,IAAI2I,EAA6B,WAC7B,SAASA,EAAYC,EAAKC,QACV,IAARD,IAAkBA,EAAM,SACV,IAAdC,IAAwBA,GAAY,GAKxCnH,KAAKoH,aAAe,IAAO,GAE3BpH,KAAKqH,aAAeC,KAAKC,MAEzBvH,KAAKwH,YAAc,EAEnBxH,KAAKyH,OAAS,EAEdzH,KAAK0H,YAAa,EAClB1H,KAAK2H,eAAgB,EACjBR,GACAnH,KAAK4H,MAAMV,GA4EnB,OAtEAD,EAAYhI,UAAU2I,MAAQ,SAAUV,QACxB,IAARA,IAAkBA,EAAM,IACxBA,GAAO,IACPlH,KAAK6H,sBACT7H,KAAKoH,aAAe,IAAOF,EAC3BlH,KAAK0H,YAAa,EAClB1H,KAAK8H,UAAYR,KAAKC,MACtBvH,KAAK+H,QAGTd,EAAYhI,UAAU+I,KAAO,WACzBhI,KAAK0H,YAAa,GAGtBT,EAAYhI,UAAUgJ,UAAY,WAC9B,OAAOjI,KAAK0H,YAGhBT,EAAYhI,UAAUiJ,SAAW,WAC7B,OAAOlI,KAAKyH,QAGhBR,EAAYhI,UAAUkJ,eAAiB,WACnC,OAAOb,KAAKC,MAAQvH,KAAK8H,WAG7Bb,EAAYhI,UAAUmJ,OAAS,SAAUC,GACrCrI,KAAKsI,gBAAkBD,GAE3BpB,EAAYhI,UAAU8I,KAAO,WACzB,IAAInE,EAAQ5D,KACZ,GAAKA,KAAK0H,WAAV,CAEA,IAAIH,EAAMD,KAAKC,MACfvH,KAAKwH,cACDxH,KAAKqH,aAAerH,KAAKoH,cAAgBG,IACzCvH,KAAKyH,QAAUF,EAAMvH,KAAKqH,cAAgB,IAC1CrH,KAAKqH,aAAeE,EACpBvH,KAAKsI,gBAAgBtI,KAAKyH,QAQ1BzH,KAAKwH,YAAc,GAEnBxH,KAAK2H,cACDL,KAAKC,MAAQvH,KAAKqH,aAAerH,KAAKoH,aAAe,GACrDmB,YAAW,WAAc,OAAO3E,EAAMmE,UAGtCS,GAAa,WAAc,OAAO5E,EAAMmE,UAI5CQ,YAAW,WACP3E,EAAMmE,SACP/H,KAAKoH,gBAIhBH,EAAYhI,UAAU4I,oBAAsB,WACxC7H,KAAK2H,eAAgB,GAGzBV,EAAYhI,UAAUwJ,mBAAqB,WACvCzI,KAAK2H,eAAgB,GAElBV,EA/FqB,GAiGhCtK,EAAQsK,YAAcA,I,6CCjHtB,IAAIyB,EAGJA,EAAI,WACH,OAAO1I,KADJ,GAIJ,IAEC0I,EAAIA,GAAK,IAAIC,SAAS,cAAb,GACR,MAAOC,GAEc,iBAAX5L,SAAqB0L,EAAI1L,QAOrCJ,EAAOD,QAAU+L,G;;;;;GCbjB,IAAIpF,EAAmBtD,MAAQA,KAAKsD,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAI9E,WAAc8E,EAAM,CAAE,QAAWA,IAExDxF,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAIuK,EAAkBvF,EAAgB,EAAQ,KAC1CE,EAAU,EAAQ,GAClBsF,EAA6B,WAC7B,SAASA,EAAYC,EAASC,GAC1BhJ,KAAK+I,QAAUA,EACf/I,KAAKgJ,KAAOA,EACZhJ,KAAKiJ,OAAS,CAAEtE,EAAG,EAAGG,EAAG,EAAGF,EAAG,GAC/B5E,KAAKkJ,OAAS,GACdlJ,KAAKmJ,iBAAkB,EACvBnJ,KAAKoJ,WAAY,EACjBpJ,KAAKqJ,UAAW,EAChBrJ,KAAKsJ,WAAY,EACjBtJ,KAAKuJ,mBAAoB,EACzBvJ,KAAKwJ,aAAc,EACnBxJ,KAAKyJ,SAAW,IAAIjG,EAAQkG,MAC5B1J,KAAK2J,cAAgB,IAAInG,EAAQoG,WACjC5J,KAAK6J,aAAe,IAAIvD,KAAKwD,UAC7B9J,KAAK+J,gBAAkB,IAAIzD,KAAK0D,aAAa,EAAG,EAAG,EAAG,GAEtDhK,KAAKpC,KAAOoL,EAAKpL,KAqPrB,OAnPAkL,EAAY7J,UAAUgL,kBAAoB,gBACL,IAAtBjK,KAAKkK,eACZlK,KAAKkK,aAAe,IAAIrB,EAAgBxJ,UAEhDtB,OAAOC,eAAe8K,EAAY7J,UAAW,aAAc,CACvDf,IAAK,WACD,OAAO8B,KAAKwJ,aAEhBW,IAAK,SAAUC,IACNA,GAAQpK,KAAKwJ,cACdxJ,KAAKsJ,WAAY,GACrBtJ,KAAKwJ,YAAcY,GAEvBnM,YAAY,EACZsG,cAAc,IAElBuE,EAAY7J,UAAUoL,cAAgB,SAAUC,EAAgBvK,QAC/C,IAATA,IAAmBA,GAAO,GAC9BC,KAAKiK,oBACLjK,KAAKuJ,mBAAoB,EACrBxJ,EACAC,KAAKkK,aAAanK,KAAK,UAAU,WAC7BuK,OAGJtK,KAAKkK,aAAa5H,GAAG,UAAU,WAC3BgI,QAGZvM,OAAOC,eAAe8K,EAAY7J,UAAW,KAAM,CAC/Cf,IAAK,WACD,IAAI0F,EAAQ5D,KACZ,MAAO,CACHuK,OAAQ,SAAUD,GAAkB,OAAO1G,EAAMyG,cAAcC,IAC/DE,UAAW,SAAUC,GACjB,OAAO7G,EAAM8G,YAAYD,MAIrCxM,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe8K,EAAY7J,UAAW,OAAQ,CACjDf,IAAK,WACD,IAAI0F,EAAQ5D,KACZ,MAAO,CACHuK,OAAQ,SAAUD,GAAkB,OAAO1G,EAAMyG,cAAcC,GAAgB,MAGvFrM,YAAY,EACZsG,cAAc,IAElBuE,EAAY7J,UAAUyL,YAAc,SAAUD,GAC1C,IAAI7G,EAAQ5D,KACZA,KAAKmJ,iBAAkB,EACvBnJ,KAAK+I,QAAQzG,GAAG,aAAa,SAAUqI,GACnC,IAAIC,EAASD,EAAKC,OAAQzK,EAAQwK,EAAKxK,MACnCyK,EAAO,GAAGhN,OAASgG,EAAMhG,KACzB6M,EAAkBG,EAAO,GAAIzK,GACxByK,EAAO,GAAGhN,OAASgG,EAAMhG,MAC9B6M,EAAkBG,EAAO,GAAIzK,OAIzC2I,EAAY7J,UAAU4L,UAAY,WAC9B,IAAItM,EAAIyB,KAAK+I,QAAQ+B,SACrB9K,KAAKgJ,KAAK+B,iBAAiBC,kBAAkBzM,IAGjDuK,EAAY7J,UAAUgM,QAAU,WAC5B,IAAI1M,EAAIyB,KAAK+I,QAAQ+B,SACrB9K,KAAKgJ,KAAK+B,iBAAiBG,kBAAkB3M,IAGjDuK,EAAY7J,UAAUkM,YAAc,SAAUxG,EAAGG,EAAGF,GAChD,IAAIgE,EAAI5I,KAAKyJ,SAASU,IAAIxF,EAAGG,EAAGF,GAC5BwG,EAAIpL,KAAK2J,cAAcQ,IAAI,EAAG,EAAG,EAAG,GACxCiB,EAAEC,aAAazC,GACf5I,KAAK+J,gBAAgBuB,SAAS,EAAG,EAAG,EAAG,GACvC,IAAIC,EAAWvL,KAAK+J,gBACpBwB,EAASD,SAASF,EAAEzG,EAAGyG,EAAEtG,EAAGsG,EAAExG,EAAGwG,EAAEI,GAC3BxL,KAAK+I,QAAQ+B,SACnBK,YAAYI,IAElBxN,OAAOC,eAAe8K,EAAY7J,UAAW,WAAY,CAErDf,IAAK,WACD,IACIqN,EADIvL,KAAK+I,QAAQ+B,SACJW,cACbL,EAAIpL,KAAK2J,cAAcQ,IAAIoB,EAAS5G,IAAK4G,EAASzG,IAAKyG,EAAS3G,IAAK2G,EAASC,KAC9EE,EAAKN,EAAEzG,EACPgH,EAAKP,EAAEtG,EACP8G,EAAKR,EAAExG,EACPiH,EAAKT,EAAEI,EAEPM,EAAQ,EAAIrH,KAAKI,KAAKgH,GAI1B,MAAO,CAAElH,EAHD+G,EAAKjH,KAAKsH,KAAK,EAAIF,EAAKA,GAGhBC,GAAS,EAAGhH,EAFpB6G,EAAKlH,KAAKsH,KAAK,EAAIF,EAAKA,GAEGC,GAAS,EAAGlH,EADvCgH,EAAKnH,KAAKsH,KAAK,EAAIF,EAAKA,GACsBC,GAAS,IAEnE7N,YAAY,EACZsG,cAAc,IAGlBuE,EAAY7J,UAAU+M,YAAc,SAAUrH,EAAGG,EAAGF,GACxC5E,KAAK+I,QAAQ+B,SACnBmB,YAAYX,SAAS3G,EAAGG,EAAGF,IAEjC7G,OAAOC,eAAe8K,EAAY7J,UAAW,WAAY,CAErDf,IAAK,WACD,IAAIK,EAAIyB,KAAK+I,QAAQ+B,SACrB,MAAO,CAAEnG,EAAGpG,EAAE0N,YAAYtH,IAAKG,EAAGvG,EAAE0N,YAAYnH,IAAKF,EAAGrG,EAAE0N,YAAYrH,MAE1E3G,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe8K,EAAY7J,UAAW,WAAY,CACrDf,IAAK,WACD,MAAO,CACHyG,EAAG3E,KAAKgJ,KAAKkD,oBAAoBvH,IACjCG,EAAG9E,KAAKgJ,KAAKkD,oBAAoBpH,IACjCF,EAAG5E,KAAKgJ,KAAKkD,oBAAoBtH,MAGzC3G,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAe8K,EAAY7J,UAAW,kBAAmB,CAC5Df,IAAK,WACD,MAAO,CACHyG,EAAG3E,KAAKgJ,KAAKmD,qBAAqBxH,IAClCG,EAAG9E,KAAKgJ,KAAKmD,qBAAqBrH,IAClCF,EAAG5E,KAAKgJ,KAAKmD,qBAAqBvH,MAG1C3G,YAAY,EACZsG,cAAc,IAElBuE,EAAY7J,UAAUmN,YAAc,SAAUzH,EAAGG,EAAGF,GAChD5E,KAAK6J,aAAayB,SAAS3G,EAAGG,EAAGF,GACjC5E,KAAKgJ,KAAKqD,kBAAkBrM,KAAK6J,eAErCf,EAAY7J,UAAUqN,aAAe,SAAUhO,GAC3C0B,KAAK6J,aAAayB,SAAShN,EAAO0B,KAAKuM,SAASzH,EAAG9E,KAAKuM,SAAS3H,GACjE5E,KAAKgJ,KAAKqD,kBAAkBrM,KAAK6J,eAErCf,EAAY7J,UAAUuN,aAAe,SAAUlO,GAC3C0B,KAAK6J,aAAayB,SAAStL,KAAKuM,SAAS5H,EAAGrG,EAAO0B,KAAKuM,SAAS3H,GACjE5E,KAAKgJ,KAAKqD,kBAAkBrM,KAAK6J,eAErCf,EAAY7J,UAAUwN,aAAe,SAAUnO,GAC3C0B,KAAK6J,aAAayB,SAAStL,KAAKuM,SAAS5H,EAAG3E,KAAKuM,SAASzH,EAAGxG,GAC7D0B,KAAKgJ,KAAKqD,kBAAkBrM,KAAK6J,eAErCf,EAAY7J,UAAUyN,mBAAqB,SAAU/H,EAAGG,EAAGF,GACvD5E,KAAK6J,aAAayB,SAAS3G,EAAGG,EAAGF,GACjC5E,KAAKgJ,KAAK0D,mBAAmB1M,KAAK6J,eAEtCf,EAAY7J,UAAU0N,oBAAsB,SAAUrO,GAClD0B,KAAK6J,aAAayB,SAAShN,EAAO0B,KAAK4M,gBAAgB9H,EAAG9E,KAAK4M,gBAAgBhI,GAC/E5E,KAAKgJ,KAAK0D,mBAAmB1M,KAAK6J,eAEtCf,EAAY7J,UAAU4N,oBAAsB,SAAUvO,GAClD0B,KAAK6J,aAAayB,SAAStL,KAAK4M,gBAAgBjI,EAAGrG,EAAO0B,KAAK4M,gBAAgBhI,GAC/E5E,KAAKgJ,KAAK0D,mBAAmB1M,KAAK6J,eAEtCf,EAAY7J,UAAU6N,oBAAsB,SAAUxO,GAClD0B,KAAK6J,aAAayB,SAAStL,KAAK4M,gBAAgBjI,EAAG3E,KAAK4M,gBAAgB9H,EAAGxG,GAC3E0B,KAAKgJ,KAAK0D,mBAAmB1M,KAAK6J,eAEtCf,EAAY7J,UAAU8N,WAAa,SAAUpI,EAAGG,EAAGF,GAC/C5E,KAAK6J,aAAayB,SAAS3G,EAAGG,EAAGF,GACjC5E,KAAKgJ,KAAKgE,oBAAoBhN,KAAK6J,eAEvCf,EAAY7J,UAAUgO,YAAc,SAAU3O,GAC1C0B,KAAK6J,aAAayB,SAAShN,EAAO,EAAG,GACrC0B,KAAKgJ,KAAKgE,oBAAoBhN,KAAK6J,eAEvCf,EAAY7J,UAAUiO,YAAc,SAAU5O,GAC1C0B,KAAK6J,aAAayB,SAAS,EAAGhN,EAAO,GACrC0B,KAAKgJ,KAAKgE,oBAAoBhN,KAAK6J,eAEvCf,EAAY7J,UAAUkO,YAAc,SAAU7O,GAC1C0B,KAAK6J,aAAayB,SAAS,EAAG,EAAGhN,GACjC0B,KAAKgJ,KAAKgE,oBAAoBhN,KAAK6J,eAOvCf,EAAY7J,UAAUmO,kBAAoB,SAAU9O,GAChD0B,KAAKgJ,KAAKoE,kBAAkB9O,IAMhCwK,EAAY7J,UAAUoO,kBAAoB,WACtC,OAAOrN,KAAKgJ,KAAKqE,qBAMrBvE,EAAY7J,UAAUqO,eAAiB,SAAUhP,GAC7C0B,KAAKgJ,KAAKsE,eAAehP,IAM7BwK,EAAY7J,UAAUsO,cAAgB,SAAUjP,GAC5C0B,KAAKsN,eAAehP,IAMxBwK,EAAY7J,UAAUuO,YAAc,SAAUlP,GAC1C0B,KAAKgJ,KAAKwE,YAAYlP,IAG1BwK,EAAY7J,UAAUwO,WAAa,SAAU9I,EAAGG,EAAGF,GAC/C5E,KAAK6J,aAAayB,SAAS3G,EAAGG,EAAGF,GACjC5E,KAAKgJ,KAAKyE,WAAWzN,KAAK6J,eAE9Bf,EAAY7J,UAAUyO,gBAAkB,SAAU/I,EAAGG,EAAGF,GACpD5E,KAAK6J,aAAayB,SAAS3G,EAAGG,EAAGF,GACjC5E,KAAKgJ,KAAK0E,gBAAgB1N,KAAK6J,eAEnCf,EAAY7J,UAAU0O,iBAAmB,SAAUhJ,EAAGG,EAAGF,GACrD5E,KAAK6J,aAAayB,SAAS3G,EAAGG,EAAGF,GACjC5E,KAAKgJ,KAAK2E,iBAAiB3N,KAAK6J,eAEpCf,EAAY7J,UAAU2O,sBAAwB,SAAUC,GACpD7N,KAAKgJ,KAAK4E,sBAAsBC,IAEpC/E,EAAY7J,UAAU6O,wBAA0B,SAAUC,GACtD/N,KAAKgJ,KAAK8E,wBAAwBC,IAE/BjF,EAtQqB,GAwQhCnM,EAAQ0C,QAAUyJ,G;;;;;GC9QlB,IAAIkF,EAAYhO,MAAQA,KAAKgO,UAAa,WAStC,OARAA,EAAWjQ,OAAOkQ,QAAU,SAAS1P,GACjC,IAAK,IAAIa,EAAG/B,EAAI,EAAGyB,EAAImD,UAAUZ,OAAQhE,EAAIyB,EAAGzB,IAE5C,IAAK,IAAI8B,KADTC,EAAI6C,UAAU5E,GACOU,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,KACzDZ,EAAEY,GAAKC,EAAED,IAEjB,OAAOZ,IAEK6D,MAAMpC,KAAMiC,YAE5BiM,EAAUlO,MAAQA,KAAKkO,QAAW,SAAU9O,EAAGwJ,GAC/C,IAAIrK,EAAI,GACR,IAAK,IAAIY,KAAKC,EAAOrB,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,IAAMyJ,EAAEuF,QAAQhP,GAAK,IAC9EZ,EAAEY,GAAKC,EAAED,IACb,GAAS,MAALC,GAAqD,mBAAjCrB,OAAOkD,sBACtB,KAAI5D,EAAI,EAAb,IAAgB8B,EAAIpB,OAAOkD,sBAAsB7B,GAAI/B,EAAI8B,EAAEkC,OAAQhE,IAC3DuL,EAAEuF,QAAQhP,EAAE9B,IAAM,GAAKU,OAAOkB,UAAUmP,qBAAqB5Q,KAAK4B,EAAGD,EAAE9B,MACvEkB,EAAEY,EAAE9B,IAAM+B,EAAED,EAAE9B,KAE1B,OAAOkB,GAEP+E,EAAmBtD,MAAQA,KAAKsD,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAI9E,WAAc8E,EAAM,CAAE,QAAWA,IAExDxF,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IACtD,IAAIkF,EAAU,EAAQ,GAClBiD,EAAiBnD,EAAgB,EAAQ,IACzCG,EAAWH,EAAgB,EAAQ,IACnC+K,EAAoB/K,EAAgB,EAAQ,IAC5CgL,EAA2B,WAC3B,SAASA,EAAUC,GACfvO,KAAKuO,MAAQA,EACbvO,KAAKwO,WAAuB,aAAVD,EAClBvO,KAAKyO,gBAAkB,IAAIJ,EAAkBhP,QAkVjD,OAhVAtB,OAAOC,eAAesQ,EAAUrP,UAAW,OAAQ,CAC/Cf,IAAK,WACD,IAAI0F,EAAQ5D,KACZ,MAAO,CACH0O,MAAO,SAAUC,EAAaC,GAG1B,YAFoB,IAAhBD,IAA0BA,EAAc,SACrB,IAAnBC,IAA6BA,EAAiB,IAC3ChL,EAAMiL,UAAUF,EAAaC,IAExCE,IAAK,SAAUC,EAAWH,GAGtB,YAFkB,IAAdG,IAAwBA,EAAY,SACjB,IAAnBH,IAA6BA,EAAiB,IAC3ChL,EAAMoL,QAAQD,EAAWH,IAEpCK,OAAQ,SAAUC,EAAcN,GAG5B,YAFqB,IAAjBM,IAA2BA,EAAe,SACvB,IAAnBN,IAA6BA,EAAiB,IAC3ChL,EAAMuL,WAAWD,EAAcN,IAE1CQ,SAAU,SAAUC,EAAgBT,GAGhC,YAFuB,IAAnBS,IAA6BA,EAAiB,SAC3B,IAAnBT,IAA6BA,EAAiB,IAC3ChL,EAAM0L,aAAaD,EAAgBT,IAE9CW,KAAM,SAAUC,EAAYZ,GAGxB,YAFmB,IAAfY,IAAyBA,EAAa,SACnB,IAAnBZ,IAA6BA,EAAiB,IAC3ChL,EAAM6L,SAASD,EAAYZ,IAEtCc,MAAO,SAAUC,EAAaf,GAG1B,YAFoB,IAAhBe,IAA0BA,EAAc,SACrB,IAAnBf,IAA6BA,EAAiB,IAC3ChL,EAAMgM,UAAUD,EAAaf,IAExCiB,QAAS,SAAUC,EAAelB,GAE9B,YADuB,IAAnBA,IAA6BA,EAAiB,IAC3ChL,EAAMmM,YAAYD,EAAelB,MAIpD3Q,YAAY,EACZsG,cAAc,IAElBxG,OAAOC,eAAesQ,EAAUrP,UAAW,MAAO,CAC9Cf,IAAK,WACD,IAAI0F,EAAQ5D,KACZ,MAAO,CAEHgQ,KAAM,SAAUA,GAAQ,OAAOpM,EAAMqM,QAAQD,IAE7CE,SAAU,SAAUnR,GAAU,OAAO6E,EAAMuM,YAAYpR,IAEvD2P,MAAO,SAAUC,EAAaC,GAG1B,YAFoB,IAAhBD,IAA0BA,EAAc,SACrB,IAAnBC,IAA6BA,EAAiB,IAC3ChL,EAAMwM,SAASzB,EAAaC,IAEvCE,IAAK,SAAUC,EAAWH,GAGtB,YAFkB,IAAdG,IAAwBA,EAAY,SACjB,IAAnBH,IAA6BA,EAAiB,IAC3ChL,EAAMyM,OAAOtB,EAAWH,IAEnC0B,OAAQ,SAAUC,EAAc3B,GAE5B,YADuB,IAAnBA,IAA6BA,EAAiB,IAC3ChL,EAAM4M,UAAUD,EAAc3B,IAGzCK,OAAQ,SAAUC,EAAcN,GAG5B,YAFqB,IAAjBM,IAA2BA,EAAe,SACvB,IAAnBN,IAA6BA,EAAiB,IAC3ChL,EAAM6M,UAAUvB,EAAcN,IAEzCQ,SAAU,SAAUC,EAAgBT,GAGhC,YAFuB,IAAnBS,IAA6BA,EAAiB,SAC3B,IAAnBT,IAA6BA,EAAiB,IAC3ChL,EAAM8M,YAAYrB,EAAgBT,IAE7CW,KAAM,SAAUC,EAAYZ,GAGxB,YAFmB,IAAfY,IAAyBA,EAAa,SACnB,IAAnBZ,IAA6BA,EAAiB,IAC3ChL,EAAM+M,QAAQnB,EAAYZ,IAErCc,MAAO,SAAUC,EAAaf,GAG1B,YAFoB,IAAhBe,IAA0BA,EAAc,SACrB,IAAnBf,IAA6BA,EAAiB,IAC3ChL,EAAMgN,SAASjB,EAAaf,IAEvCiB,QAAS,SAAUC,EAAelB,GAE9B,YADuB,IAAnBA,IAA6BA,EAAiB,IAC3ChL,EAAMiN,WAAWf,EAAelB,IAG3C7I,SAAU,SAAU6I,GAEhB,YADuB,IAAnBA,IAA6BA,EAAiB,IAC3ChL,EAAMkN,YAAYlC,MAIrC3Q,YAAY,EACZsG,cAAc,IAElB+J,EAAUrP,UAAUkR,YAAc,WAG9B,IAFA,IAAInL,EACAjG,EAAS,GACJgS,EAAK,EAAGA,EAAK9O,UAAUZ,OAAQ0P,IACpChS,EAAOgS,GAAM9O,UAAU8O,GAER,aAAf/Q,KAAKuO,QAERvJ,EAAKhF,KAAKuO,OAAOyC,IAAI5O,MAAM4C,EAAIjG,IAEpCuP,EAAUrP,UAAUgR,QAAU,SAAUD,GACpC,GAAIzO,MAAM0P,QAAQjB,GACd,IAAK,IAAI3S,EAAI,EAAGA,EAAI2S,EAAK3O,OAAQhE,IAC7B2C,KAAKmQ,YAAYH,EAAK3S,SAI1B2C,KAAKmQ,YAAYH,GAErB,OAAOhQ,MAEXsO,EAAUrP,UAAUiS,WAAa,SAAUpL,EAAUC,EAAUoL,GAC3D,IACIC,EADApM,EAAKmM,EAASxM,EAAGA,OAAW,IAAPK,EAAgB,EAAIA,EAAIqM,EAAKF,EAASrM,EAAGA,OAAW,IAAPuM,EAAgB,EAAIA,EAAIC,EAAKH,EAASvM,EAAGA,OAAW,IAAP0M,EAAgB,EAAIA,EAEvI,QAAS/P,MAAM0P,QAAQlL,IAAaA,EAASwL,MACzC,IAAK,oBACDH,EAAM,IAAI5N,EAAQsD,KAAKhB,EAAUC,GACjC,MACJ,IAAK,iBACDqL,EAAM,IAAI5N,EAAQuD,OAAOjB,EAAUC,GACnC,MACJ,QACIqL,EAAM,IAAI3K,EAAepH,QAAQyG,EAAUC,GAKnD,OAFAqL,EAAID,SAAShH,IAAIxF,EAAGG,EAAGF,GACvBwM,EAAII,WAAaJ,EAAIK,eAAgB,EAC9BL,GAEX9C,EAAUrP,UAAU8Q,YAAc,SAAUD,EAAelB,GACvD,IAAIjK,EAAImL,EAAcnL,EAAGG,EAAIgL,EAAchL,EAAGF,EAAIkL,EAAclL,EAAGhH,EAAOkS,EAAclS,KAAM8T,EAAQ5B,EAAc4B,MAAO1M,EAAK8K,EAAc6B,WAAYA,OAAoB,IAAP3M,GAAuBA,EAAIqM,EAAKvB,EAAc1G,UAAWA,OAAmB,IAAPiI,GAAwBA,EAAIC,EAAKxB,EAAc8B,eAAgBA,OAAwB,IAAPN,GAAuBA,EAAIO,EAAO3D,EAAO4B,EAAe,CAAC,IAAK,IAAK,IAAK,OAAQ,QAAS,aAAc,YAAa,mBAC5agC,EAAKD,EAAKE,MAAOA,OAAe,IAAPD,EAAgB,EAAIA,EAAIE,EAAKH,EAAKI,aAAcA,OAAsB,IAAPD,GAAwBA,EAChHlM,EAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQ0O,sBAAsBR,EAAO1D,EAAS,CAAE+D,MAAOA,EAAOE,aAAcA,GAAgBJ,IAChG,IAAIrO,EAAQ2O,gBAAgBT,EAAO1D,EAAS,CAAE+D,MAAOA,EAAOE,aAAcA,GAAgBJ,IAC5F9L,EAAW/F,KAAK8Q,YAAYlC,GAC5BoB,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAMhE,OAJI+M,GACA3B,EAAKlK,SAASsM,SAClBpC,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,UACN1B,GAEX1B,EAAUrP,UAAU4R,WAAa,SAAUf,EAAelB,QAC/B,IAAnBA,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAK+P,YAAYD,EAAelB,GAE1C,OADA5O,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAU4P,UAAY,SAAUF,EAAaC,GACnD,IAAIjK,EAAIgK,EAAYhK,EAAGG,EAAI6J,EAAY7J,EAAGF,EAAI+J,EAAY/J,EAAGhH,EAAO+Q,EAAY/Q,KAAMoH,EAAK2J,EAAYvF,UAAWA,OAAmB,IAAPpE,GAAwBA,EAAIqM,EAAK1C,EAAYiD,eAAgBA,OAAwB,IAAPP,GAAuBA,EAAIQ,EAAO3D,EAAOS,EAAa,CAAC,IAAK,IAAK,IAAK,OAAQ,YAAa,mBACnS7I,EAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQ6O,oBAAoBR,EAAKS,OAAS,EAAGT,EAAKU,QAAU,EAAGV,EAAKW,eAAiB,EAAGX,EAAKY,gBAAkB,GACnH,IAAIjP,EAAQkP,cAAcb,EAAKS,OAAS,EAAGT,EAAKU,QAAU,EAAGV,EAAKW,eAAiB,EAAGX,EAAKY,gBAAkB,GAC/G1M,EAAW/F,KAAK8Q,YAAYlC,GAChC7I,EAAS4M,KAAOnP,EAAQoP,WACxB,IAAI5C,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAGhE,OAFAoL,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,QACN1B,GAEX1B,EAAUrP,UAAUmR,SAAW,SAAUzB,EAAaC,GAClD,IAAIwC,EAAMpR,KAAK6O,UAAUF,EAAaC,GAEtC,OADA5O,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAUkQ,WAAa,SAAUD,EAAcN,GACrD,IAAIjK,EAAIuK,EAAavK,EAAGG,EAAIoK,EAAapK,EAAGF,EAAIsK,EAAatK,EAAGhH,EAAOsR,EAAatR,KAAMoH,EAAKkK,EAAa9F,UAAWA,OAAmB,IAAPpE,GAAwBA,EAAIqM,EAAKnC,EAAa0C,eAAgBA,OAAwB,IAAPP,GAAuBA,EAAIQ,EAAO3D,EAAOgB,EAAc,CAAC,IAAK,IAAK,IAAK,OAAQ,YAAa,mBAC1SpJ,EAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQqP,qBAAqBhB,EAAK9D,QAAU,EAAG8D,EAAKW,eAAiB,GAAIX,EAAKY,gBAAkB,GAAIZ,EAAKiB,eAAY3Q,EAAW0P,EAAKkB,gBAAa5Q,EAAW0P,EAAKmB,iBAAc7Q,EAAW0P,EAAKoB,kBAAe9Q,GACnN,IAAIqB,EAAQ0P,eAAerB,EAAK9D,QAAU,EAAG8D,EAAKW,eAAiB,GAAIX,EAAKY,gBAAkB,GAAIZ,EAAKiB,eAAY3Q,EAAW0P,EAAKkB,gBAAa5Q,EAAW0P,EAAKmB,iBAAc7Q,EAAW0P,EAAKoB,kBAAe9Q,GAC/M4D,EAAW/F,KAAK8Q,YAAYlC,GAC5BoB,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAGhE,OAFAoL,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,SACN1B,GAEX1B,EAAUrP,UAAUwR,UAAY,SAAUvB,EAAcN,QAC/B,IAAjBM,IAA2BA,EAAe,SACvB,IAAnBN,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAKmP,WAAWD,EAAcN,GAExC,OADA5O,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAU+P,QAAU,SAAUD,EAAWH,GAC/C,IAAIjK,EAAIoK,EAAUpK,EAAGG,EAAIiK,EAAUjK,EAAGF,EAAImK,EAAUnK,EAAGhH,EAAOmR,EAAUnR,KAAMoH,EAAK+J,EAAU3F,UAAWA,OAAmB,IAAPpE,GAAwBA,EAAIqM,EAAKtC,EAAU6C,eAAgBA,OAAwB,IAAPP,GAAuBA,EAAIQ,EAAO3D,EAAOa,EAAW,CAAC,IAAK,IAAK,IAAK,OAAQ,YAAa,mBACrRjJ,EAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQ2P,kBAAkBtB,EAAKS,OAAS,EAAGT,EAAKU,QAAU,EAAGV,EAAKE,OAAS,EAAGF,EAAKW,oBAAiBrQ,EAAW0P,EAAKY,qBAAkBtQ,EAAW0P,EAAKuB,oBAAiBjR,GAC3K,IAAIqB,EAAQ6P,YAAYxB,EAAKS,OAAS,EAAGT,EAAKU,QAAU,EAAGV,EAAKE,OAAS,EAAGF,EAAKW,oBAAiBrQ,EAAW0P,EAAKY,qBAAkBtQ,EAAW0P,EAAKuB,oBAAiBjR,GACvK4D,EAAW/F,KAAK8Q,YAAYlC,GAC5BoB,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAGhE,OAFAoL,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,MACN1B,GAEX1B,EAAUrP,UAAUoR,OAAS,SAAUtB,EAAWH,QAC5B,IAAdG,IAAwBA,EAAY,SACjB,IAAnBH,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAKgP,QAAQD,EAAWH,GAElC,OADA5O,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAUuR,UAAY,SAAUD,EAAc3B,QAC7B,IAAnBA,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAKgP,QAAQuB,EAAc3B,GAGrC,OAFAwC,EAAIkC,QAAQ9P,EAAQ+P,UAAUC,SAAS,KACvCxT,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAUqQ,aAAe,SAAUD,EAAgBT,QAClC,IAAnBS,IAA6BA,EAAiB,SAC3B,IAAnBT,IAA6BA,EAAiB,IAClD,IAAIjK,EAAI0K,EAAe1K,EAAGG,EAAIuK,EAAevK,EAAGF,EAAIyK,EAAezK,EAAGhH,EAAOyR,EAAezR,KAAMoH,EAAKqK,EAAejG,UAAWA,OAAmB,IAAPpE,GAAwBA,EAAIqM,EAAKhC,EAAeuC,eAAgBA,OAAwB,IAAPP,GAAuBA,EAAIQ,EAAO3D,EAAOmB,EAAgB,CAAC,IAAK,IAAK,IAAK,OAAQ,YAAa,mBACxTvJ,EAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQiQ,uBAAuB5B,EAAK6B,WAAa,EAAG7B,EAAK8B,cAAgB,EAAG9B,EAAKU,QAAU,EAAGV,EAAK+B,qBAAkBzR,EAAW0P,EAAKY,qBAAkBtQ,EAAW0P,EAAKgC,gBAAa1R,EAAW0P,EAAKmB,iBAAc7Q,EAAW0P,EAAKoB,kBAAe9Q,GACrP,IAAIqB,EAAQsQ,iBAAiBjC,EAAK6B,WAAa,EAAG7B,EAAK8B,cAAgB,EAAG9B,EAAKU,QAAU,EAAGV,EAAK+B,qBAAkBzR,EAAW0P,EAAKY,qBAAkBtQ,EAAW0P,EAAKgC,gBAAa1R,EAAW0P,EAAKmB,iBAAc7Q,EAAW0P,EAAKoB,kBAAe9Q,GACjP4D,EAAW/F,KAAK8Q,YAAYlC,GAC5BoB,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAGhE,OAFAoL,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,WACN1B,GAEX1B,EAAUrP,UAAUyR,YAAc,SAAUrB,EAAgBT,QACjC,IAAnBS,IAA6BA,EAAiB,SAC3B,IAAnBT,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAKsP,aAAaD,EAAgBT,GAE5C,OADA5O,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAUwQ,SAAW,SAAUD,EAAYZ,QAC9B,IAAfY,IAAyBA,EAAa,SACnB,IAAnBZ,IAA6BA,EAAiB,IAClD,IAAIjK,EAAI6K,EAAW7K,EAAGG,EAAI0K,EAAW1K,EAAGF,EAAI4K,EAAW5K,EAAGhH,EAAO4R,EAAW5R,KAAMoH,EAAKwK,EAAWpG,UAAWA,OAAmB,IAAPpE,GAAwBA,EAAIqM,EAAK7B,EAAWoC,eAAgBA,OAAwB,IAAPP,GAAuBA,EAAIQ,EAAO3D,EAAOsB,EAAY,CAAC,IAAK,IAAK,IAAK,OAAQ,YAAa,mBAC5R1J,GAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQuQ,mBAAmBlC,EAAK9D,QAAU,EAAG8D,EAAKU,QAAU,EAAGV,EAAK+B,gBAAkB,EAAG/B,EAAKY,gBAAkB,EAAGZ,EAAKgC,YAAa,EAAOhC,EAAKmB,YAAc,EAAGnB,EAAKoB,aAAe,EAAIxO,KAAKuP,KAErMjO,EAAW/F,KAAK8Q,YAAYlC,GAC5BoB,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAGhE,OAFAoL,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,OACN1B,GAEX1B,EAAUrP,UAAU0R,QAAU,SAAUnB,EAAYZ,QAC7B,IAAfY,IAAyBA,EAAa,SACnB,IAAnBZ,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAKyP,SAASD,EAAYZ,GAEpC,OADA5O,KAAKmQ,YAAYiB,GACVA,GAGX9C,EAAUrP,UAAU2Q,UAAY,SAAUD,EAAaf,QAC/B,IAAhBe,IAA0BA,EAAc,SACrB,IAAnBf,IAA6BA,EAAiB,IAClD,IAAIjK,EAAIgL,EAAYhL,EAAGG,EAAI6K,EAAY7K,EAAGF,EAAI+K,EAAY/K,EAAGhH,EAAO+R,EAAY/R,KAAMoH,EAAK2K,EAAYvG,UAAWA,OAAmB,IAAPpE,GAAwBA,EAAIqM,EAAK1B,EAAYiC,eAAgBA,OAAwB,IAAPP,GAAuBA,EAAIQ,EAAO3D,EAAOyB,EAAa,CAAC,IAAK,IAAK,IAAK,OAAQ,YAAa,mBACnS7J,EAAW8L,GAAkBxI,GAAapJ,KAAKwO,WAC7C,IAAIhL,EAAQyQ,oBAAoBpC,EAAK9D,aAAU5L,EAAW0P,EAAKqC,WAAQ/R,EAAW0P,EAAKsC,qBAAkBhS,EAAW0P,EAAKuC,sBAAmBjS,EAAW0P,EAAKwC,UAAOlS,GACnK,IAAIqB,EAAQ8Q,cAAczC,EAAK9D,aAAU5L,EAAW0P,EAAKqC,WAAQ/R,EAAW0P,EAAKsC,qBAAkBhS,EAAW0P,EAAKuC,sBAAmBjS,EAAW0P,EAAKwC,UAAOlS,GAC/J4D,EAAW/F,KAAK8Q,YAAYlC,GAC5BoB,EAAOhQ,KAAKkR,WAAWpL,EAAUC,EAAU,CAAEpB,EAAGA,EAAGG,EAAGA,EAAGF,EAAGA,IAGhE,OAFAoL,EAAKpS,KAAOA,GAAQ,WAAaoS,EAAK9L,GACtC8L,EAAK0B,MAAQ,QACN1B,GAEX1B,EAAUrP,UAAU2R,SAAW,SAAUjB,EAAaf,QAC9B,IAAhBe,IAA0BA,EAAc,SACrB,IAAnBf,IAA6BA,EAAiB,IAClD,IAAIwC,EAAMpR,KAAK4P,UAAUD,EAAaf,GAEtC,OADA5O,KAAKmQ,YAAYiB,GACVA,GAEX9C,EAAUrP,UAAU6R,YAAc,SAAUlC,QACjB,IAAnBA,IAA6BA,EAAiB,IAClD,IACI7I,EADAwL,EAAOxT,OAAOwW,KAAK3F,GAAgB,GAOvC,GAAmB,aAAf5O,KAAKuO,MACL,OAAOvO,KAAKyO,gBAAgBvQ,MAChC,OAAQqT,GACJ,IAAK,QACDxL,EAAW,IAAIvC,EAAQgR,kBAAkB5F,EAAe6F,OACxD,MACJ,IAAK,SACD1O,EAAW,IAAIvC,EAAQkR,mBAAmB9F,EAAe+F,QACzD,MACJ,IAAK,WACD5O,EAAW,IAAIvC,EAAQoR,qBAAqBhG,EAAeiG,UAC3D,MACJ,IAAK,UACD9O,EAAW,IAAIvC,EAAQmC,oBAAoBiJ,EAAekG,SAC1D,MACJ,IAAK,QACD/O,EAAW,IAAIvC,EAAQuR,kBAAkBnG,EAAeoG,OACxD,MACJ,IAAK,gBACsC,IAA5BpG,EAAeqG,SACtBlP,EAAW,IAAIvC,EAAQ0R,qBAAqBtG,EAAeqG,WAG3DxR,EAASpE,QAAQ,wFACjB0G,EAAW/F,KAAKyO,gBAAgBvQ,OAEpC,MACJ,IAAK,OACD6H,EAAW,IAAIvC,EAAQ2R,iBAAiBvG,EAAewG,MACvD,MACJ,IAAK,OACDrP,EAAW,IAAIvC,EAAQ6R,kBAAkBzG,EAAe0G,MACxD,MACJ,IAAK,SACDvP,EAAW,IAAIvC,EAAQ+R,eAAe3G,EAAe4G,QACrD,MACJ,IAAK,SACDzP,EAAW6I,EAAe6G,QAAUzV,KAAKyO,gBAAgBvQ,MACzD,MACJ,QACI6H,EAAW/F,KAAKyO,gBAAgBvQ,MAGxC,OAAO6H,GAEJuI,EAtVmB,GAwV9B3R,EAAQ0C,QAAUiP,G,6BC1XlB,IAAI7O,EAAM1B,OAAOkB,UAAUC,eACvBQ,EAAS,IASb,SAASC,KA4BT,SAASC,EAAGC,EAAIC,EAASC,GACvBC,KAAKH,GAAKA,EACVG,KAAKF,QAAUA,EACfE,KAAKD,KAAOA,IAAQ,EActB,SAASE,EAAYC,EAASC,EAAON,EAAIC,EAASC,GAChD,GAAkB,mBAAPF,EACT,MAAM,IAAIO,UAAU,mCAGtB,IAAIC,EAAW,IAAIT,EAAGC,EAAIC,GAAWI,EAASH,GAC1CO,EAAMZ,EAASA,EAASS,EAAQA,EAMpC,OAJKD,EAAQK,QAAQD,GACXJ,EAAQK,QAAQD,GAAKT,GAC1BK,EAAQK,QAAQD,GAAO,CAACJ,EAAQK,QAAQD,GAAMD,GADhBH,EAAQK,QAAQD,GAAKE,KAAKH,IADlCH,EAAQK,QAAQD,GAAOD,EAAUH,EAAQO,gBAI7DP,EAUT,SAASQ,EAAWR,EAASI,GACI,KAAzBJ,EAAQO,aAAoBP,EAAQK,QAAU,IAAIZ,SAC5CO,EAAQK,QAAQD,GAU9B,SAASK,IACPX,KAAKO,QAAU,IAAIZ,EACnBK,KAAKS,aAAe,EAxElB1C,OAAOY,SACTgB,EAAOV,UAAYlB,OAAOY,OAAO,OAM5B,IAAIgB,GAASiB,YAAWlB,GAAS,IA2ExCiB,EAAa1B,UAAU4B,WAAa,WAClC,IACIC,EACAlD,EAFAmD,EAAQ,GAIZ,GAA0B,IAAtBf,KAAKS,aAAoB,OAAOM,EAEpC,IAAKnD,KAASkD,EAASd,KAAKO,QACtBd,EAAIjC,KAAKsD,EAAQlD,IAAOmD,EAAMP,KAAKd,EAAS9B,EAAKoD,MAAM,GAAKpD,GAGlE,OAAIG,OAAOkD,sBACFF,EAAMG,OAAOnD,OAAOkD,sBAAsBH,IAG5CC,GAUTJ,EAAa1B,UAAUkC,UAAY,SAAmBhB,GACpD,IAAIG,EAAMZ,EAASA,EAASS,EAAQA,EAChCiB,EAAWpB,KAAKO,QAAQD,GAE5B,IAAKc,EAAU,MAAO,GACtB,GAAIA,EAASvB,GAAI,MAAO,CAACuB,EAASvB,IAElC,IAAK,IAAIxC,EAAI,EAAGC,EAAI8D,EAASC,OAAQC,EAAK,IAAIC,MAAMjE,GAAID,EAAIC,EAAGD,IAC7DiE,EAAGjE,GAAK+D,EAAS/D,GAAGwC,GAGtB,OAAOyB,GAUTX,EAAa1B,UAAUuC,cAAgB,SAAuBrB,GAC5D,IAAIG,EAAMZ,EAASA,EAASS,EAAQA,EAChCgB,EAAYnB,KAAKO,QAAQD,GAE7B,OAAKa,EACDA,EAAUtB,GAAW,EAClBsB,EAAUE,OAFM,GAYzBV,EAAa1B,UAAUwC,KAAO,SAActB,EAAOuB,EAAIC,EAAIC,EAAIC,EAAIC,GACjE,IAAIxB,EAAMZ,EAASA,EAASS,EAAQA,EAEpC,IAAKH,KAAKO,QAAQD,GAAM,OAAO,EAE/B,IAEIyB,EACA1E,EAHA8D,EAAYnB,KAAKO,QAAQD,GACzB0B,EAAMC,UAAUZ,OAIpB,GAAIF,EAAUtB,GAAI,CAGhB,OAFIsB,EAAUpB,MAAMC,KAAKkC,eAAe/B,EAAOgB,EAAUtB,QAAIsC,GAAW,GAEhEH,GACN,KAAK,EAAG,OAAOb,EAAUtB,GAAGrC,KAAK2D,EAAUrB,UAAU,EACrD,KAAK,EAAG,OAAOqB,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,IAAK,EACzD,KAAK,EAAG,OAAOP,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,IAAK,EAC7D,KAAK,EAAG,OAAOR,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,EAAIC,IAAK,EACjE,KAAK,EAAG,OAAOT,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,EAAIC,EAAIC,IAAK,EACrE,KAAK,EAAG,OAAOV,EAAUtB,GAAGrC,KAAK2D,EAAUrB,QAAS4B,EAAIC,EAAIC,EAAIC,EAAIC,IAAK,EAG3E,IAAKzE,EAAI,EAAG0E,EAAO,IAAIR,MAAMS,EAAK,GAAI3E,EAAI2E,EAAK3E,IAC7C0E,EAAK1E,EAAI,GAAK4E,UAAU5E,GAG1B8D,EAAUtB,GAAGuC,MAAMjB,EAAUrB,QAASiC,OACjC,CACL,IACIM,EADAhB,EAASF,EAAUE,OAGvB,IAAKhE,EAAI,EAAGA,EAAIgE,EAAQhE,IAGtB,OAFI8D,EAAU9D,GAAG0C,MAAMC,KAAKkC,eAAe/B,EAAOgB,EAAU9D,GAAGwC,QAAIsC,GAAW,GAEtEH,GACN,KAAK,EAAGb,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,SAAU,MACpD,KAAK,EAAGqB,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,QAAS4B,GAAK,MACxD,KAAK,EAAGP,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,QAAS4B,EAAIC,GAAK,MAC5D,KAAK,EAAGR,EAAU9D,GAAGwC,GAAGrC,KAAK2D,EAAU9D,GAAGyC,QAAS4B,EAAIC,EAAIC,GAAK,MAChE,QACE,IAAKG,EAAM,IAAKM,EAAI,EAAGN,EAAO,IAAIR,MAAMS,EAAK,GAAIK,EAAIL,EAAKK,IACxDN,EAAKM,EAAI,GAAKJ,UAAUI,GAG1BlB,EAAU9D,GAAGwC,GAAGuC,MAAMjB,EAAU9D,GAAGyC,QAASiC,IAKpD,OAAO,GAYTpB,EAAa1B,UAAUqD,GAAK,SAAYnC,EAAON,EAAIC,GACjD,OAAOG,EAAYD,KAAMG,EAAON,EAAIC,GAAS,IAY/Ca,EAAa1B,UAAUc,KAAO,SAAcI,EAAON,EAAIC,GACrD,OAAOG,EAAYD,KAAMG,EAAON,EAAIC,GAAS,IAa/Ca,EAAa1B,UAAUiD,eAAiB,SAAwB/B,EAAON,EAAIC,EAASC,GAClF,IAAIO,EAAMZ,EAASA,EAASS,EAAQA,EAEpC,IAAKH,KAAKO,QAAQD,GAAM,OAAON,KAC/B,IAAKH,EAEH,OADAa,EAAWV,KAAMM,GACVN,KAGT,IAAImB,EAAYnB,KAAKO,QAAQD,GAE7B,GAAIa,EAAUtB,GAEVsB,EAAUtB,KAAOA,GACfE,IAAQoB,EAAUpB,MAClBD,GAAWqB,EAAUrB,UAAYA,GAEnCY,EAAWV,KAAMM,OAEd,CACL,IAAK,IAAIjD,EAAI,EAAGyD,EAAS,GAAIO,EAASF,EAAUE,OAAQhE,EAAIgE,EAAQhE,KAEhE8D,EAAU9D,GAAGwC,KAAOA,GACnBE,IAASoB,EAAU9D,GAAG0C,MACtBD,GAAWqB,EAAU9D,GAAGyC,UAAYA,IAErCgB,EAAON,KAAKW,EAAU9D,IAOtByD,EAAOO,OAAQrB,KAAKO,QAAQD,GAAyB,IAAlBQ,EAAOO,OAAeP,EAAO,GAAKA,EACpEJ,EAAWV,KAAMM,GAGxB,OAAON,MAUTW,EAAa1B,UAAUsD,mBAAqB,SAA4BpC,GACtE,IAAIG,EAUJ,OARIH,GACFG,EAAMZ,EAASA,EAASS,EAAQA,EAC5BH,KAAKO,QAAQD,IAAMI,EAAWV,KAAMM,KAExCN,KAAKO,QAAU,IAAIZ,EACnBK,KAAKS,aAAe,GAGfT,MAMTW,EAAa1B,UAAUuD,IAAM7B,EAAa1B,UAAUiD,eACpDvB,EAAa1B,UAAUgB,YAAcU,EAAa1B,UAAUqD,GAK5D3B,EAAa8B,SAAW/C,EAKxBiB,EAAaA,aAAeA,EAM1B/D,EAAOD,QAAUgE,G,6BC7UnB5C,OAAOC,eAAerB,EAAS,aAAc,CAAE2B,OAAO,IAEtD,IAAIoX,EAAgB,WAChB,IACI,GAA2B,iBAAhBC,aAA+D,mBAA5BA,YAAYC,YAA4B,CAClF,IAAIC,EAAW,IAAIF,YAAYG,OAAOC,WAAWC,GAAG,EAAK,GAAM,IAAM,IAAM,EAAM,EAAM,EAAM,IAC7F,GAAIH,aAAoBF,YAAYG,OAChC,OAAO,IAAIH,YAAYM,SAASJ,aAAqBF,YAAYM,UAG7E,MAAOrN,IACP,OAAO,EATS,GAWhBsN,EAAkB,SAAUC,EAAKC,GACjC,IAAIC,EAAMC,SAASC,cAAc,UACjCF,EAAIG,OAAS,WACTJ,KAEJC,EAAII,QAAU,WACV,MAAM,IAAIC,MAAM,kBAAoBP,IAExCE,EAAIM,OAAQ,EACZN,EAAIO,IAAMT,EACVG,SAASO,KAAKC,YAAYT,IAS9B1Z,EAAQ0C,QAPa,SAAU8G,EAAMiQ,GAG7BF,EADAR,EACgBvP,EAAO,gBAEPA,EAAO,YAFiB,WAAc,OAAOiQ,S,iBC7BrE,iCAC6B,oBAATW,MAAwBA,MAChC/Z,OACRoF,EAAQuG,SAAS1J,UAAUmD,MAiB/B,SAAS4U,EAAQ9S,EAAI+S,GACnBjX,KAAKkX,IAAMhT,EACXlE,KAAKmX,SAAWF,EAflBta,EAAQ4L,WAAa,WACnB,OAAO,IAAIyO,EAAQ5U,EAAM5E,KAAK+K,WAAY6O,EAAOnV,WAAYoV,eAE/D1a,EAAQ2a,YAAc,WACpB,OAAO,IAAIN,EAAQ5U,EAAM5E,KAAK8Z,YAAaF,EAAOnV,WAAYsV,gBAEhE5a,EAAQ0a,aACR1a,EAAQ4a,cAAgB,SAASC,GAC3BA,GACFA,EAAQC,SAQZT,EAAQ/X,UAAUyY,MAAQV,EAAQ/X,UAAU0Y,IAAM,aAClDX,EAAQ/X,UAAUwY,MAAQ,WACxBzX,KAAKmX,SAAS3Z,KAAK4Z,EAAOpX,KAAKkX,MAIjCva,EAAQib,OAAS,SAASC,EAAMC,GAC9BT,aAAaQ,EAAKE,gBAClBF,EAAKG,aAAeF,GAGtBnb,EAAQsb,SAAW,SAASJ,GAC1BR,aAAaQ,EAAKE,gBAClBF,EAAKG,cAAgB,GAGvBrb,EAAQub,aAAevb,EAAQwb,OAAS,SAASN,GAC/CR,aAAaQ,EAAKE,gBAElB,IAAID,EAAQD,EAAKG,aACbF,GAAS,IACXD,EAAKE,eAAiBxP,YAAW,WAC3BsP,EAAKO,YACPP,EAAKO,eACNN,KAKP,EAAQ,IAIRnb,EAAQ6L,aAAgC,oBAATuO,MAAwBA,KAAKvO,mBAClB,IAAX6P,GAA0BA,EAAO7P,cACxCxI,MAAQA,KAAKwI,aACrC7L,EAAQ2b,eAAkC,oBAATvB,MAAwBA,KAAKuB,qBAClB,IAAXD,GAA0BA,EAAOC,gBACxCtY,MAAQA,KAAKsY,iB,mCC9DvC,6BACI,aAEA,IAAID,EAAO7P,aAAX,CAIA,IAII+P,EA6HIC,EAZAC,EArBAC,EACAC,EAjGJC,EAAa,EACbC,EAAgB,GAChBC,GAAwB,EACxBC,EAAMV,EAAO/B,SAoJb0C,EAAWjb,OAAOkb,gBAAkBlb,OAAOkb,eAAeZ,GAC9DW,EAAWA,GAAYA,EAASzQ,WAAayQ,EAAWX,EAGf,qBAArC,GAAGa,SAAS1b,KAAK6a,EAAOc,SApFxBZ,EAAoB,SAASa,GACzBD,EAAQE,UAAS,WAAcC,EAAaF,QAIpD,WAGI,GAAIf,EAAOkB,cAAgBlB,EAAOmB,cAAe,CAC7C,IAAIC,GAA4B,EAC5BC,EAAerB,EAAOsB,UAM1B,OALAtB,EAAOsB,UAAY,WACfF,GAA4B,GAEhCpB,EAAOkB,YAAY,GAAI,KACvBlB,EAAOsB,UAAYD,EACZD,GAwEJG,GAIAvB,EAAOwB,iBA9CVpB,EAAU,IAAIoB,gBACVC,MAAMH,UAAY,SAASxZ,GAE/BmZ,EADanZ,EAAMwK,OAIvB4N,EAAoB,SAASa,GACzBX,EAAQsB,MAAMR,YAAYH,KA2CvBL,GAAO,uBAAwBA,EAAIxC,cAAc,WAtCpDiC,EAAOO,EAAIiB,gBACfzB,EAAoB,SAASa,GAGzB,IAAIa,EAASlB,EAAIxC,cAAc,UAC/B0D,EAAOC,mBAAqB,WACxBZ,EAAaF,GACba,EAAOC,mBAAqB,KAC5B1B,EAAK2B,YAAYF,GACjBA,EAAS,MAEbzB,EAAK1B,YAAYmD,KAKrB1B,EAAoB,SAASa,GACzB7Q,WAAW+Q,EAAc,EAAGF,KAlD5BV,EAAgB,gBAAkBjU,KAAK2V,SAAW,IAClDzB,EAAkB,SAASxY,GACvBA,EAAMka,SAAWhC,GACK,iBAAflY,EAAMwK,MACyB,IAAtCxK,EAAMwK,KAAKwD,QAAQuK,IACnBY,GAAcnZ,EAAMwK,KAAK3J,MAAM0X,EAAcrX,UAIjDgX,EAAOiC,iBACPjC,EAAOiC,iBAAiB,UAAW3B,GAAiB,GAEpDN,EAAOkC,YAAY,YAAa5B,GAGpCJ,EAAoB,SAASa,GACzBf,EAAOkB,YAAYb,EAAgBU,EAAQ,OAgEnDJ,EAASxQ,aA1KT,SAAsBpC,GAEI,mBAAbA,IACTA,EAAW,IAAIuC,SAAS,GAAKvC,IAI/B,IADA,IAAIrE,EAAO,IAAIR,MAAMU,UAAUZ,OAAS,GAC/BhE,EAAI,EAAGA,EAAI0E,EAAKV,OAAQhE,IAC7B0E,EAAK1E,GAAK4E,UAAU5E,EAAI,GAG5B,IAAImd,EAAO,CAAEpU,SAAUA,EAAUrE,KAAMA,GAGvC,OAFA8W,EAAcD,GAAc4B,EAC5BjC,EAAkBK,GACXA,KA6JTI,EAASV,eAAiBA,EA1J1B,SAASA,EAAec,UACbP,EAAcO,GAyBzB,SAASE,EAAaF,GAGlB,GAAIN,EAGAvQ,WAAW+Q,EAAc,EAAGF,OACzB,CACH,IAAIoB,EAAO3B,EAAcO,GACzB,GAAIoB,EAAM,CACN1B,GAAwB,EACxB,KAjCZ,SAAa0B,GACT,IAAIpU,EAAWoU,EAAKpU,SAChBrE,EAAOyY,EAAKzY,KAChB,OAAQA,EAAKV,QACb,KAAK,EACD+E,IACA,MACJ,KAAK,EACDA,EAASrE,EAAK,IACd,MACJ,KAAK,EACDqE,EAASrE,EAAK,GAAIA,EAAK,IACvB,MACJ,KAAK,EACDqE,EAASrE,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAChC,MACJ,QACIqE,EAAShE,WAnDrB,EAmDsCL,IAiBlB0Y,CAAID,GACN,QACElC,EAAec,GACfN,GAAwB,MAvE5C,CAyLkB,oBAAT/B,UAAyC,IAAXsB,EAAyBrY,KAAOqY,EAAStB,Q,sCCxLhF,IAOI2D,EACAC,EARAxB,EAAUvc,EAAOD,QAAU,GAU/B,SAASie,IACL,MAAM,IAAIlE,MAAM,mCAEpB,SAASmE,IACL,MAAM,IAAInE,MAAM,qCAsBpB,SAASoE,EAAWC,GAChB,GAAIL,IAAqBnS,WAErB,OAAOA,WAAWwS,EAAK,GAG3B,IAAKL,IAAqBE,IAAqBF,IAAqBnS,WAEhE,OADAmS,EAAmBnS,WACZA,WAAWwS,EAAK,GAE3B,IAEI,OAAOL,EAAiBK,EAAK,GAC/B,MAAMnS,GACJ,IAEI,OAAO8R,EAAiBld,KAAK,KAAMud,EAAK,GAC1C,MAAMnS,GAEJ,OAAO8R,EAAiBld,KAAKwC,KAAM+a,EAAK,MAvCnD,WACG,IAEQL,EADsB,mBAAfnS,WACYA,WAEAqS,EAEzB,MAAOhS,GACL8R,EAAmBE,EAEvB,IAEQD,EADwB,mBAAjBtD,aACcA,aAEAwD,EAE3B,MAAOjS,GACL+R,EAAqBE,GAjB7B,GAwEA,IAEIG,EAFAC,EAAQ,GACRC,GAAW,EAEXC,GAAc,EAElB,SAASC,IACAF,GAAaF,IAGlBE,GAAW,EACPF,EAAa3Z,OACb4Z,EAAQD,EAAa9Z,OAAO+Z,GAE5BE,GAAc,EAEdF,EAAM5Z,QACNga,KAIR,SAASA,IACL,IAAIH,EAAJ,CAGA,IAAI1D,EAAUsD,EAAWM,GACzBF,GAAW,EAGX,IADA,IAAIlZ,EAAMiZ,EAAM5Z,OACVW,GAAK,CAGP,IAFAgZ,EAAeC,EACfA,EAAQ,KACCE,EAAanZ,GACdgZ,GACAA,EAAaG,GAAYV,MAGjCU,GAAc,EACdnZ,EAAMiZ,EAAM5Z,OAEhB2Z,EAAe,KACfE,GAAW,EAnEf,SAAyBI,GACrB,GAAIX,IAAuBtD,aAEvB,OAAOA,aAAaiE,GAGxB,IAAKX,IAAuBE,IAAwBF,IAAuBtD,aAEvE,OADAsD,EAAqBtD,aACdA,aAAaiE,GAExB,IAEWX,EAAmBW,GAC5B,MAAO1S,GACL,IAEI,OAAO+R,EAAmBnd,KAAK,KAAM8d,GACvC,MAAO1S,GAGL,OAAO+R,EAAmBnd,KAAKwC,KAAMsb,KAgD7CC,CAAgB/D,IAiBpB,SAASgE,EAAKT,EAAKU,GACfzb,KAAK+a,IAAMA,EACX/a,KAAKyb,MAAQA,EAYjB,SAASC,KA5BTvC,EAAQE,SAAW,SAAU0B,GACzB,IAAIhZ,EAAO,IAAIR,MAAMU,UAAUZ,OAAS,GACxC,GAAIY,UAAUZ,OAAS,EACnB,IAAK,IAAIhE,EAAI,EAAGA,EAAI4E,UAAUZ,OAAQhE,IAClC0E,EAAK1E,EAAI,GAAK4E,UAAU5E,GAGhC4d,EAAMza,KAAK,IAAIgb,EAAKT,EAAKhZ,IACJ,IAAjBkZ,EAAM5Z,QAAiB6Z,GACvBJ,EAAWO,IASnBG,EAAKvc,UAAUwb,IAAM,WACjBza,KAAK+a,IAAI3Y,MAAM,KAAMpC,KAAKyb,QAE9BtC,EAAQwC,MAAQ,UAChBxC,EAAQyC,SAAU,EAClBzC,EAAQ0C,IAAM,GACd1C,EAAQ2C,KAAO,GACf3C,EAAQ4C,QAAU,GAClB5C,EAAQ6C,SAAW,GAInB7C,EAAQ7W,GAAKoZ,EACbvC,EAAQlZ,YAAcyb,EACtBvC,EAAQpZ,KAAO2b,EACfvC,EAAQ3W,IAAMkZ,EACdvC,EAAQjX,eAAiBwZ,EACzBvC,EAAQ5W,mBAAqBmZ,EAC7BvC,EAAQ1X,KAAOia,EACfvC,EAAQ8C,gBAAkBP,EAC1BvC,EAAQ+C,oBAAsBR,EAE9BvC,EAAQhY,UAAY,SAAUvD,GAAQ,MAAO,IAE7Cub,EAAQgD,QAAU,SAAUve,GACxB,MAAM,IAAI8Y,MAAM,qCAGpByC,EAAQiD,IAAM,WAAc,MAAO,KACnCjD,EAAQkD,MAAQ,SAAUC,GACtB,MAAM,IAAI5F,MAAM,mCAEpByC,EAAQoD,MAAQ,WAAa,OAAO,I,0CCgT9BC,E,gQCtZS,EA1Df,wBAGY,KAAAC,YAAsC,GAqDlD,OAjDY,YAAArM,SAAV,SAAmBzB,EAA+BC,QAA/B,IAAAD,MAAA,SAA+B,IAAAC,MAAA,IAChD,IAAMF,EAAQ1O,KAAKtD,QAAQsU,IAAItC,MAAMC,EAAaC,GAElD,OADA5O,KAAKmQ,YAAYzB,EAAOC,GACjBD,GAGC,YAAA+B,UAAV,SAAoBvB,EAAiCN,QAAjC,IAAAM,MAAA,SAAiC,IAAAN,MAAA,IACnD,IAAMK,EAASjP,KAAKtD,QAAQsU,IAAI/B,OAAOC,EAAcN,GAErD,OADA5O,KAAKmQ,YAAYlB,EAAQC,GAClBD,GAGC,YAAAoB,OAAV,SAAiBtB,EAA2BH,QAA3B,IAAAG,MAAA,SAA2B,IAAAH,MAAA,IAC1C,IAAME,EAAM9O,KAAKtD,QAAQsU,IAAIlC,IAAIC,EAAWH,GAE5C,OADA5O,KAAKmQ,YAAYrB,EAAKC,GACfD,GAGC,YAAA0B,UAAV,SAAoBD,EAA4B3B,QAAA,IAAAA,MAAA,IAC9C,IAAM0B,EAAStQ,KAAKtD,QAAQsU,IAAIV,OAAOC,EAAc3B,GAC/C8N,EAAS,EAAH,KAAQnM,GAAY,CAAEoM,KAAM,EAAGC,eAAgB,IAE3D,OADA5c,KAAKmQ,YAAYG,EAAQoM,GAClBpM,GAGC,YAAAI,YAAV,SAAsBrB,EAAqCT,QAArC,IAAAS,MAAA,SAAqC,IAAAT,MAAA,IACzD,IAAMQ,EAAWpP,KAAKtD,QAAQsU,IAAI5B,SAASC,EAAgBT,GAE3D,OADA5O,KAAKmQ,YAAYf,EAAUC,GACpBD,GAGC,YAAAuB,QAAV,SAAkBnB,EAA6BZ,QAA7B,IAAAY,MAAA,SAA6B,IAAAZ,MAAA,IAC7C,IAAMW,EAAOvP,KAAKtD,QAAQsU,IAAIzB,KAAKC,EAAYZ,GAE/C,OADA5O,KAAKmQ,YAAYZ,EAAMC,GAChBD,GAGC,YAAAqB,SAAV,SAAmBjB,EAA+Bf,QAA/B,IAAAe,MAAA,SAA+B,IAAAf,MAAA,IAChD,IAAMc,EAAQ1P,KAAKtD,QAAQsU,IAAItB,MAAMC,EAAaf,GAElD,OADA5O,KAAKmQ,YAAYT,EAAOC,GACjBD,GAGC,YAAAmB,WAAV,SAAqBf,EAA8BlB,QAAA,IAAAA,MAAA,IACjD,IAAM7P,EAASiB,KAAKtD,QAAQsU,IAAInB,QAAQC,EAAelB,GAGvD,OAFA7P,EAAO8d,WAAW,GAClB7c,KAAKmQ,YAAYpR,GACVA,GAEX,EAxDA,G,iNCXA,WAME,cA6VF,OA3VU,YAAA+d,SAAR,SAAiBC,EAASpf,GACxB,YADwB,IAAAA,MAAA,GACjB,IAAI2I,KAAKwD,eACE,KAATiT,aAAC,EAADA,EAAGpY,GAAoBoY,EAAEpY,EAAIhH,OACpB,KAATof,aAAC,EAADA,EAAGjY,GAAoBiY,EAAEjY,EAAInH,OACpB,KAATof,aAAC,EAADA,EAAGnY,GAAoBmY,EAAEnY,EAAIjH,IAIxC,sBAAc,6BAAc,C,IAA5B,sBACE,MAAO,CACLqf,KAAM,SAACC,EAAmBC,GAA4B,SAAKF,KAAKC,EAAMC,IACtEC,MAAO,SAACF,EAAmBC,GAA4B,SAAKC,MAAMF,EAAMC,IACxEE,aAAc,SACZH,EACAC,EACAR,GAIG,SAAKU,aAAaH,EAAMC,EAAYR,IACzCW,MAAO,SACLJ,EACAC,EACAR,GAMG,SAAKW,MAAMJ,EAAMC,EAAYR,IAClCY,OAAQ,SACNL,EACAC,EACAR,GAQG,YARH,IAAAA,MAAA,IAQG,EAAKY,OAAOL,EAAMC,EAAYR,IACnCa,OAAQ,SACNN,EACAC,EACAR,GAOG,YAPH,IAAAA,MAAA,IAOG,EAAKa,OAAON,EAAMC,EAAYR,IACnCc,UAAW,SAACC,EAAoBC,EAAoBC,EAAkBC,GACpE,YADkD,IAAAD,MAAA,SAAkB,IAAAC,MAAA,IACpE,EAAKJ,UAAUC,EAAOC,EAAOC,EAAQC,IACvCC,IAAK,SACHJ,EACAC,EACAhB,GAQG,SAAKmB,IAAIJ,EAAOC,EAAOhB,M,gCAIxB,YAAAoB,aAAR,SACEL,EACAC,EACAzU,EACAmJ,QADA,IAAAnJ,MAAA,CAAgDtE,EAAG,EAAGG,EAAG,EAAGF,EAAG,SAC/D,IAAAwN,OAAA,GAEAnJ,EAAS,GAAEtE,EAAG,EAAGG,EAAG,EAAGF,EAAG,GAAMqE,GAEhC,IAAsBuT,EAAoBuB,EACpCC,EACAC,EACAC,EAIAC,EAAa,IAAI7X,KAAK8X,YAG5B,GAFAD,EAAWE,cAENjM,EAWE,CACL,IAMMkM,EANA,GAtBc9B,EAsBQiB,EAAMzS,oBAAoBiB,YAtBd8R,EAsB2BL,EAAM1S,oBAAoBiB,YArBzF+R,GAAMxB,EAAG7X,IAAMoZ,EAAGpZ,KAAO,EAAIsE,EAAOtE,EACpCsZ,GAAMzB,EAAG1X,IAAMiZ,EAAGjZ,KAAO,EAAImE,EAAOnE,EACpCoZ,GAAM1B,EAAG5X,IAAMmZ,EAAGnZ,KAAO,EAAIqE,EAAOrE,EACjC,IAAI0B,KAAKwD,UAAUkU,EAAIC,EAAIC,IAoB5B,EAAa,IAAI5X,KAAK8X,YAW5B,OAVA,EAAWC,cACX,EAAWE,UAAU,IAEfD,EAAab,EAChBe,2BACAC,UACAC,OAAOhB,EAAM1S,sBAEL0T,OAAO,GAEX,CAAEJ,WAAYA,EAAYH,WAAY,GAf7C,OARAA,EAAWI,UAAU,IAAIjY,KAAKwD,UAAUb,EAAOtE,EAAGsE,EAAOnE,EAAGmE,EAAOrE,IAQ5D,CAAE0Z,WANHA,EAAab,EAChBe,2BACAC,UACAC,OAAOhB,EAAM1S,qBACb0T,OAAOP,GAEuBA,WAAYA,IAmBzC,YAAAnB,KAAR,SAAaS,EAAoBC,GAC/B,IAAMiB,EAAO,CAAEha,EAAG,EAAGG,EAAG,EAAGF,EAAG,GAC9B,OAAO5E,KAAK6d,IAAIJ,EAAOC,EAAO,CAAEkB,kBAAmBD,EAAME,kBAAmBF,KAGtE,YAAAxB,MAAR,SAAcM,EAAoBC,GAChC,IAAM7S,EAAY7K,KAAK8d,aAAaL,EAAMzU,KAAM0U,EAAM1U,MACtD6B,EAAUyT,WAAWnT,YAAYsS,EAAMzU,KAAKgC,oBAAoBS,eAChEZ,EAAUsT,WAAWhT,YAAYuS,EAAM1U,KAAKgC,oBAAoBS,eAChE,IAAMqT,EAAa,IAAIxY,KAAKyY,kBAAkBtB,EAAMzU,KAAM0U,EAAM1U,KAAM6B,EAAUyT,WAAYzT,EAAUsT,YAEtG,OADAne,KAAKgf,aAAaC,cAAcH,GACzBA,GAGD,YAAA1B,aAAR,SACEH,EACAC,EACAR,QAAA,IAAAA,MAAA,IAKQ,IAAAwC,EAAA,EAAAA,OAAQC,EAAA,EAAAA,OACVC,EAAU,IAAI9Y,KAAKwD,WAAUoV,aAAM,EAANA,EAAQva,IAAK,GAAGua,aAAM,EAANA,EAAQpa,IAAK,GAAGoa,aAAM,EAANA,EAAQta,IAAK,GAC1Eya,EAAgB,IAAI/Y,KAAKwD,WAAUqV,aAAM,EAANA,EAAQxa,IAAK,GAAGwa,aAAM,EAANA,EAAQra,IAAK,GAAGqa,aAAM,EAANA,EAAQva,IAAK,GAChFka,EAAa,IAAIxY,KAAKgZ,wBAAwBrC,EAAKjU,KAAMkU,EAAWlU,KAAMoW,EAASC,GAEzF,OADArf,KAAKgf,aAAaC,cAAcH,GACzBA,GAGD,YAAAzB,MAAR,SACEJ,EACAC,EACAR,QAAA,IAAAA,MAAA,IAOQ,IAAAwC,EAAA,EAAAA,OAAQC,EAAA,EAAAA,OAAQI,EAAA,EAAAA,MAAOC,EAAA,EAAAA,MACzBJ,EAAU,IAAI9Y,KAAKwD,WAAUoV,aAAM,EAANA,EAAQva,IAAK,GAAGua,aAAM,EAANA,EAAQpa,IAAK,GAAGoa,aAAM,EAANA,EAAQta,IAAK,GAC1Eya,EAAgB,IAAI/Y,KAAKwD,WAAUqV,aAAM,EAANA,EAAQxa,IAAK,GAAGwa,aAAM,EAANA,EAAQra,IAAK,GAAGqa,aAAM,EAANA,EAAQva,IAAK,GAChF6a,EAAS,IAAInZ,KAAKwD,WAAUyV,aAAK,EAALA,EAAO5a,IAAK,GAAG4a,aAAK,EAALA,EAAOza,IAAK,GAAGya,aAAK,EAALA,EAAO3a,IAAK,GACtE8a,EAAe,IAAIpZ,KAAKwD,WAAU0V,aAAK,EAALA,EAAO7a,IAAK,GAAG6a,aAAK,EAALA,EAAO1a,IAAK,GAAG0a,aAAK,EAALA,EAAO5a,IAAK,GAC5Eka,EAAa,IAAIxY,KAAKqZ,kBAC1B1C,EAAKjU,KACLkU,EAAWlU,KACXoW,EACAC,EACAI,EACAC,GACA,GAGF,OADA1f,KAAKgf,aAAaC,cAAcH,GACzBA,GAID,YAAAxB,OAAR,SACEG,EACAC,EACAhB,QAAA,IAAAA,MAAA,IASA,IAAM7R,EAAY7K,KAAK8d,aAAaL,EAAMzU,KAAM0U,EAAM1U,MAGpD,IAAA2U,cAAA,IAAS,EAAT,KACA,IAAAC,cAAA,IAAS,EAAT,KACA,IAAAgC,iBAAA,iBACA,IAAAC,iBAAA,iBACA,IAAAjB,kBAAA,iBACA,IAAAC,kBAAA,iBAGIiB,EAAYjV,EAAUyT,WAAW7S,cACvCqU,EAAUC,YAAYpC,EAAOhZ,GAAK,EAAGgZ,EAAO7Y,GAAK,EAAG6Y,EAAO/Y,GAAK,GAChEiG,EAAUyT,WAAWnT,YAAY2U,GAEjC,IAAME,EAAYnV,EAAUsT,WAAW1S,cACvCuU,EAAUD,YAAYnC,EAAOjZ,GAAK,EAAGiZ,EAAO9Y,GAAK,EAAG8Y,EAAOhZ,GAAK,GAChEiG,EAAUsT,WAAWhT,YAAY6U,GAEjC,IAAMlB,EAAa,IAAIxY,KAAK2Z,mBAC1BxC,EAAMzU,KACN0U,EAAM1U,KACN6B,EAAUyT,WACVzT,EAAUsT,YACV,GASF,OANAW,EAAWoB,iBAAiBC,GAC5BrB,EAAWsB,iBAAiBC,GAC5BvB,EAAWwB,iBAAiBC,GAC5BzB,EAAW0B,iBAAiBC,GAE5BzgB,KAAKgf,aAAaC,cAAcH,GACzBA,GAGD,YAAAvB,OAAR,SACEN,EACAC,EACAR,QAAA,IAAAA,MAAA,IASE,QAAAgE,iBAAA,IAAY,EAAZ,KACA,IAAAC,eAAA,IAAU,EAAV,MACA,IAAAC,mBAAA,IAAc,GAAd,EACA,IAAAhB,iBAAA,kBACA,IAAAC,iBAAA,kBAGIhV,EAAY7K,KAAK8d,aAAab,EAAKjU,KAAMkU,EAAWlU,MACpD8V,EAAa,IAAIxY,KAAKua,8BAC1B5D,EAAKjU,KACLkU,EAAWlU,KACX6B,EAAUyT,WACVzT,EAAUsT,YACV,GAGFne,KAAK6J,aAAayB,SAAS6U,EAAIxb,GAAK,EAAGwb,EAAIrb,GAAK,EAAGqb,EAAIvb,GAAK,GAC5Dka,EAAWgC,oBAAoB9gB,KAAK6J,cAEpC7J,KAAK6J,aAAayB,SAAS+U,EAAI1b,GAAK,EAAG0b,EAAIvb,GAAK,EAAGub,EAAIzb,GAAK,GAC5Dka,EAAWiC,oBAAoB/gB,KAAK6J,cAEhC+W,IACF5gB,KAAK6J,aAAayB,SAAS,EAAG,EAAG,GACjCwT,EAAWkC,qBAAqBhhB,KAAK6J,cACrCiV,EAAWmC,qBAAqBjhB,KAAK6J,eAGvC,IAAK,IAAIxM,EAAI,EAAGA,EAAI,EAAGA,IACrByhB,EAAWoC,aAAa7jB,GAAG,GAC3ByhB,EAAWqC,aAAa9jB,EAAGqjB,GAC3B5B,EAAWsC,WAAW/jB,EAAGsjB,GAQ3B,OAFA3gB,KAAKgf,aAAaC,cAAcH,GAEzBA,GAGD,YAAAtB,UAAR,SAAkBC,EAAoBC,EAAoBC,EAAkBC,QAAlB,IAAAD,MAAA,SAAkB,IAAAC,MAAA,IAC1E,IAAMyD,EAAW,IAAI/a,KAAK8X,YAC1BiD,EAAShD,cACTgD,EAASpV,YAAYX,UAASqS,aAAM,EAANA,EAAQhZ,IAAK,GAAGgZ,aAAM,EAANA,EAAQ7Y,IAAK,GAAG6Y,aAAM,EAANA,EAAQ/Y,IAAK,GAE3E,IAAM0c,EAAW,IAAIhb,KAAK8X,YAC1BkD,EAASjD,cACTiD,EAASrV,YAAYX,UAASsS,aAAM,EAANA,EAAQjZ,IAAK,GAAGiZ,aAAM,EAANA,EAAQ9Y,IAAK,GAAG8Y,aAAM,EAANA,EAAQhZ,IAAK,GAEjE5E,KAAK8d,aAAaL,EAAMzU,KAAM0U,EAAM1U,MAA9C,IAEM8V,EAAa,IAAIxY,KAAKib,sBAAsB7D,EAAM1U,KAAMyU,EAAMzU,KAAMqY,EAAUC,GASpF,OAJAxC,EAAW0C,gBAAe,GAE1BxhB,KAAKgf,aAAaC,cAAcH,GAEzBA,GAGD,YAAAjB,IAAR,SACEJ,EACAC,EACAhB,QAAA,IAAAA,MAAA,IASQ,IAAAzT,EAAA,EAAAA,OAAQ,IAAAmJ,cAAA,IAAS,GAAT,EACV5P,EAAM,GAAEmC,EAAG,EAAGG,EAAG,EAAGF,EAAG,GAAMqE,GAE7B4B,EAAY7K,KAAK8d,aAAaL,EAAMzU,KAAM0U,EAAM1U,KAAMxG,EAAK4P,GAE3D0M,EAAa,IAAIxY,KAAKmb,wBAC1BhE,EAAMzU,KACN0U,EAAM1U,KACN6B,EAAUyT,WACVzT,EAAUsT,YACV,GAGMyB,EAAA,EAAAA,iBAAkBC,EAAA,EAAAA,iBAAkBjB,EAAA,EAAAA,kBAAmBC,EAAA,EAAAA,kBAEzDsB,EAAMngB,KAAK8c,SAAS8C,GACpBS,EAAMrgB,KAAK8c,SAAS+C,GACpBU,EAAMvgB,KAAK8c,SAAS8B,GAAoBna,KAAKuP,IAC7CyM,EAAMzgB,KAAK8c,SAAS+B,EAAmBpa,KAAKuP,IAclD,OAZA8K,EAAWgC,oBAAoBX,GAC/BrB,EAAWiC,oBAAoBV,GAC/BvB,EAAWkC,qBAAqBT,GAChCzB,EAAWmC,qBAAqBR,GAEhCna,KAAKob,QAAQvB,GACb7Z,KAAKob,QAAQrB,GACb/Z,KAAKob,QAAQnB,GACbja,KAAKob,QAAQjB,GAEbzgB,KAAKgf,aAAaC,cAAcH,GAAY,GAErCA,GAEX,EAnWA,G,sUCHA,yB,+CAsBA,OAtBoC,OAIxB,YAAA6C,YAAV,SACEC,EACAC,EACAC,GAEKF,EAAQ3E,MAAS4E,EAAQ5E,OAE9B2E,EAAQ3E,KAAK9T,iBAAkB,EAC/B0Y,EAAQ5E,KAAK9T,iBAAkB,EAE/BnJ,KAAKsC,GAAG,aAAa,SAAAqI,G,QACXC,EAAA,EAAAA,OAAQzK,EAAA,EAAAA,OACH,QAAT,EAAAyK,EAAO,UAAE,eAAEhN,QAAiB,QAAb,EAAIgN,EAAO,UAAE,eAAEhN,QAAQgkB,aAAO,EAAPA,EAAShkB,QAAQikB,aAAO,EAAPA,EAASjkB,QAC9DgN,EAAO,GAAGhN,OAASgkB,EAAQhkB,MAAQgN,EAAO,GAAGhN,OAASikB,EAAQjkB,MACzDgN,EAAO,GAAGhN,OAASgkB,EAAQhkB,MAAQgN,EAAO,GAAGhN,OAASikB,EAAQjkB,OADCkkB,EAAc3hB,QAK9F,EAtBA,CAAoC,K,OCY9B4hB,EAEW,EAFXA,EAiBO,MA2JE,EApJf,WAQE,WAAmBxT,EAAqByT,EAAqCC,QAAA,IAAAA,MAAA,IAA1D,KAAA1T,QAAqB,KAAAyT,QAAqC,KAAAC,UAC3EjiB,KAAKkiB,cAAgBD,EAAQC,eAAiBH,EAC9C,IAAMI,EAAYniB,KAAKkiB,cAAgBH,IAAgC,EACjEK,EAAgBH,EAAQG,eAAiB,IAE/CpiB,KAAK8F,SAAW,IAAI,iBACpB,IAAMuc,EAAW,IAAIC,aAA6B,EAAhBF,GAC5BG,EAAS,IAAID,aAA6B,EAAhBF,GAchCpiB,KAAK8F,SAAS0c,aAAa,WAAY,IAAI,kBAAgBH,EAAU,GAAGI,SAAS,oBACjFziB,KAAK8F,SAAS0c,aAAa,QAAS,IAAI,kBAAgBD,EAAQ,GAAGE,SAAS,oBAE5EziB,KAAK0iB,MAAQ,EAEb,IAAM3c,EAAW,IAAI,oBAAkB,CACrC4c,cAAc,EACdC,WAAYT,IAGdniB,KAAKgQ,KAAO,IAAI,eAAahQ,KAAK8F,SAAUC,GACxCoc,IAAWniB,KAAKgQ,KAAK6S,YAAc,KACvC7iB,KAAKgQ,KAAK8S,eAAgB,EAE1B9iB,KAAK+iB,SAAU,EAEf/iB,KAAKgjB,YAAc,IAAI1c,KAAK2c,YAC5BjjB,KAAKgjB,YAAYE,SAAWljB,KAAKkjB,SAASrkB,KAAKmB,MAC/CA,KAAKgjB,YAAYG,iBAAmBnjB,KAAKmjB,iBAAiBtkB,KAAKmB,MAC/DA,KAAKgjB,YAAYI,mBAAqBpjB,KAAKojB,mBAAmBvkB,KAAKmB,MACnEA,KAAKgjB,YAAYK,WAAarjB,KAAKqjB,WAAWxkB,KAAKmB,MACnDA,KAAKgjB,YAAYM,aAAetjB,KAAKsjB,aAAazkB,KAAKmB,MACvDA,KAAKgjB,YAAYO,aAAevjB,KAAKujB,aAAa1kB,KAAKmB,MAEvDA,KAAKgiB,MAAMwB,eAAexjB,KAAKgjB,aA6FnC,OA1FE,YAAAS,OAAA,WACEzjB,KAAK+iB,SAAU,EACf/iB,KAAKuO,MAAMyC,IAAIhR,KAAKgQ,OAGtB,YAAA0T,QAAA,WACE1jB,KAAK+iB,SAAU,EACf/iB,KAAKuO,MAAMoV,OAAO3jB,KAAKgQ,OAGzB,YAAAzF,OAAA,WACOvK,KAAK+iB,UAIQ,GAAd/iB,KAAK0iB,QAEP1iB,KAAK8F,SAAS8d,WAAWzS,SAAS0S,aAAc,EAEhD7jB,KAAK8F,SAAS8d,WAAWhe,MAAMie,aAAc,GAG/C7jB,KAAK0iB,MAAQ,EACb1iB,KAAKgiB,MAAM8B,iBACX9jB,KAAK8F,SAASie,aAAa,EAAG/jB,KAAK0iB,SAGrC,YAAAQ,SAAA,SAASc,EAAWC,EAASre,GAE3B,IAAMse,EAAO5d,KAAK6d,QACZhmB,EAAI+lB,GAAMte,EAAQ,GAAK,GACvB8C,EAAIwb,GAAMte,EAAQ,GAAK,GACvB1C,EAAIghB,GAAMte,EAAQ,GAAK,GAEvBwe,EAAQF,GAAMF,EAAO,GAAK,GAC1BK,EAAQH,GAAMF,EAAO,GAAK,GAC1BM,EAAQJ,GAAMF,EAAO,GAAK,GAChChkB,KAAK8F,SAAS8d,WAAWzS,SAASoT,OAAOvkB,KAAK0iB,MAAO0B,EAAOC,EAAOC,GACnEtkB,KAAK8F,SAAS8d,WAAWhe,MAAM2e,OAAOvkB,KAAK0iB,QAASvkB,EAAGuK,EAAGxF,GAE1D,IAAMshB,EAAMN,GAAMD,EAAK,GAAK,GACtBQ,EAAMP,GAAMD,EAAK,GAAK,GACtBS,EAAMR,GAAMD,EAAK,GAAK,GAC5BjkB,KAAK8F,SAAS8d,WAAWzS,SAASoT,OAAOvkB,KAAK0iB,MAAO8B,EAAKC,EAAKC,GAC/D1kB,KAAK8F,SAAS8d,WAAWhe,MAAM2e,OAAOvkB,KAAK0iB,QAASvkB,EAAGuK,EAAGxF,IAI5D,YAAAigB,iBAAA,SAAiBwB,EAAeC,EAAgBC,EAAeC,EAAgBlf,GAE7E,IAAMse,EAAO5d,KAAK6d,QACZhmB,EAAI+lB,GAAMte,EAAQ,GAAK,GACvB8C,EAAIwb,GAAMte,EAAQ,GAAK,GACvB1C,EAAIghB,GAAMte,EAAQ,GAAK,GAEvBjB,EAAIuf,GAAMS,EAAW,GAAK,GAC1B7f,EAAIof,GAAMS,EAAW,GAAK,GAC1B/f,EAAIsf,GAAMS,EAAW,GAAK,GAChC3kB,KAAK8F,SAAS8d,WAAWzS,SAASoT,OAAOvkB,KAAK0iB,MAAO/d,EAAGG,EAAGF,GAC3D5E,KAAK8F,SAAS8d,WAAWhe,MAAM2e,OAAOvkB,KAAK0iB,QAASvkB,EAAGuK,EAAGxF,GAE1D,IAAM8a,EAAKkG,GAAMU,EAAY,GAAK,GAAKC,EACjC5G,EAAKiG,GAAMU,EAAY,GAAK,GAAKC,EACjC3G,EAAKgG,GAAMU,EAAY,GAAK,GAAKC,EACvC7kB,KAAK8F,SAAS8d,WAAWzS,SAASoT,OAAOvkB,KAAK0iB,MAAO/d,EAAIqZ,EAAIlZ,EAAImZ,EAAIrZ,EAAIsZ,GACzEle,KAAK8F,SAAS8d,WAAWhe,MAAM2e,OAAOvkB,KAAK0iB,QAASvkB,EAAGuK,EAAGxF,IAG5D,YAAAkgB,mBAAA,SAAmB2B,GACbze,KAAKpH,eAAe,qBAEtBK,QAAQylB,KAAK1e,KAAK2e,kBAAkBF,IAC1B/kB,KAAKklB,aACfllB,KAAKklB,YAAa,EAClB3lB,QAAQylB,KAAK,2EAIjB,YAAA3B,WAAA,SAAW8B,EAAgBC,GAEzB7lB,QAAQylB,KAAK,qBAGf,YAAA1B,aAAA,SAAa+B,GACXrlB,KAAKkiB,cAAgBmD,GAGvB,YAAA9B,aAAA,WACE,OAAOvjB,KAAKkiB,eAEhB,EAlJA,GJNMoD,EAAsB,SAAUC,EAA0BC,GAE9DxlB,KAAKulB,gBAAkBA,GAAmB,IAE1CvlB,KAAKwlB,WAAaA,GAAc,KAGhCxlB,KAAKylB,UAAY,IAAI,QAErBzlB,KAAK0lB,WAAa,IAAI,QAEtB1lB,KAAK2lB,WAAa,IAAI,QAEtB3lB,KAAK4lB,cAAgB,IAAI,QAEzB5lB,KAAK6lB,QAAU,IAAI,UAEnB7lB,KAAK8lB,QAAU,IAAI,UAEnB9lB,KAAK+lB,YAAc,IAAI,UAEvB/lB,KAAKgmB,cAAgB,IAAI,UAEzBhmB,KAAKimB,cAAgB,IAAI,UAEzBjmB,KAAKkmB,eAAiB,IAAI,UAE1BlmB,KAAKmmB,eAAiB,IAAI,UAE1BnmB,KAAKomB,eAAiB,IAAI,UAE1BpmB,KAAKqmB,eAAiB,IAAI,UAE1BrmB,KAAKsmB,eAAiB,IAAI,UAE1BtmB,KAAKumB,eAAiB,IAAI,UAE1BvmB,KAAKwmB,eAAiB,IAAI,UAE1BxmB,KAAKymB,kBAAoB,CAAE7E,QAAS,KAAMC,QAAS,MAGnD7hB,KAAK0mB,SAAW,GAGhB,IAFA,IAESrpB,EAAI,EAAGA,EAFR,IAEeA,IAAK2C,KAAK0mB,SAASrpB,IAAK,GAGjDioB,EAAoBrmB,UAAY,CAC9BoE,YAAaiiB,EAEbqB,uBAAwB,SAAU5nB,EAAa4d,EAAWpQ,EAAeK,EAAsBxD,GAKxFrK,EAAO+G,SAAS8gB,kBACnBrnB,QAAQC,MAAM,oGAGhB,IAAIqnB,EAAW9nB,EAAO8nB,SACtBA,EAASlK,KAAOA,EAChBkK,EAASta,SAAWA,EAASua,QAC7BD,EAASja,gBAAkBA,EAAgBka,QAC3CD,EAASzd,UAAYA,GASvB2d,kBAAmB,SACjBhoB,EACAioB,EACArS,EACAsS,EACAC,GAEA,IAAIC,EAAc,GAEdzB,EAAa1lB,KAAK0lB,WAClBC,EAAa3lB,KAAK2lB,WAEtB3lB,KAAK+lB,YAAYqB,WAAWJ,EAAerS,GAC3C+Q,EAAW2B,sBAAsBL,EAAejoB,EAAOoS,SAAUnR,KAAK+lB,aAEtE,IAAIuB,EAAqBJ,EAAsBD,EAE3C7P,EAAQpX,KAoDZ,OAlDA,SAASunB,EAAgBC,EAAgBC,EAAiBC,EAAeC,GACvE,GAAIljB,KAAK2V,SAA2B,IAAhBuN,GAAwBA,EAAgBL,EAC1DH,EAAO3mB,KAAKgnB,OADd,CAMA,IAAI1b,EAAQrH,KAAKuP,GAEK,IAAlB2T,GACFhC,EAAWhR,OAAOiT,KAAKlC,EAAW/Q,QAClCgR,EAAWkC,SAAWnC,EAAWmC,UAE7BF,GAAiBV,GACnBnb,GAAS4b,EAAWD,IAAe,GAAM,GAAMhjB,KAAK2V,UAAYqN,EAGhErQ,EAAM4O,cAAc4B,KAAK7oB,EAAOoS,UAAU2W,IAAId,GAAee,eAAepT,EAAQ7I,GAAOkF,IAAIgW,GAC/FrB,EAAW0B,sBAAsBL,EAAe5P,EAAM2O,YAAa3O,EAAM4O,iBAEzEla,GAAS,IAAuB,EAAhB6b,GAAqB,IAAO,EAAIljB,KAAK2V,WAAa3V,KAAKuP,GAGvEoD,EAAM4O,cACH4B,KAAKZ,GACLc,IAAIN,EAAUrW,UACd4W,eAAepT,EAAQ7I,GACvBkF,IAAIwW,EAAUrW,UACjBiG,EAAM6O,cAAc2B,KAAKjT,GAAQ3D,IAAIwW,EAAUrW,UAC/CwU,EAAW0B,sBAAsBG,EAAUrW,SAAUiG,EAAM6O,cAAe7O,EAAM4O,gBAKpF5O,EAAM4Q,WAAWR,EAAW7B,EAAYvO,EAAMqP,mBAE9C,IAAIwB,EAAO7Q,EAAMqP,kBAAkB7E,QAC/BsG,EAAO9Q,EAAMqP,kBAAkB5E,QAE/BoG,GACFV,EAAgBU,EAAMR,EAAY3b,EAAO6b,EAAgB,GAGvDO,GACFX,EAAgBW,EAAMpc,EAAO4b,EAAUC,EAAgB,IAI3DJ,CAAgBxoB,EAAQ,EAAG,EAAI0F,KAAKuP,GAAI,GAEjCmT,GAGTa,WAAY,SAAUjpB,EAAa2P,EAAYyZ,GAM7C,IAAIriB,EAAW/G,EAAO+G,SAClBsiB,EAAStiB,EAAS8d,WAAWzS,SAASsK,MACtC4M,EAAUviB,EAAS8d,WAAWjP,OAAO8G,MAErC6M,EAAYF,EAAO/mB,OAAS,EAC5BknB,EAAWD,EAAY,EAEvBE,EAAU1iB,EAAS2iB,WAOvB,SAASC,EAAeC,EAAcC,GAGpC,IAAIC,EAAgB,EAAVF,EAAcC,EAExB,OAAOJ,EAAUA,EAAQK,GAAOA,EAV9BL,IAEFD,GADAC,EAAUA,EAAQ/M,OACCpa,OAAS,GAkB9B,IAPA,IAAIynB,EAAU,GACVC,EAAU,GAEVC,EAAQhpB,KAAKwlB,WAGbyD,EAAgBX,EAAYA,EACvBjrB,EAAI,EAAGA,EAAI4rB,EAAe5rB,IAAK2C,KAAK0mB,SAASrpB,IAAK,EAE3D,IAAI6rB,EAAKlpB,KAAKkmB,eACViD,EAAKnpB,KAAKmmB,eACViD,EAAKppB,KAAKqmB,eACVgD,EAAKrpB,KAAKsmB,eAGd,IAASjpB,EAAI,EAAGA,EAAIkrB,EAAW,EAAGlrB,IAAK,CACrC,IAAIqE,EAAKgnB,EAAerrB,EAAG,GACvBisB,EAAKZ,EAAerrB,EAAG,GACvBksB,EAAKb,EAAerrB,EAAG,GAG3B+rB,EAAGjf,IAAIke,EAAQ3mB,GAAK2mB,EAAQ3mB,GAAM,EAAG2mB,EAAQ3mB,GAAM,GAEnD,IAAK,IAAIW,EAAIhF,EAAI,EAAGgF,EAAIkmB,EAAUlmB,IAAK,CACrC,IAAIV,EAAK+mB,EAAermB,EAAG,GACvBmnB,EAAKd,EAAermB,EAAG,GACvBonB,EAAKf,EAAermB,EAAG,GAG3BgnB,EAAGlf,IAAIke,EAAQ1mB,GAAK0mB,EAAQ1mB,GAAM,EAAG0mB,EAAQ1mB,GAAM,GAEpC,EAAIynB,EAAGM,IAAIL,GAAML,IAG1BtnB,IAAOC,GAAMD,IAAO8nB,GAAM9nB,IAAO+nB,EAC/BH,IAAO3nB,GAAM2nB,IAAOE,GAAMF,IAAOG,GACnCzpB,KAAK0mB,SAAShlB,EAAK4mB,EAAYgB,IAAM,EACrCtpB,KAAK0mB,SAAS4C,EAAKhB,EAAY5mB,IAAM,IAErC1B,KAAK0mB,SAAS6C,EAAKjB,EAAY5mB,IAAM,EACrC1B,KAAK0mB,SAAShlB,EAAK4mB,EAAYiB,IAAM,GAE9BD,IAAO3nB,GAAM2nB,IAAOE,GAAMF,IAAOG,IAC1CzpB,KAAK0mB,SAAS6C,EAAKjB,EAAYgB,IAAM,EACrCtpB,KAAK0mB,SAAS4C,EAAKhB,EAAYiB,IAAM,KAO7C,IAAII,EAAa3pB,KAAK4lB,cACtB7mB,EAAO6qB,eACPtE,EAAoBuE,2BAA2Bnb,EAAO3P,EAAO+qB,OAAQH,GAGrE,IAAStsB,EAAI,EAAGA,EAAIkrB,EAAUlrB,IAK5B,IAJA,IAAI0sB,EAAKrB,EAAerrB,EAAG,GACvB2sB,EAAKtB,EAAerrB,EAAG,GACvB4sB,EAAKvB,EAAerrB,EAAG,GAElB6sB,EAAU,EAAGA,EAAU,EAAGA,IAAW,CAC5C,IAAIC,EAAiB,IAAZD,EAAgBH,EAAiB,IAAZG,EAAgBF,EAAKC,EAC/CG,EAAiB,IAAZF,EAAgBF,EAAiB,IAAZE,EAAgBD,EAAKF,EAInD,IAFmB/pB,KAAK0mB,SAASyD,EAAK7B,EAAY8B,GAElD,CAGApqB,KAAK0mB,SAASyD,EAAK7B,EAAY8B,IAAM,EACrCpqB,KAAK0mB,SAAS0D,EAAK9B,EAAY6B,IAAM,EAErCjB,EAAG/e,IAAIie,EAAO,EAAI+B,GAAK/B,EAAO,EAAI+B,EAAK,GAAI/B,EAAO,EAAI+B,EAAK,IAC3DhB,EAAGhf,IAAIie,EAAO,EAAIgC,GAAKhC,EAAO,EAAIgC,EAAK,GAAIhC,EAAO,EAAIgC,EAAK,IAG3D,IAAIC,EAAQ,GAER1sB,EAAIgsB,EAAWW,gBAAgBpB,IAE3BF,GACNqB,EAAQ,EACRtB,EAAQvoB,KAAK0oB,EAAGpC,UACPnpB,GAAKqrB,GACdqB,EAAQ,EACRvB,EAAQtoB,KAAK0oB,EAAGpC,WAEhBuD,EAAQ,EACRvB,EAAQtoB,KAAK0oB,EAAGpC,SAChBiC,EAAQvoB,KAAK0oB,EAAGpC,UAIlB,IAEInpB,EAFA4sB,EAAQ,EAgBZ,IAdI5sB,EAAIgsB,EAAWW,gBAAgBnB,IAE3BH,GACNuB,EAAQ,EACRxB,EAAQvoB,KAAK2oB,EAAGrC,UACPnpB,GAAKqrB,GACduB,EAAQ,EACRzB,EAAQtoB,KAAK2oB,EAAGrC,WAEhByD,EAAQ,EACRzB,EAAQtoB,KAAK2oB,EAAGrC,SAChBiC,EAAQvoB,KAAK2oB,EAAGrC,UAGH,IAAVuD,GAAyB,IAAVE,GAA2B,IAAVF,GAAyB,IAAVE,EAAc,CAGhEvqB,KAAKylB,UAAU7d,MAAMggB,KAAKsB,GAC1BlpB,KAAKylB,UAAU+E,IAAI5C,KAAKuB,GAExB,IAAIsB,EAAe,IAAI,UAGvB,QAAqBtoB,KAFrBsoB,EAAed,EAAWe,cAAc1qB,KAAKylB,UAAWgF,IAOtD,OAHAlrB,QAAQC,MAAM,qDACd2oB,EAAOwC,iBAAmB,KAC1BxC,EAAOyC,iBAAmB,KACnB,EAGT9B,EAAQtoB,KAAKiqB,GACb1B,EAAQvoB,KAAKiqB,EAAa3D,WAMhC,IAAI+D,EAAiC,GAAvB9rB,EAAO8nB,SAASlK,KAG9B3c,KAAK6lB,QAAQ1b,IAAI,EAAG,EAAG,GACvB,IAAI2gB,EAAU,EACVC,EAAajC,EAAQznB,OAEzB,GAAI0pB,EAAa,EAAG,CAClB,IAAS1tB,EAAI,EAAGA,EAAI0tB,EAAY1tB,IAAK2C,KAAK6lB,QAAQ7U,IAAI8X,EAAQzrB,IAE9D2C,KAAK6lB,QAAQmF,aAAaD,GAC1B,IAAS1tB,EAAI,EAAGA,EAAI0tB,EAAY1tB,IAAK,EAC/B8B,EAAI2pB,EAAQzrB,IACdyqB,IAAI9nB,KAAK6lB,SACXiF,EAAUrmB,KAAKwmB,IAAIH,EAAS3rB,EAAEwF,EAAGxF,EAAE2F,EAAG3F,EAAEyF,GAE1C5E,KAAK6lB,QAAQ7U,IAAIjS,EAAOoS,UAG1BnR,KAAK8lB,QAAQ3b,IAAI,EAAG,EAAG,GACvB,IAAI+gB,EAAU,EACVC,EAAapC,EAAQ1nB,OACzB,GAAI8pB,EAAa,EAAG,CAClB,IAAS9tB,EAAI,EAAGA,EAAI8tB,EAAY9tB,IAAK2C,KAAK8lB,QAAQ9U,IAAI+X,EAAQ1rB,IAE9D2C,KAAK8lB,QAAQkF,aAAaG,GAC1B,IAAS9tB,EAAI,EAAGA,EAAI8tB,EAAY9tB,IAAK,CACnC,IAAI8B,KAAI4pB,EAAQ1rB,IACdyqB,IAAI9nB,KAAK8lB,SACXoF,EAAUzmB,KAAKwmB,IAAIC,EAAS/rB,EAAEwF,EAAGxF,EAAE2F,EAAG3F,EAAEyF,GAE1C5E,KAAK8lB,QAAQ9U,IAAIjS,EAAOoS,UAG1B,IAAIyQ,EAAU,KACVC,EAAU,KAEVuJ,EAAa,EAKjB,GAAIL,EAAa,EACf,KACEnJ,EAAU,IAAI,OAAK,IAAI,uBAAqBkH,GAAU/pB,EAAOgH,WACrDoL,SAASyW,KAAK5nB,KAAK6lB,SAC3BjE,EAAQyJ,WAAWzD,KAAK7oB,EAAOssB,YAE/BrrB,KAAK2mB,uBACH/E,EACAiJ,EACA9rB,EAAO8nB,SAASta,SAChBxN,EAAO8nB,SAASja,gBAChB,EAAIke,EAAU9qB,KAAKulB,iBAGrB6F,IACA,MAAO5rB,GACP,IAAO,mCAIX,GAAI2rB,EAAa,EACf,KACEtJ,EAAU,IAAI,OAAK,IAAI,uBAAqBkH,GAAUhqB,EAAOgH,WACrDoL,SAASyW,KAAK5nB,KAAK8lB,SAC3BjE,EAAQwJ,WAAWzD,KAAK7oB,EAAOssB,YAE/BrrB,KAAK2mB,uBACH9E,EACAgJ,EACA9rB,EAAO8nB,SAASta,SAChBxN,EAAO8nB,SAASja,gBAChB,EAAIse,EAAUlrB,KAAKulB,iBAGrB6F,IACA,MAAO5rB,GACP,IAAO,mCAOX,OAHA2oB,EAAOvG,QAAUA,EACjBuG,EAAOtG,QAAUA,EAEVuJ,IAIX9F,EAAoBgG,oBAAsB,SAAUvO,EAAQtf,GAK1D,IAAIkH,EAAIoY,EAAEpY,EACRG,EAAIiY,EAAEjY,EACNF,EAAImY,EAAEnY,EACJgE,EAAInL,EAAE8tB,SAMV,OAJAxO,EAAEpY,EAAIiE,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,GAAKhE,EACnCmY,EAAEjY,EAAI8D,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,GAAKhE,EACnCmY,EAAEnY,EAAIgE,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,IAAMhE,EAE7BmY,GAGTuI,EAAoBkG,2BAA6B,SAAUzO,EAAQtf,GAKjE,IAAIkH,EAAIoY,EAAEpY,EACRG,EAAIiY,EAAEjY,EACNF,EAAImY,EAAEnY,EACJgE,EAAInL,EAAE8tB,SAMV,OAJAxO,EAAEpY,EAAIiE,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,GAAKhE,EACnCmY,EAAEjY,EAAI8D,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,GAAKhE,EACnCmY,EAAEnY,EAAIgE,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,IAAMhE,EAE7BmY,GAGTuI,EAAoBmG,2BAA6B,SAAU1O,EAAQtf,GAKjE,IAAIkH,EAAIoY,EAAEpY,EACRG,EAAIiY,EAAEjY,EACNF,EAAImY,EAAEnY,EACJgE,EAAInL,EAAE8tB,SAMV,OAJAxO,EAAEpY,EAAIiE,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,GAAKhE,EAAIgE,EAAE,IACzCmU,EAAEjY,EAAI8D,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,GAAKhE,EAAIgE,EAAE,IACzCmU,EAAEnY,EAAIgE,EAAE,GAAKjE,EAAIiE,EAAE,GAAK9D,EAAI8D,EAAE,IAAMhE,EAAIgE,EAAE,IAEnCmU,GAGTuI,EAAoBuE,4BACdrN,EAAK,IAAI,UAEN,SAAoC9N,EAAYjR,EAAQiuB,GAC7DA,EAAY/W,OAAOiT,KAAKlZ,EAAMiG,QAC9B+W,EAAY7D,SAAWnZ,EAAMmZ,SAE7B,IAAI8D,EAAiBrG,EAAoBmG,2BAA2B/c,EAAMkd,cAAcpP,GAAK/e,GAE7F6nB,EAAoBkG,2BAA2BE,EAAY/W,OAAQlX,GAGnEiuB,EAAY7D,UAAY8D,EAAejC,IAAIgC,EAAY/W;;;;;;ugBKpG5C,EAhYf,YA0BE,WAAsBpG,EAAkCmO,QAAA,IAAAA,MAAA,IAAxD,MACE,cAAO,K,OADa,EAAAnO,QAAkC,EAAAmO,SAtB9C,EAAAmP,YAAkC,GAClC,EAAApP,YAAsC,GACtC,EAAAqP,0BAA4E,G,EAwXxF,OA9XsB,OA+Bb,YAAApK,QAAP,SAAezE,G,MACb,QAA0B,KAAfA,aAAI,EAAJA,EAAMjU,MAAjB,CAEA,IAAM+iB,EAAMhuB,OAAOiuB,OAAO/O,EAAKjU,MAAM,GAC/BpL,EAAOG,OAAOiuB,OAAO/O,EAAKjU,MAAM,GAChCoI,EAAMpR,KAAKyc,YAAYsP,GAM7B,GAAIA,GAAOnuB,GAAQwT,IACJ,QAAb,EAAIA,aAAG,EAAHA,EAAK6L,YAAI,eAAEjU,MAAM,CAEnBhJ,KAAKgf,aAAaiN,gBAAgB7a,EAAI6L,KAAKjU,MAG3CoI,EAAI6L,UAAO9a,EACXiP,EAAIrN,SAAU,SAGP/D,KAAKyc,YAAYsP,GAExB,IAAK,IAAI1uB,EAAI,EAAGA,EAAI2C,KAAK6rB,YAAYxqB,OAAQhE,IACvC2C,KAAK6rB,YAAYxuB,GAAGO,OAASA,IAC/BoC,KAAK6rB,YAAYK,OAAO7uB,EAAG,GAC3BA,QAOA,YAAA8uB,MAAV,WACE,GAAmB,aAAfnsB,KAAKuO,MAAsB,CAG7BvO,KAAKosB,cAAgB,IAAI9G,EAEzBtlB,KAAKqsB,gBAAkB,GACvBrsB,KAAKssB,mBAAqB,EAC1B,IAAK,IAAIjvB,EAAI,EAAGA,EAAI,IAAKA,IACvB2C,KAAKqsB,gBAAgBhvB,GAAK,KAK9B2C,KAAKusB,oBAEc,aAAfvsB,KAAKuO,QAAsBvO,KAAKgjB,YAAc,IAAI,EAAYhjB,KAAKuO,MAAOvO,KAAKgf,aAAc,MAmB5F,YAAAwN,eAAP,WACqB,aAAfxsB,KAAKuO,OAELvO,KAAKgjB,aAAehjB,KAAKgjB,YAAYD,SAAS/iB,KAAKgjB,YAAYzY,UAG3D,YAAAgiB,kBAAV,WACE,IAAM7jB,EAAI1I,KAAKysB,QAETC,EAAyB,IAAIpmB,KAAKqmB,gCAClCC,EAAa,IAAItmB,KAAKumB,sBAAsBH,GAC5CI,EAAa,IAAIxmB,KAAKymB,iBACtBC,EAAS,IAAI1mB,KAAK2mB,oCACxBjtB,KAAKgf,aAAe,IAAI1Y,KAAK4mB,wBAAwBN,EAAYE,EAAYE,EAAQN,GACrF1sB,KAAKgf,aAAavR,WAAW,IAAInH,KAAKwD,UAAUpB,EAAE/D,EAAG+D,EAAE5D,EAAG4D,EAAE9D,IAE5D5E,KAAK4sB,WAAaA,EAClB5sB,KAAK8K,SAAW,IAAIxE,KAAK8X,aAGnB,YAAA+O,gCAAR,SAAwCpuB,EAA0BquB,GAC7C,aAAfptB,KAAKuO,QAETxP,EAAOgH,SAAW/F,KAAKyO,gBAAgBvQ,MACvCa,EAAO2S,MAAQ,OACf3S,EAAOsuB,cAAgBD,EAAOC,cAAgB,EAG9CrtB,KAAKuO,MAAMyC,IAAIjS,GAIfiB,KAAKmQ,YAAYpR,GAEjBA,EAAOke,KAAK7T,WAAY,EAExBb,YAAW,WACTxJ,EAAOke,KAAK7T,WAAY,IACvB,QAGG,YAAAkkB,aAAR,SAAqBvuB,GACA,aAAfiB,KAAKuO,QAETvO,KAAKuO,MAAMoV,OAAO5kB,GAClBiB,KAAKgf,aAAaiN,gBAAgBltB,EAAOke,KAAKjU,aACvChJ,KAAKyc,YAAY1d,EAAOgtB,OAG1B,YAAAxhB,OAAP,SAAcye,GAAd,I,IAAA,OAEEhpB,KAAKutB,YAAYpjB,IAAI,EAAG,EAAG,GAC3BnK,KAAKwtB,aAAarjB,IAAI,EAAG,EAAG,GAE5B,IAAMsjB,EAAqE,GAGrEC,EAAY1E,EAAQ,IAC1BhpB,KAAKgf,aAAa2O,eAAeD,EAAW1tB,KAAK0c,OAAOkR,aAAe,EAAG5tB,KAAK0c,OAAOmR,eAAiB,EAAI,IAK3G,IAAK,IAAIxwB,EAAI,EAAGywB,EAAK9tB,KAAK6rB,YAAYxqB,OAAQhE,EAAIywB,EAAIzwB,IAAK,CACzD,IAAI0wB,EAAW/tB,KAAK6rB,YAAYxuB,GAE5B2wB,EADUD,EAAS9Q,KAAKjU,KACX+B,iBAEjB,GAAIijB,EAAI,CAWN,GAVAA,EAAGhjB,kBAAkBhL,KAAK8K,UAGtBijB,EAAS9Q,KAAK3T,YAEZykB,EAAS9Q,KAAK1T,mBAAmBwkB,EAAS9Q,KAAK/S,aAAazI,KAAK,UACrEssB,EAAS9Q,KAAK3T,WAAY,GAIxBykB,EAAS9Q,KAAKjU,KAAKilB,qBAAuBF,EAAS9Q,KAAKiR,WAE1DH,EAASI,mBAAmBnuB,KAAK2J,eACjCokB,EAASK,iBAAiBpuB,KAAKquB,YAE/BruB,KAAK6J,aAAayB,SAAStL,KAAKquB,WAAW1pB,EAAG3E,KAAKquB,WAAWvpB,EAAG9E,KAAKquB,WAAWzpB,GACjF5E,KAAK+J,gBAAgBuB,SACnBtL,KAAK2J,cAAchF,EACnB3E,KAAK2J,cAAc7E,EACnB9E,KAAK2J,cAAc/E,EACnB5E,KAAK2J,cAAc6B,GAGrBxL,KAAK8K,SAASyT,UAAUve,KAAK6J,cAC7B7J,KAAK8K,SAASK,YAAYnL,KAAK+J,iBAE/BikB,EAAG9iB,kBAAkBlL,KAAK8K,UAE1BijB,EAAS9Q,KAAKiR,YAAa,MACtB,CAEL,IAAI/uB,EAAIa,KAAK8K,SAASmB,YAClBb,EAAIpL,KAAK8K,SAASW,cAElB3N,EAAIiwB,EAAS9Q,KAAKhU,OAEtB8kB,EAAS5c,SAAShH,IAAIhL,EAAEwF,IAAM7G,EAAE6G,EAAGxF,EAAE2F,IAAMhH,EAAEgH,EAAG3F,EAAEyF,IAAM9G,EAAE8G,GAC1DmpB,EAAS1C,WAAWlhB,IAAIiB,EAAEzG,IAAKyG,EAAEtG,IAAKsG,EAAExG,IAAKwG,EAAEI,KAGjDuiB,EAAS9Q,KAAK5T,UAAW,G,IAgErBilB,EAIEC,EAIEC,EACA7Z,EA6DJwS,EAEAiE,EAEEqD,EACAC,EACAC,E,aApIR,IAAMC,EAAkB,EAAKhC,WAAWiC,2BAA2BxxB,GAC7DuB,EAAMb,OAAOwW,KAAKqa,EAAgBE,YAAY,GAG9CC,EAAQzoB,KAAK0oB,WAAWJ,EAAgBE,WAAYxoB,KAAK2oB,aAEzDC,EAAQ5oB,KAAK0oB,WAAWJ,EAAgBO,WAAY7oB,KAAK2oB,aAI/D,GAAmB,KAAfF,EAAMnxB,MAA8B,KAAfsxB,EAAMtxB,K,iBAG/B,IAAMwxB,EAAOL,EAAMnwB,GAEbywB,EAAOH,EAAMtwB,GACb0wB,EAAe,EAAK7S,YAAY2S,GAChCG,EAAe,EAAK9S,YAAY4S,GAEtC,IAAKC,IAAiBC,E,iBAOtB,IAAMC,EAAaF,EAAarS,KAAK7T,UAC/BqmB,EAAaF,EAAatS,KAAK7T,UAE/BsmB,EAAYJ,EAAarS,KAAK5T,SAC9BsmB,EAAYJ,EAAatS,KAAK5T,SAE9BumB,EAAoC,QAApB,EAAGN,EAAarS,YAAI,eAAE9T,gBACtC0mB,EAAoC,QAApB,EAAGN,EAAatS,YAAI,eAAE9T,gBAK5C,GAAIymB,GAAoBC,EAAkB,CAExC,IAAM9uB,EAAQ,CAACuuB,EAAa1xB,KAAM2xB,EAAa3xB,MAAMkyB,OAC/C,EAAkB/uB,EAAM,GAAE,KAAKA,EAAM,GACvC,OAAK,EACwE,EAA7E,EAAK+qB,0BAA0BiE,MAAK,SAAAC,GAAM,OAAAA,EAAGC,eAAiB,KAAuB,YAC5E,QACbxC,EAAmBjtB,KAAK,CAAEyvB,aAAY,EAAEzlB,WAAW,IACnD,EAAK/I,KAAK,YAAa,CAAEmJ,OAAQ,CAAC0kB,EAAcC,GAAepvB,MAAK,IAGtE,IAAMqvB,IAAeC,GAAgBC,GAAaC,E,iBAMlD,IAFA,IAAIO,GAAU,EACVC,EAAa,EACR9tB,EAAI,EAAG+tB,EAAKxB,EAAgByB,iBAAkBhuB,EAAI+tB,EAAI/tB,IAG7D,IAFIisB,EAAeM,EAAgB0B,gBAAgBjuB,IAElCkuB,cAAgB,EAAG,CAClCL,GAAU,GACN3B,EAAUD,EAAakC,qBAEbL,IACZA,EAAa5B,EACTC,EAAMF,EAAamC,yBACnB9b,EAAS2Z,EAAaoC,uBAC1B,EAAKnD,YAAYpjB,IAAIqkB,EAAI7pB,IAAK6pB,EAAI1pB,IAAK0pB,EAAI5pB,KAC3C,EAAK4oB,aAAarjB,IAAIwK,EAAOhQ,IAAKgQ,EAAO7P,IAAK6P,EAAO/P,MAGvD,MAKJ,IAAKsrB,E,iBA+BL,GAnBA,EAAKS,QAAQxmB,IAAI,EAAG,EAAG,GACvBmlB,EAAazI,SAAW,CACtBlK,KAAM,EACNpQ,SAAU,EAAKokB,QACf/jB,gBAAiB,EAAK+jB,QACtBvnB,UAAWomB,EACXoB,YAAa7B,GAEfQ,EAAa1I,SAAW,CACtBlK,KAAM,EACNpQ,SAAU,EAAKokB,QACf/jB,gBAAiB,EAAK+jB,QACtBvnB,UAAWqmB,EACXmB,YAAa1B,QAE2B,IAA/BI,EAAajC,gBAA+BiC,EAAajC,cAAgB,QAC1C,IAA/BkC,EAAalC,gBAA+BkC,EAAalC,cAAgB,GAGhFmC,IAAeE,GAAaS,EA1BR,GA0BwCb,EAAajC,cAzBlD,EAyBsF,CAC3GlG,EAAS,EAAKiF,cAAcrF,kBAAkBuI,EAAc,EAAK/B,YAAa,EAAKC,aAAc,EAAG,GAEpGpC,EAAajE,EAAO9lB,OACxB,IAASgB,EAAI,EAAGA,EAAI+oB,EAAY/oB,IAC1BosB,EAAMM,EAAM7iB,oBACZwiB,EAASK,EAAM5iB,sBACfwiB,EAAWxH,EAAO9kB,IACbwkB,SAASta,SAASpC,IAAIskB,EAAI9pB,IAAK8pB,EAAI3pB,IAAK2pB,EAAI7pB,KACrD+pB,EAAS9H,SAASja,gBAAgBzC,IAAIukB,EAAO/pB,IAAK+pB,EAAO5pB,IAAK4pB,EAAO9pB,KAErE,EAAKuoB,gCAAgCwB,EAAUW,GAGjD,EAAKjD,gBAAgB,EAAKC,sBAAwBgD,EAClDA,EAAarS,KAAK5T,UAAW,EAI/B,GAAIomB,IAAeE,GAAaQ,EA7CR,GA6CwCZ,EAAalC,cA5ClD,EA4CsF,CAC3GlG,EAAS,EAAKiF,cAAcrF,kBAAkBwI,EAAc,EAAKhC,YAAa,EAAKC,aAAc,EAAG,GAEpGpC,EAAajE,EAAO9lB,OACxB,IAASgB,EAAI,EAAGA,EAAI+oB,EAAY/oB,IAC1BosB,EAAMS,EAAMhjB,oBACZwiB,EAASQ,EAAM/iB,sBACfwiB,EAAWxH,EAAO9kB,IACbwkB,SAASta,SAASpC,IAAIskB,EAAI9pB,IAAK8pB,EAAI3pB,IAAK2pB,EAAI7pB,KACrD+pB,EAAS9H,SAASja,gBAAgBzC,IAAIukB,EAAO/pB,IAAK+pB,EAAO5pB,IAAK4pB,EAAO9pB,KAErE,EAAKuoB,gCAAgCwB,EAAUY,GAGjD,EAAKlD,gBAAgB,EAAKC,sBAAwBiD,EAClDA,EAAatS,KAAK5T,UAAW,I,OA7IjC,IAAShM,EAAI,EAAGywB,EAAK9tB,KAAK4sB,WAAWiE,kBAAmBxzB,EAAIywB,EAAIzwB,I,IAoJhE,IAASA,EAAI,EAAGA,EAAI2C,KAAKssB,mBAAoBjvB,IAC3C2C,KAAKstB,aAAattB,KAAKqsB,gBAAgBhvB,IAEzC2C,KAAKssB,mBAAqB,EAK1BtsB,KAAK8rB,0BAA0BlpB,SAAQ,SAAAotB,GAC7B,IAAAC,EAAA,EAAAA,aACR,IAAKxC,EAAmBsC,MAAK,SAAAC,GAAM,OAAAA,EAAGC,eAAiBA,KAAe,CACpE,IAAM,EAAQA,EAAaa,MAAM,MAC3BC,EAAO,EAAKlF,YAAYkE,MAAK,SAAA3e,GAAO,OAAAA,EAAIxT,OAAS,EAAM,MACvDqqB,EAAO,EAAK4D,YAAYkE,MAAK,SAAA3e,GAAO,OAAAA,EAAIxT,OAAS,EAAM,MACzDmzB,GAAQ9I,GAAM,EAAKxmB,KAAK,YAAa,CAAEmJ,OAAQ,CAACmmB,EAAM9I,GAAO9nB,MAAO,YAG5EH,KAAK8rB,0BAA4B,EAAI2B,IAEzC,EA9XA,CAAsB,K;;;;;;ACCtB,MAAMuD,EACC,MADDA,EAEM,WAFNA,EAGI,SAHJA,EAIK,UAJLA,EAKE,OALFA,EAME,OANFA,EAOE,OAPFA,EAQG,QARHA,EASE,OATFA,EAUS,cAGTC,EACC,MADDA,EAEI,SAYJC,E,OAA4B,EAAiBjyB,UAAUC,eAAe,kBAE/DiyB,EAAwB,SAAU10B,EAAMwlB,GACnD,OAAQA,EAAQ1Q,MACd,KAAKyf,EACH,OAAOI,EAAe30B,EAAMwlB,GAC9B,KAAK+O,EACH,OAAOK,EAAoB50B,EAAMwlB,GACnC,KAAK+O,EACH,OAAOM,EAAmB70B,EAAMwlB,GAClC,KAAK+O,EACH,OAAOO,EAAgB90B,EAAMwlB,GAC/B,KAAK+O,EACH,OAAOQ,EAAkB/0B,EAAMwlB,GACjC,KAAK+O,EACH,OAAOS,EAAgBh1B,EAAMwlB,GAC/B,KAAK+O,EACH,OAAOU,EAAiBj1B,EAAMwlB,GAChC,KAAK+O,EACH,OAAOW,EAAkBl1B,EAAMwlB,GACjC,KAAK+O,EACH,OAAOY,EAAmBn1B,EAAMwlB,GAClC,KAAK+O,EACH,OAAOa,EAA8Bp1B,EAAMwlB,GAC7C,QAEE,OADA,IAAOA,EAAQ1Q,KAAO,+BACf,KAMA6f,EAAiB,SAAU30B,EAAMwlB,GAC5CA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,IAClBhP,EAAQ+P,YAAcC,GACpBx1B,EACAy1B,GAAez1B,EAAMwlB,GACrBA,EAAQkQ,cACRlQ,EAAQmQ,gBAIZ,MAAMC,EAAgB,IAAI/rB,KAAKwD,UAAUmY,EAAQ+P,YAAYrtB,EAAGsd,EAAQ+P,YAAYltB,EAAGmd,EAAQ+P,YAAYptB,GACrG0tB,EAAiB,IAAIhsB,KAAKisB,WAAWF,GAI3C,OAHA/rB,KAAKob,QAAQ2Q,GAEbG,EAAsBF,EAAgBrQ,EAASwQ,GAAch2B,EAAMwlB,IAC5DqQ,GAGIjB,EAAsB,SAAU50B,EAAMwlB,GACjDA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,IAClBhP,EAAQ+P,YAAcC,GACpBx1B,EACAy1B,GAAez1B,EAAMwlB,GACrBA,EAAQkQ,cACRlQ,EAAQmQ,gBAIZ,MAAMC,EAAgB,IAAI/rB,KAAKwD,UAAUmY,EAAQ+P,YAAYrtB,EAAGsd,EAAQ+P,YAAYltB,EAAGmd,EAAQ+P,YAAYptB,GACrG0tB,EAAiB,MACrB,OAAQrQ,EAAQyQ,cACd,IAAK,IACH,OAAO,IAAIpsB,KAAKqsB,gBAAgBN,GAClC,IAAK,IACH,OAAO,IAAI/rB,KAAKssB,iBAAiBP,GACnC,IAAK,IACH,OAAO,IAAI/rB,KAAKusB,iBAAiBR,GAErC,OAAO,MATc,GAcvB,OAHA/rB,KAAKob,QAAQ2Q,GAEbG,EAAsBF,EAAgBrQ,EAASwQ,GAAch2B,EAAMwlB,IAC5DqQ,GAGIhB,EAAqB,SAAU70B,EAAMwlB,GAChDA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,IAClBhP,EAAQ+P,YAAcC,GACpBx1B,EACAy1B,GAAez1B,EAAMwlB,GACrBA,EAAQkQ,cACRlQ,EAAQmQ,gBAIZ,MAAM,EAAEztB,EAAC,EAAEG,EAAC,EAAEF,GAAMqd,EAAQ+P,YACtBM,EAAiB,MACrB,OAAQrQ,EAAQyQ,cACd,IAAK,IACH,OAAO,IAAIpsB,KAAKwsB,eAAeruB,KAAKwmB,IAAItmB,EAAGC,GAAQ,EAAJE,GACjD,IAAK,IACH,OAAO,IAAIwB,KAAKysB,gBAAgBtuB,KAAKwmB,IAAInmB,EAAGF,GAAQ,EAAJD,GAClD,IAAK,IACH,OAAO,IAAI2B,KAAK0sB,gBAAgBvuB,KAAKwmB,IAAItmB,EAAGG,GAAQ,EAAJF,GAEpD,OAAO,MATc,GAavB,OADA4tB,EAAsBF,EAAgBrQ,EAASwQ,GAAch2B,EAAMwlB,IAC5DqQ,GAGIf,EAAkB,SAAU90B,EAAMwlB,GAC7CA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,IAClBhP,EAAQ+P,YAAcC,GACpBx1B,EACAy1B,GAAez1B,EAAMwlB,GACrBA,EAAQkQ,cACRlQ,EAAQmQ,gBAIZ,MAAM,EAAEztB,EAAC,EAAEG,EAAC,EAAEF,GAAMqd,EAAQ+P,YACtBM,EAAiB,MACrB,OAAQrQ,EAAQyQ,cACd,IAAK,IACH,OAAO,IAAIpsB,KAAK2sB,YAAYxuB,KAAKwmB,IAAItmB,EAAGC,GAAQ,EAAJE,GAC9C,IAAK,IACH,OAAO,IAAIwB,KAAK4sB,aAAazuB,KAAKwmB,IAAInmB,EAAGF,GAAQ,EAAJD,GAC/C,IAAK,IACH,OAAO,IAAI2B,KAAK6sB,aAAa1uB,KAAKwmB,IAAItmB,EAAGG,GAAQ,EAAJF,GAEjD,OAAO,MATc,GAavB,OADA4tB,EAAsBF,EAAgBrQ,EAASwQ,GAAch2B,EAAMwlB,IAC5DqQ,GAGId,EAAoB,SAAU/0B,EAAMwlB,GAI/C,IAAIlU,EAHJkU,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAMVlU,EAHEkU,EAAQ8P,MAAQd,GAAemC,MAAMnR,EAAQoR,cAGtCC,GAAe72B,EAAMwlB,EAASiQ,GAAez1B,EAAMwlB,IAFnDA,EAAQoR,aAKnB,MAAMf,EAAiB,IAAIhsB,KAAKitB,cAAcxlB,GAG9C,OAFAykB,EAAsBF,EAAgBrQ,EAASwQ,GAAch2B,EAAMwlB,IAE5DqQ,GAGIb,EAAkB,WAC7B,MAAM+B,EAAS,IAAI,UACbphB,EAAS,IAAI,UACnB,OAAO,SAAU3V,EAAMwlB,GAIrB,GAHAA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,EAElB,OADA1xB,QAAQylB,KAAK,0CACN,KAGT,MAAMyO,EAASvB,GAAez1B,EAAMwlB,GAE9ByR,EAAW,IAAIptB,KAAKwD,UACpB6pB,EAAe,IAAIrtB,KAAKstB,kBAC9BD,EAAaE,UAAU5R,EAAQ6R,QAC/B1hB,EAAOgV,WAAWqM,EAAOxI,IAAKwI,EAAOM,KAAKC,eAAe,IAEzD,IAAIC,EAAc,EAClBC,GAAmBz3B,EAAMwlB,EAASkS,IAChCF,GAAeE,EAAIvQ,WAAWzS,SAASsK,MAAMpa,OAAS,IAGxD,MAAM+yB,EAAcnS,EAAQoS,iBAAmB,IAE3CJ,EAAcG,GAChB70B,QAAQylB,KAAK,+CAA+CoP,WAAqBH,cAEnF,MAAM90B,EAAIsF,KAAKsvB,IAAI,EAAGK,EAAcH,GAEpCC,GAAmBz3B,EAAMwlB,EAAS,CAACkS,EAAKtpB,KACtCypB,GAAoCH,EAAKtpB,GAEzC,MAAM0pB,EAAaJ,EAAIvQ,WAAWzS,SAASsK,MAC3C,IAAK,IAAIpe,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAQhE,GAAK,EACtCoH,KAAK2V,UAAYjb,IACnBq0B,EACGrpB,IAAIoqB,EAAWl3B,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IACrDm3B,aAAa3pB,GACbid,IAAI1V,GACPshB,EAASpoB,SAASkoB,EAAO7uB,EAAG6uB,EAAO1uB,EAAG0uB,EAAO5uB,GAC7C+uB,EAAac,SAASf,EAAUr2B,IAAMk3B,EAAWlzB,OAAS,MAKhE,IAAIixB,EAAiBqB,EACrB,GAAIA,EAAae,kBAAoB,IAAK,CAExC,MAAMC,EAAY,IAAIruB,KAAKsuB,YAAYjB,GACvCgB,EAAUE,UAAU5S,EAAQ6R,QAC5BxtB,KAAKob,QAAQiS,GACbrB,EAAiB,IAAIhsB,KAAKstB,kBACxBttB,KAAKwuB,WAAWH,EAAUI,oBAC1BJ,EAAUK,eAEZ1uB,KAAKob,QAAQiT,GAMf,OAHAruB,KAAKob,QAAQgS,GAEblB,EAAsBF,EAAgBrQ,EAASwQ,GAAch2B,EAAMwlB,IAC5DqQ,GA/DoB,GAmElBZ,EAAmB,WAC9B,MAAM3U,EAAI,IAAI,UACR3K,EAAS,IAAI,UACnB,OAAO,SAAU3V,EAAMwlB,GAIrB,GAHAA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,EAElB,OADA1xB,QAAQylB,KAAK,0CACN,GAGT,IAAK1e,KAAKpH,eAAe,QAIvB,OAHAK,QAAQylB,KACN,0HAEK,GAGT,MAAMyO,EAASvB,GAAez1B,GACxBw4B,EAAQxC,GAAch2B,EAAMwlB,GAElC,IAAIgS,EAAc,EACdiB,EAAW,EACf9iB,EAAOgV,WAAWqM,EAAOxI,IAAKwI,EAAOM,KAAKC,eAAe,IAEzDE,GAAmBz3B,EAAMwlB,EAASkS,IAChCF,GAAeE,EAAIvQ,WAAWzS,SAASsK,MAAMpa,OAAS,EAClD8yB,EAAIzR,MACNwS,GAAYf,EAAIzR,MAAMjH,MAAMpa,OAAS,EAErC6zB,GAAYf,EAAIvQ,WAAWzS,SAASsK,MAAMpa,OAAS,IAIvD,MAAM8zB,EAAO,IAAI7uB,KAAK8uB,KAClBnT,EAAQ/iB,eAAe,oBAAoBi2B,EAAKE,mBAAmBpT,EAAQqT,iBAC3ErT,EAAQ/iB,eAAe,iBAAiBi2B,EAAKI,gBAAgBtT,EAAQuT,cACrEvT,EAAQ/iB,eAAe,cAAci2B,EAAKM,aAAaxT,EAAQyT,WAC/DzT,EAAQ/iB,eAAe,mBAAmBi2B,EAAKQ,kBAAkB1T,EAAQ2T,gBACzE3T,EAAQ/iB,eAAe,cAAci2B,EAAKU,aAAa5T,EAAQ6T,WAEnE,MAAMtgB,EAASlP,KAAKyvB,QAAsB,EAAd9B,EAAkB,GACxC+B,EAAY1vB,KAAKyvB,QAAmB,EAAXb,EAAe,GAC9CC,EAAKc,UAAUzgB,GACf2f,EAAKe,aAAaF,GAClBb,EAAKgB,WAAWlC,GAChBkB,EAAKiB,cAAclB,GAEnB,MAAMmB,EAAO7gB,EAAS,EACpB8gB,EAAON,EAAY,EACrB9B,GAAmBz3B,EAAMwlB,EAAS,CAACkS,EAAKtpB,KACtCypB,GAAoCH,EAAKtpB,GAEzC,MAAM0pB,EAAaJ,EAAIvQ,WAAWzS,SAASsK,MACrC+M,EAAU2L,EAAIzR,MAAQyR,EAAIzR,MAAMjH,MAAQ,KAC9C,IAAK,IAAIpe,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAQhE,GAAK,EAC1C0f,EAAE5S,IAAIoqB,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IACxDm3B,aAAa3pB,GACbid,IAAI1V,GACP9L,KAAKiwB,QAAQF,EAAOh5B,EAAI,GAAK0f,EAAEpY,EAC/B2B,KAAKiwB,QAAQF,EAAOh5B,EAAI,GAAK0f,EAAEjY,EAC/BwB,KAAKiwB,QAAQF,EAAOh5B,EAAI,GAAK0f,EAAEnY,EAEjC,GAAI4jB,EACF,IAAK,IAAInrB,EAAI,EAAGA,EAAImrB,EAAQnnB,OAAQhE,IAClCiJ,KAAKkwB,OAAOF,EAAOj5B,GAAKmrB,EAAQnrB,QAGlC,IAAK,IAAIA,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAS,EAAGhE,IACzCiJ,KAAKkwB,OAAOF,EAAOj5B,GAAKA,IAK9B83B,EAAKsB,UACLnwB,KAAKowB,MAAMlhB,GACXlP,KAAKowB,MAAMV,GACX,MAAMN,EAAYP,EAAKwB,eAEjBC,EAAS,GACf,IAAK,IAAIv5B,EAAI,EAAGA,EAAIq4B,EAAWr4B,IAAK,CAClC,MAAMw5B,EAAO,IAAIvwB,KAAKstB,kBACtBiD,EAAKhD,UAAU5R,EAAQ6R,QACvB,MAAMgD,EAAU3B,EAAK4B,aAAa15B,GAC5B25B,EAAa7B,EAAK8B,gBAAgB55B,GAClC65B,EAAa5wB,KAAKyvB,QAAkB,EAAVe,EAAc,GACxCK,EAAgB7wB,KAAKyvB,QAAqB,EAAbiB,EAAiB,GACpD7B,EAAKiC,MAAM/5B,EAAG65B,EAAYC,GAE1B,MAAMd,EAAOa,EAAa,EAC1B,IAAK,IAAIG,EAAK,EAAGA,EAAKP,EAASO,IAAM,CACnC,MAAM3D,EAAW,IAAIptB,KAAKwD,UACpBwtB,EAAKhxB,KAAKiwB,QAAQF,EAAY,EAALgB,EAAS,GAClCE,EAAKjxB,KAAKiwB,QAAQF,EAAY,EAALgB,EAAS,GAClCG,EAAKlxB,KAAKiwB,QAAQF,EAAY,EAALgB,EAAS,GACxC3D,EAASpoB,SAASgsB,EAAIC,EAAIC,GAC1BX,EAAKpC,SAASf,EAAU2D,IAAOP,EAAU,GACzCxwB,KAAKob,QAAQgS,GAGflB,EAAsBqE,EAAM5U,EAASgT,GACrC2B,EAAOp2B,KAAKq2B,GAGd,OAAOD,GAzGqB,GA6GnBjF,EAAoB,WAC/B,MAAM5U,EAAI,IAAI,UACR3K,EAAS,IAAI,UACnB,OAAO,SAAU3V,EAAMwlB,GAIrB,GAHAA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,EAElB,OADA1xB,QAAQylB,KAAK,2CACN,GAGT,IAAK1e,KAAKpH,eAAe,SAIvB,OAHAK,QAAQylB,KACN,2HAEK,GAGT,MAAMyO,EAASvB,GAAez1B,EAAMwlB,GAC9BgT,EAAQxC,GAAch2B,EAAMwlB,GAElC,IAAIgS,EAAc,EACdiB,EAAW,EACf9iB,EAAOgV,WAAWqM,EAAOxI,IAAKwI,EAAOM,KAAKC,eAAe,IAEzDE,GAAmBz3B,EAAMwlB,EAASkS,IAChCF,GAAeE,EAAIvQ,WAAWzS,SAASsmB,MACnCtD,EAAIzR,MACNwS,GAAYf,EAAIzR,MAAM+U,MAAQ,EAE9BvC,GAAYf,EAAIvQ,WAAWzS,SAASsmB,MAAQ,IAIhD,MAAMC,EAAQ,IAAIpxB,KAAKqxB,MACjBC,EAAS,IAAItxB,KAAKuxB,WAEpB5V,EAAQ/iB,eAAe,eAAe04B,EAAOE,iBAAiB7V,EAAQ8V,YACtE9V,EAAQ/iB,eAAe,UAAU04B,EAAOI,YAAY/V,EAAQlQ,OAC5DkQ,EAAQ/iB,eAAe,cAAc04B,EAAOK,gBAAgBhW,EAAQ6T,WACpE7T,EAAQ/iB,eAAe,sBAAsB04B,EAAOM,wBAAwBjW,EAAQkW,mBACpFlW,EAAQ/iB,eAAe,2BACzB04B,EAAOQ,6BAA6BnW,EAAQoW,wBAC1CpW,EAAQ/iB,eAAe,UAAU04B,EAAOU,YAAYrW,EAAQsW,OAC5DtW,EAAQ/iB,eAAe,SAAS04B,EAAOY,WAAWvW,EAAQwW,MAC1DxW,EAAQ/iB,eAAe,UAAU04B,EAAOc,YAAYzW,EAAQ0W,OAC5D1W,EAAQ/iB,eAAe,QAAQ04B,EAAOgB,UAAU3W,EAAQ4W,KACxD5W,EAAQ/iB,eAAe,SAAS04B,EAAOkB,WAAW7W,EAAQzjB,MAC1DyjB,EAAQ/iB,eAAe,wBAAwB04B,EAAOmB,0BAA0B9W,EAAQ+W,qBACxF/W,EAAQ/iB,eAAe,mBAAmB04B,EAAOqB,qBAAqBhX,EAAQiX,gBAC9EjX,EAAQ/iB,eAAe,4BACzB04B,EAAOuB,8BAA8BlX,EAAQmX,yBAC3CnX,EAAQ/iB,eAAe,oBAAoB04B,EAAOyB,sBAAsBpX,EAAQqX,iBAEpF,MAAM9jB,EAASlP,KAAKyvB,QAAsB,EAAd9B,EAAkB,GACxC+B,EAAY1vB,KAAKyvB,QAAmB,EAAXb,EAAe,GAE9C,IAAImB,EAAO7gB,EAAS,EAClB8gB,EAAON,EAAY,EACrB9B,GAAmBz3B,EAAMwlB,EAAS,CAACkS,EAAKtpB,KACtCypB,GAAoCH,EAAKtpB,GAEzC,MAAM0pB,EAAaJ,EAAIvQ,WAAWzS,SAASsK,MACrC+M,EAAU2L,EAAIzR,MAAQyR,EAAIzR,MAAMjH,MAAQ,KAC9C,IAAK,IAAIpe,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAQhE,GAAK,EAC1C0f,EAAE5S,IAAIoqB,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IACxDm3B,aAAa3pB,GACbid,IAAI1V,GACP9L,KAAKiwB,QAAQF,EAAO,GAAKtZ,EAAEpY,EAC3B2B,KAAKiwB,QAAQF,EAAO,GAAKtZ,EAAEjY,EAC3BwB,KAAKiwB,QAAQF,EAAO,GAAKtZ,EAAEnY,EAC3ByxB,GAAQ,EAEV,GAAI7N,EACF,IAAK,IAAInrB,EAAI,EAAGA,EAAImrB,EAAQnnB,OAAQhE,IAClCiJ,KAAKkwB,OAAOF,GAAQ9N,EAAQnrB,GAC5Bi5B,SAGF,IAAK,IAAIj5B,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAS,EAAGhE,IACzCiJ,KAAKkwB,OAAOF,GAAQj5B,EACpBi5B,MAKNoB,EAAMjB,QAAQjhB,EAAQ,EAAGye,EAAa+B,EAAW,EAAGd,EAAU0C,GAC9DtxB,KAAKowB,MAAMlhB,GACXlP,KAAKowB,MAAMV,GACX,MAAMuD,EAAS7B,EAAM8B,kBAEf5C,EAAS,GACT6C,EAAK,IAAInzB,KAAKozB,WACpB,IAAK,IAAIr8B,EAAI,EAAGA,EAAIk8B,EAAQl8B,IAAK,CAC/Bq6B,EAAMiC,cAAct8B,EAAGo8B,GACvB,MAAM3C,EAAU2C,EAAGG,gBAGb/C,GAFa4C,EAAGI,eAET,IAAIvzB,KAAKstB,mBACtBiD,EAAKhD,UAAU5R,EAAQ6R,QAEvB,IAAK,IAAIuD,EAAK,EAAGA,EAAKP,EAASO,IAAM,CACnC,MAAM3D,EAAW,IAAIptB,KAAKwD,UACpBwtB,EAAKmC,EAAGI,aAAkB,EAALxC,EAAS,GAC9BE,EAAKkC,EAAGI,aAAkB,EAALxC,EAAS,GAC9BG,EAAKiC,EAAGI,aAAkB,EAALxC,EAAS,GACpC3D,EAASpoB,SAASgsB,EAAIC,EAAIC,GAC1BX,EAAKpC,SAASf,EAAU2D,IAAOP,EAAU,GACzCxwB,KAAKob,QAAQgS,GAGflB,EAAsBqE,EAAM5U,EAASgT,GACrC2B,EAAOp2B,KAAKq2B,GAKd,OAHAvwB,KAAKob,QAAQ+X,GACbnzB,KAAKob,QAAQgW,GAENd,GAtHsB,GA0HpBhF,EAAqB,WAChC,MAAM7H,EAAK,IAAI,UACTC,EAAK,IAAI,UACTC,EAAK,IAAI,UACf,OAAO,SAAUxtB,EAAMwlB,GAIrB,GAHAA,EAAQ1Q,KAAOyf,EACfc,EAAY7P,GAERA,EAAQ8P,MAAQd,EAElB,OADA1xB,QAAQylB,KAAK,0CACN,KAGT,MAAMiQ,EAAQxC,GAAch2B,EAAMwlB,GAE5B6X,EAAM,IAAIxzB,KAAKwD,UACfiwB,EAAM,IAAIzzB,KAAKwD,UACfkwB,EAAM,IAAI1zB,KAAKwD,UACfmwB,EAAU,IAAI3zB,KAAK4zB,gBAAe,GAAM,GA8B9C,IAAI5H,EAWJ,OAvCA4B,GAAmBz3B,EAAMwlB,EAAS,CAACkS,EAAKtpB,KACtC,MAAM0pB,EAAaJ,EAAIvQ,WAAWzS,SAASsK,MAC3C,GAAI0Y,EAAIzR,MACN,IAAK,IAAIrlB,EAAI,EAAGA,EAAI82B,EAAIzR,MAAM+U,MAAOp6B,GAAK,EAAG,CAC3C,MAAM88B,EAA0B,EAArBhG,EAAIzR,MAAMjH,MAAMpe,GACrB+8B,EAA8B,EAAzBjG,EAAIzR,MAAMjH,MAAMpe,EAAI,GACzBg9B,EAA8B,EAAzBlG,EAAIzR,MAAMjH,MAAMpe,EAAI,GAC/B0sB,EAAG5f,IAAIoqB,EAAW4F,GAAK5F,EAAW4F,EAAK,GAAI5F,EAAW4F,EAAK,IAAI3F,aAAa3pB,GAC5Emf,EAAG7f,IAAIoqB,EAAW6F,GAAK7F,EAAW6F,EAAK,GAAI7F,EAAW6F,EAAK,IAAI5F,aAAa3pB,GAC5Eof,EAAG9f,IAAIoqB,EAAW8F,GAAK9F,EAAW8F,EAAK,GAAI9F,EAAW8F,EAAK,IAAI7F,aAAa3pB,GAC5EivB,EAAIxuB,SAASye,EAAGplB,EAAGolB,EAAGjlB,EAAGilB,EAAGnlB,GAC5Bm1B,EAAIzuB,SAAS0e,EAAGrlB,EAAGqlB,EAAGllB,EAAGklB,EAAGplB,GAC5Bo1B,EAAI1uB,SAAS2e,EAAGtlB,EAAGslB,EAAGnlB,EAAGmlB,EAAGrlB,GAC5Bq1B,EAAQK,YAAYR,EAAKC,EAAKC,GAAK,QAGrC,IAAK,IAAI38B,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAQhE,GAAK,EAC1C0sB,EAAG5f,IAAIoqB,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IAAIm3B,aAAa3pB,GAC7Emf,EAAG7f,IAAIoqB,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IAAIm3B,aAAa3pB,GAC7Eof,EAAG9f,IAAIoqB,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IAAIm3B,aAAa3pB,GAC7EivB,EAAIxuB,SAASye,EAAGplB,EAAGolB,EAAGjlB,EAAGilB,EAAGnlB,GAC5Bm1B,EAAIzuB,SAAS0e,EAAGrlB,EAAGqlB,EAAGllB,EAAGklB,EAAGplB,GAC5Bo1B,EAAI1uB,SAAS2e,EAAGtlB,EAAGslB,EAAGnlB,EAAGmlB,EAAGrlB,GAC5Bq1B,EAAQK,YAAYR,EAAKC,EAAKC,GAAK,KAMpB1H,EAAjBrQ,EAAQsY,QAA0B,IAAIj0B,KAAKk0B,uBAAuBP,GAAS,GAAM,GAC/D,IAAI3zB,KAAKm0B,0BAA0BR,GAAS,GAElE3H,EAAeoI,UAAY,CAACT,GAE5B3zB,KAAKob,QAAQoY,GACbxzB,KAAKob,QAAQqY,GACbzzB,KAAKob,QAAQsY,GAEbxH,EAAsBF,EAAgBrQ,EAASgT,GACxC3C,GA3DuB,GA+DrBT,EAAgC,SAAUp1B,EAAMwlB,GAG3D,GAFA6P,EAAY7P,GAERA,EAAQ8P,MAAQd,EAElB,OADA1xB,QAAQylB,KAAK,8CACN,KAET,MAAM2V,EAAsB1Y,EAAQ0Y,qBAAuB,EACrDC,EAAkB3Y,EAAQ2Y,iBAAmB,GAC7CC,EAAc5Y,EAAQ4Y,aAAe,EACrCC,EAAS7Y,EAAQ/iB,eAAe,UAAY+iB,EAAQ6Y,OAAS,EAC7DC,EAAM,MACV,OAAQ9Y,EAAQ+Y,gBACd,IAAK,QACH,OAAO10B,KAAK20B,UACd,IAAK,QAEL,QACE,OAAO30B,KAAK40B,YAPN,GAUNC,GAAgBlZ,EAAQ/iB,eAAe,kBAAmB+iB,EAAQkZ,cAElEC,EAAoBR,EAAgBv5B,OACpCg6B,EAAmBD,EAAoB,EAAIR,EAAgB,GAAGv5B,OAAS,EAEvEsJ,EAAOrE,KAAKyvB,QAAQqF,EAAoBC,EAAmB,GAC3DtP,EAAMphB,EAAO,EAEnB,IAAI2wB,EAAYC,OAAOC,kBACnBC,EAAYF,OAAOG,kBACnBhZ,EAAQ,EACZ,IAAK,IAAIplB,EAAI,EAAGA,EAAI89B,EAAmB99B,IACrC,IAAK,IAAIkO,EAAI,EAAGA,EAAI6vB,EAAkB7vB,IAAK,CACzC,MAAM+G,EAASqoB,EAAgBt9B,GAAGkO,GAClClF,KAAK6d,QAAQ4H,EAAMrJ,GAASnQ,EAC5BmQ,IACA4Y,EAAY72B,KAAKsvB,IAAIuH,EAAW/oB,GAChCkpB,EAAYh3B,KAAKwmB,IAAIwQ,EAAWlpB,GAIpC,MAAM+f,EAAiB,IAAIhsB,KAAKq1B,0BAC9BN,EACAD,EACAzwB,EACAkwB,EACAS,EACAG,EACAX,EACAC,EACAI,GAGIlG,EAAQ,IAAI3uB,KAAKwD,UAAU6wB,EAAqB,EAAGA,GAOzD,OANArI,EAAesJ,gBAAgB3G,GAC/B3uB,KAAKob,QAAQuT,GAEb3C,EAAesI,gBAAkBjwB,EAEjC6nB,EAAsBF,EAAgBrQ,GAC/BqQ,GAGT,SAASR,EAAY7P,GACnBA,EAAQ8P,IAAM9P,EAAQ/iB,eAAe,OAAS+iB,EAAQ8P,IAAMd,EAC5DhP,EAAQ1Q,KAAO0Q,EAAQ1Q,MAAQyf,EAC/B/O,EAAQkQ,cAAgBlQ,EAAQ/iB,eAAe,iBAAmB+iB,EAAQkQ,cAAgB,EAC1FlQ,EAAQmQ,cAAgBnQ,EAAQ/iB,eAAe,iBAAmB+iB,EAAQmQ,cAAgBmJ,OAAOC,kBACjGvZ,EAAQyQ,aAAezQ,EAAQyQ,cAAgB,IAC/CzQ,EAAQ6R,OAAS7R,EAAQ/iB,eAAe,UAAY+iB,EAAQ6R,OAAS,IACrE7R,EAAQ4Z,mBAAmB5Z,EAAQ/iB,eAAe,qBAAsB+iB,EAAQ4Z,iBAE3E5Z,EAAQhZ,SACXgZ,EAAQhZ,OAAS,IAAI,WAGlBgZ,EAAQ6Z,cACX7Z,EAAQ6Z,YAAc,IAAI,cAI9B,MAAMtJ,EAAwB,SAAUF,EAAgBrQ,EAASgT,GAuB/D,GAtBA3C,EAAe/gB,KAAO0Q,EAAQ1Q,KAC9B+gB,EAAeuB,UAAU5R,EAAQ6R,QACjCxB,EAAe5Q,QAAU,KACvB,IAAK,IAAIqa,KAAOzJ,EAAeoI,WAAa,GAC1Cp0B,KAAKob,QAAQqa,GAEXzJ,EAAesI,iBACjBt0B,KAAKowB,MAAMpE,EAAesI,iBAE5Bt0B,KAAKob,QAAQ4Q,IAaX2C,EAAO,CACT,MAAM+G,EAAa,IAAI11B,KAAKwD,UAAUmrB,EAAMtwB,EAAGswB,EAAMnwB,EAAGmwB,EAAMrwB,GAC9D0tB,EAAesJ,gBAAgBI,GAC/B11B,KAAKob,QAAQsa,KAQX9H,GAAqB,WACzB,MAAMrpB,EAAY,IAAI,UAChB4T,EAAU,IAAI,UACd7M,EAAiB,IAAI,iBAC3B,OAAO,SAAUnV,EAAMwlB,EAASga,GAC9Bxd,EAAQyd,WAAWz/B,EAAK0/B,aACxB1/B,EAAK2/B,SAASpsB,IAEVA,EAAKqsB,SAIDrsB,IAASvT,EACXoO,EAAUyxB,YAENpL,GAA2BlhB,EAAKusB,iBACpC1xB,EAAU2xB,iBAAiB/d,EAASzO,EAAKmsB,cAI3CF,EAAGjsB,EAAKlK,SAAS8gB,iBAAmB5W,EAAKlK,SAAW8L,EAAe6qB,aAAazsB,EAAKlK,UAAW+E,OApB7E,GA0BrB4nB,GAAgB,SAAUh2B,EAAMwlB,GAMpC,MAAM,MAAEgT,GAAUx4B,EAClB,OAAOw4B,GAGH3B,GAAiB,WACrB,MAAMvW,EAAI,IAAI,UACR3K,EAAS,IAAI,UACnB,OAAO,SAAU3V,EAAMwlB,EAASwR,GAC9B,IAAIiJ,EAAc,GACZ/3B,EAAGg4B,EAAI73B,EAAG83B,EAAIh4B,EAAGi4B,GAAOpJ,EAAOqJ,UAAU1qB,GAW/C,OAVA8hB,GAAmBz3B,EAAMwlB,EAAS,CAACkS,EAAKtpB,KACtC,MAAM0pB,EAAaJ,EAAIvQ,WAAWzS,SAASsK,MAC3C,IAAK,IAAIpe,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAQhE,GAAK,EAAG,CAC7C0f,EAAE5S,IAAIoqB,EAAWl3B,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IAAIm3B,aAAa3pB,GACxE,MAAMmT,EAAK2e,EAAK5f,EAAEpY,EACZsZ,EAAK2e,EAAK7f,EAAEjY,EACZoZ,EAAK2e,EAAK9f,EAAEnY,EAClB83B,EAAcj4B,KAAKwmB,IAAIyR,EAAa1e,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,MAG1DzZ,KAAKsH,KAAK2wB,IAhBE,GAoBjBzK,GAAsB,SAAUx1B,EAAMg3B,EAAQtB,EAAeC,GAEjE,OADoB,IAAI,WACL2K,WAAWtJ,EAAOxI,IAAKwI,EAAOM,KAAKC,eAAe,IAAKgJ,YAAY7K,EAAeC,IASjGF,GAAiB,WACrB,MAAMnV,EAAI,IAAI,UACd,OAAO,SAAUtgB,EAAMwlB,GACrB,MAAMwR,EAAS,IAAI,OACnB,IAAIwJ,EAAQC,IACRC,EAAQD,IACRE,EAAQF,IACRG,GAAQH,IACRI,GAAQJ,IACRK,GAAQL,IAiBZ,OAhBAzJ,EAAOM,IAAI5pB,IAAI,EAAG,EAAG,GACrBspB,EAAOxI,IAAI9gB,IAAI,EAAG,EAAG,GACrB+pB,GAAmBz3B,EAAMwlB,EAAS,CAACkS,EAAKtpB,KACtC,MAAM0pB,EAAaJ,EAAIvQ,WAAWzS,SAASsK,MAC3C,IAAK,IAAIpe,EAAI,EAAGA,EAAIk3B,EAAWlzB,OAAQhE,GAAK,EAC1C0f,EAAE5S,IAAIoqB,EAAWl3B,GAAIk3B,EAAWl3B,EAAI,GAAIk3B,EAAWl3B,EAAI,IAAIm3B,aAAa3pB,GACpEkS,EAAEpY,EAAIs4B,IAAMA,EAAOlgB,EAAEpY,GACrBoY,EAAEjY,EAAIq4B,IAAMA,EAAOpgB,EAAEjY,GACrBiY,EAAEnY,EAAIw4B,IAAMA,EAAOrgB,EAAEnY,GACrBmY,EAAEpY,EAAI04B,IAAMA,EAAOtgB,EAAEpY,GACrBoY,EAAEjY,EAAIw4B,IAAMA,EAAOvgB,EAAEjY,GACrBiY,EAAEnY,EAAI24B,IAAMA,EAAOxgB,EAAEnY,KAG7B6uB,EAAOM,IAAI5pB,IAAI8yB,EAAME,EAAMC,GAC3B3J,EAAOxI,IAAI9gB,IAAIkzB,EAAMC,EAAMC,GACpB9J,GA1BY,GAgCjBa,GAAsC,CAACH,EAAKtpB,KAChDspB,EAAIqJ,qBACJ,MAAMC,EAAS,IAAI,UACnBtJ,EAAIuJ,YAAYZ,UAAUW,GAC1B5yB,EAAU8yB,gBAAgBF,EAAO94B,EAAG84B,EAAO34B,EAAG24B,EAAO74B;;;;;;ACtwBhD,I,0DCAP,WAIE,WAAsBmE,GAAA,KAAAA,UAmBxB,OAjBE,YAAA60B,iBAAA,WACE,IAAMC,EAAI79B,KAAK89B,eAAeC,sBAI9B,MAFc,CAAEp5B,EAAGk5B,EAAEl5B,IAAKG,EAAG+4B,EAAE/4B,IAAKF,EAAGi5B,EAAEj5B,MAK3C,YAAAo5B,mBAAA,WACE,IAAgB5sB,EAIV2a,GAJU3a,EAIGpR,KAAK89B,eAAeG,wBAH9BlgC,OAAOiuB,OAAO5a,GAAK,IAK5B,OAAOpR,KAAK+I,QAAQ0T,YAAYsP,IAEpC,EAvBA,G,GCAA,WAIE,WAAsBhjB,GAAA,KAAAA,UA6BxB,OA3BE,YAAA60B,iBAAA,WAIE,IAHA,IAAMC,EAAI79B,KAAK89B,eAAeC,sBAExBvoB,EAAS,GACNnY,EAAIwgC,EAAEK,OAAS,EAAG7gC,GAAK,EAAGA,IAAK,CACtC,IAAM8gC,EAAKN,EAAEO,GAAG/gC,GAChBmY,EAAOhV,KAAK,CAAEmE,EAAGw5B,EAAGx5B,IAAKG,EAAGq5B,EAAGr5B,IAAKF,EAAGu5B,EAAGv5B,MAG5C,OAAO4Q,GAGT,YAAA6oB,oBAAA,WAQE,IAPA,IAAgBjtB,EAIVktB,EAAM,GAENxgC,EAAIkC,KAAK89B,eAAeS,yBACrBlhC,EAAIS,EAAEogC,OAAS,EAAG7gC,GAAK,EAAGA,IAAK,CACtC,IAAM0uB,GARQ3a,EAQKtT,EAAEsgC,GAAG/gC,GAPjBU,OAAOiuB,OAAO5a,GAAK,IAS1BktB,EAAI99B,KAAKR,KAAK+I,QAAQ0T,YAAYsP,IAEpC,OAAOuS,GAEX,EAjCA,GCEA,cAOE,WAAsBv1B,GAAA,KAAAA,UA0BxB,OAxBE,YAAAy1B,gBAAA,SAAgB75B,EAAOG,EAAOF,QAAd,IAAAD,MAAA,QAAO,IAAAG,MAAA,QAAO,IAAAF,MAAA,GAC5B5E,KAAKy+B,WAAWnzB,SAAS3G,EAAGG,EAAGF,GAC/B5E,KAAK89B,eAAeY,mBAAmB1+B,KAAKy+B,aAG9C,YAAAE,cAAA,SAAch6B,EAAOG,EAAOF,QAAd,IAAAD,MAAA,QAAO,IAAAG,MAAA,QAAO,IAAAF,MAAA,GAC1B5E,KAAK4+B,SAAStzB,SAAS3G,EAAGG,EAAGF,GAC7B5E,KAAK89B,eAAee,iBAAiB7+B,KAAK4+B,WAG5C,YAAAE,OAAA,WACE,OAAO9+B,KAAK89B,eAAegB,UAG7B,YAAAC,QAAA,WACE/+B,KAAK+I,QAAQiW,aAAa+f,QAAQ/+B,KAAKy+B,WAAYz+B,KAAK4+B,SAAU5+B,KAAK89B,iBAGzE,YAAApc,QAAA,WACEpb,KAAKob,QAAQ1hB,KAAKg/B,eAClB14B,KAAKob,QAAQ1hB,KAAKy+B,YAClBn4B,KAAKob,QAAQ1hB,KAAK4+B,UAClBt4B,KAAKob,QAAQ1hB,KAAK89B,iBAEtB,EAjCA,GAsCA,GAUE,SAAsB/0B,GAAA,KAAAA,UATZ,KAAAi2B,cAAgC,IAAI14B,KAAKwD,UAAU,EAAG,EAAG,GACzD,KAAA20B,WAAa,IAAIn4B,KAAKwD,UAAU,EAAG,EAAG,GACtC,KAAA80B,SAAW,IAAIt4B,KAAKwD,UAAU,EAAG,EAAG,GAEpC,KAAAg0B,eAAgD,IAAIx3B,KAAK24B,yBACjEj/B,KAAKg/B,cACLh/B,KAAKg/B,gBAMT,GAUE,SAAsBj2B,GAAA,KAAAA,UATZ,KAAAi2B,cAAgC,IAAI14B,KAAKwD,UAAU,EAAG,EAAG,GACzD,KAAA20B,WAAa,IAAIn4B,KAAKwD,UAAU,EAAG,EAAG,GACtC,KAAA80B,SAAW,IAAIt4B,KAAKwD,UAAU,EAAG,EAAG,GAEpC,KAAAg0B,eAAgD,IAAIx3B,KAAK44B,yBACjEl/B,KAAKg/B,cACLh/B,KAAKg/B,gBAMT,IAAYG,GAAkB,CAACC,GAAW,KAC1C,IAAYC,GAAkB,CAACD,GAAW,KChE1C,kBAOE,WAAYj4B,QAAA,IAAAA,OAAA,GACVnH,KAAKmH,eAA0BhF,IAAdgF,GAA0BA,EAC3CnH,KAAK8H,UAAY,EACjB9H,KAAKs/B,QAAU,EACft/B,KAAKu/B,YAAc,EACnBv/B,KAAKw/B,SAAU,EAyCnB,OAtCE,YAAA53B,MAAA,WACE5H,KAAK8H,WAAoC,oBAAhB23B,YAA8Bn4B,KAAOm4B,aAAal4B,MAE3EvH,KAAKs/B,QAAUt/B,KAAK8H,UACpB9H,KAAKu/B,YAAc,EACnBv/B,KAAKw/B,SAAU,GAGjB,YAAAx3B,KAAA,WACEhI,KAAKmI,iBACLnI,KAAKw/B,SAAU,EACfx/B,KAAKmH,WAAY,GAGnB,YAAAgB,eAAA,WAEE,OADAnI,KAAKkI,WACElI,KAAKu/B,aAGd,YAAAr3B,SAAA,WACE,IAAIw3B,EAAO,EAEX,GAAI1/B,KAAKmH,YAAcnH,KAAKw/B,QAE1B,OADAx/B,KAAK4H,QACE,EAGT,GAAI5H,KAAKw/B,QAAS,CAChB,IAAIG,GAAkC,oBAAhBF,YAA8Bn4B,KAAOm4B,aAAal4B,MAExEm4B,GAAQC,EAAU3/B,KAAKs/B,SAAW,IAClCt/B,KAAKs/B,QAAUK,EAEf3/B,KAAKu/B,aAAeG,EAGtB,OAAOA,GAEX,EArDA,G,8tBCqCA,eAkBE,WAAmBnxB,EAAkCmO,QAAA,IAAAA,MAAA,IAArD,MACE,cAAO,KASP,GAViB,EAAAnO,QAAkC,EAAAmO,SAb3C,EAAAmP,YAAkC,GAClC,EAAApP,YAAsC,GACtC,EAAAqP,0BAA4E,GAcpF,EAAKtd,WAAuB,aAAVD,EAClB,EAAK9E,SAAW,IAAI,QACpB,EAAKE,cAAgB,IAAI,aACzB,EAAK0kB,WAAa,IAAI,UACtB,EAAKxkB,aAAe,IAAIvD,KAAKwD,UAC7B,EAAKC,gBAAkB,IAAIzD,KAAK0D,aAAa,EAAG,EAAG,EAAG,GAExC,aAAVuE,EAAsB,CACxB,EAAKE,gBAAkB,IAAI,KAE3B,IAAMsN,EAAU,oBAAoB,WACpCxc,QAAQqgC,IACN,kBAAkB7jB,EAAO,2BACzB,sBACA,sBACA,sBACA,sBACA,oCACA,oB,OAIJ,EAAKrf,QAAU,IAAI,KAAU6R,GAE7B,EAAKoiB,QAAU,IAAI,UACnB,EAAKpD,YAAc,IAAI,UACvB,EAAKC,aAAe,IAAI,UAExB,EAAKf,QAAU/P,EAAO+P,SAAW,CAAE9nB,EAAG,EAAGG,GAAI,KAAMF,EAAG,GAEtD,EAAKgD,Q,EA4UT,OA/X0B,QAsDxB,sBAAW,oBAAK,C,IAAhB,sBACE,OAAI5H,KAAKwO,WAAmB,KAErB,CACLiV,OAAQ,WACN,EAAKT,YAAYS,UAEnBjlB,KAAM,SAAC6mB,QAAA,IAAAA,MAAA,GACL,EAAKrC,YAAYM,aAAa+B,IAEhC3B,QAAS,WACP,EAAKV,YAAYU,a,gCAKf,YAAA9b,MAAR,sBACsB,oBAATtB,KAKS,mBAATA,KACTA,OAAOC,MAAK,WACV,EAAK4lB,WAEJnsB,KAAKmsB,QARR,IAAO,uCAWX,sBAAW,kBAAG,C,IAAd,sBACE,MAAO,CACL0T,SAAU,SACRje,EACAC,EACAC,GACG,SAAKH,YAAYC,EAASC,EAASC,IACxCge,YAAa9/B,KAAK+/B,eAClB7vB,SAAU,SAACnR,EAA0B2d,GAA+B,SAAKvM,YAAYpR,EAAQ2d,IAC7FhO,MAAO,SAACC,EAA+BC,GACrC,YADM,IAAAD,MAAA,SAA+B,IAAAC,MAAA,IACrC,EAAKwB,SAASzB,EAAaC,IAC7BK,OAAQ,SAACC,EAAiCN,GACxC,YADO,IAAAM,MAAA,SAAiC,IAAAN,MAAA,IACxC,EAAK6B,UAAUvB,EAAcN,IAC/B0B,OAAQ,SAACC,EAAiC3B,GACxC,YADO,IAAA2B,MAAA,SAAiC,IAAA3B,MAAA,IACxC,EAAK4B,UAAUD,EAAc3B,IAC/BE,IAAK,SAACC,EAA2BH,GAAwC,YAAnE,IAAAG,MAAA,SAA2B,IAAAH,MAAA,IAAwC,EAAKyB,OAAOtB,EAAWH,IAChGQ,SAAU,SAACC,EAAqCT,GAC9C,YADS,IAAAS,MAAA,SAAqC,IAAAT,MAAA,IAC9C,EAAK8B,YAAYrB,EAAgBT,IACnCW,KAAM,SAACC,EAA6BZ,GAClC,YADK,IAAAY,MAAA,SAA6B,IAAAZ,MAAA,IAClC,EAAK+B,QAAQnB,EAAYZ,IAC3Bc,MAAO,SAACC,EAA+Bf,GACrC,YADM,IAAAe,MAAA,SAA+B,IAAAf,MAAA,IACrC,EAAKgC,SAASjB,EAAaf,IAC7BiB,QAAS,SAACC,EAA8BlB,GACtC,YADsC,IAAAA,MAAA,IACtC,EAAKiC,WAAWf,EAAelB,IAKjCoxB,UAAW,SAACzuB,GACV,YADU,IAAAA,MAAA,WACG,YAATA,EAA2B,IAAI4tB,GAAiB,GACxC,IAAIE,GAAiB,M,gCAKhC,YAAAY,iBAAP,SAAwBrJ,GACtB,IAAMsJ,EAAgB,IAAI55B,KAAK65B,gBAe/B,OAdAvJ,EAAOh0B,SAAQ,SAACwO,EAAU/T,G,MAClBwN,EAAY,IAAIvE,KAAK8X,YAErBoQ,EAAM,IAAI,UAAQpd,EAAIzM,GAAK,EAAGyM,EAAItM,GAAK,EAAGsM,EAAIxM,GAAK,GACzD,GAAW,QAAX,EAAIwM,EAAIgvB,WAAG,eAAEn3B,OAAQ,CACnB,IAAMnL,EAAIsT,EAAIgvB,IAAIn3B,OAClBulB,EAAIxd,IAAI,IAAI,UAAQlT,EAAE6G,EAAG7G,EAAEgH,EAAGhH,EAAE8G,IAElCiG,EAAUwT,cACVxT,EAAU0T,UAAU,IAAIjY,KAAKwD,UAAU0kB,EAAI7pB,GAAK,EAAG6pB,EAAI1pB,GAAK,EAAG0pB,EAAI5pB,GAAK,IAGxEs7B,EAAcG,cAAcx1B,EAAW+rB,EAAOv5B,OAEzC6iC,GAGC,YAAA/vB,YAAV,SAAsBpR,EAA0B2d,GAAhD,I,MAAA,YAAgD,IAAAA,MAAA,IACtC,IAAA8R,EAAA,EAAArd,SAAemvB,EAAA,EAAAjV,WAAkBtnB,EAAA,EAAAA,QAGvC,IAAA4Y,YAAA,IAAO,EAAP,IACA,IAAAhL,kBAAA,IAAa,GAAb,EACA,IAAA1I,cAAA,IAAS,OAAT,IACA,IAAA2tB,cAAA,IAAS,EAAT,KACA,IAAAxtB,iBAAA,IAAY,GAAZ,EACA,IAAAm3B,oBAAA,IAAe,GAAf,EACA,IAAAC,YAGIC,EAAgB,CACpBnuB,MAAO,EACPC,OAAQ,EACRR,MAAO,EACPhE,OAAQ,EACR2F,UAAW,EACXC,aAAc,EACdO,KAAM,GACNE,gBAAiB,GAIbssB,EAAkB,SAftB,IAAc,GAAd,IAgBiB3hC,EAAO2hC,SAASr/B,QAAU,GAC3CtC,EAAO2hC,SAAS99B,SAAQ,SAAC+9B,GACvB,GAAIA,EAAMtE,OAAQ,CAChB,IAAM,EAAQ,EAAKlsB,YAAYwwB,EAAO,CAAEJ,cAAc,IACtD,EAAMH,IAAM,CAAEn3B,OAAQ03B,EAAMxvB,SAAS2V,SACrC4Z,EAASlgC,KAAK,OAKpB,IAAIkR,EAAQ,MACNH,GAAsB,QAAf,EAAAxS,EAAO+G,gBAAQ,eAAEyL,OAAQ,MAElC,OAAOqvB,KAAKrvB,GAAOG,EAAQ,MACtB,QAAQkvB,KAAKrvB,GAAOG,EAAQ,OAC5B,YAAYkvB,KAAKrvB,GAAOG,EAAQ,WAChC,WAAWkvB,KAAKrvB,GAAOG,EAAQ,UAC/B,SAASkvB,KAAKrvB,GAAOG,EAAQ,QAC7B,UAAUkvB,KAAKrvB,GAAOG,EAAQ,SAC9B,SAASkvB,KAAKrvB,KAAOG,EAAQ,SAEtC,IAAIkmB,EAAS,GAsBb,GArBIlb,EAAOhL,OACTkmB,EAAS,SAAK6I,GAAkB/jB,GAChChL,EAAQgL,EAAOhL,OACN3S,EAAO2S,OAEhBkmB,EAAS,SAAK6I,GAAkC,QAArB,EAAK1hC,aAAM,EAANA,EAAQ+G,gBAAQ,eAAE+6B,YAClDnvB,EAAQ3S,EAAO2S,OAGfkmB,EAAS,SAAK6I,GAAkC,QAArB,EAAK1hC,aAAM,EAANA,EAAQ+G,gBAAQ,eAAE+6B,YAIpD9iC,OAAOwW,KAAKqjB,GAAQh1B,SAAQ,SAAAhE,QAEC,IAAhBg5B,EAAOh5B,IAAwB6hC,EAAc7hC,KAEtDg5B,EAAOh5B,GAAO6hC,EAAc7hC,OAI5BmF,EACF,IAAO,WAAWhF,EAAOnB,KAAI,sCAD/B,CAaA,IAAIkjC,EAGJ,GAVInvB,GAAY5S,EAAO+G,SAASsM,SAGlB,YAAVV,IAAqBA,EAAQ,QACnB,SAAVA,GAA8B,WAAVA,IAAoBA,EAAQ,cACtC,YAAVA,IAAqBA,EAAQ,eAK7BklB,EAAOv1B,OAAS,EAAG,CACrB,IAAM,EAAa,GAEnBu1B,EAAOh0B,SAAQ,SAAAwO,GACb,IAAMhS,EAAI,EAAK2hC,SAAS,CAAErvB,MAAON,EAAIM,MAAOkmB,OAAQ,MAAKxmB,KAEzDhS,EAAEghC,IAAM,CAAEn3B,OAAQ,CAAEtE,EAAGyM,EAAIzM,GAAK,EAAGG,EAAGsM,EAAItM,GAAK,EAAGF,EAAGwM,EAAIxM,GAAK,IAE9D,EAAIpE,KAAKpB,MAGX0hC,EAAQ9gC,KAAKigC,iBAAiB,QAE9Ba,EAAQ9gC,KAAK+gC,SAAS,CAAErvB,MAAK,EAAEklB,OAAM,EAAEgB,OAAM,EAAE74B,OAAM,EAAEuhC,KAAI,IAG7D,GAAKQ,EAAL,CAWA,GANIJ,EAASr/B,QAAU,IACrBy/B,EAAQ9gC,KAAKigC,iBAAiB,IAACa,GAAUJ,KAG3CI,EAAMjN,UAAU,MAEX0M,EAAc,OAAOO,EAE1B9gC,KAAKghC,oBAAoBjiC,EAAQ+hC,EAAO,CAAEnkB,KAAI,EAAE6R,IAAG,EAAE8R,KAAI,EAAEl3B,UAAS,EAAEH,OAAM,EAAEyT,OAAM,SAZlF,IAAO,8BAA8BhL,EAAK,QAevC,YAAAsvB,oBAAP,SAA2BjiC,EAAa+hC,EAAY7e,GAEhD,QAAAtF,YAAA,IAAO,EAAP,IACA,IAAA6R,WAAA,IAAM,EAAN,uBACA,IAAA8R,YAAA,IAAO,EAAP,4BACA,IAAAl3B,iBAAA,IAAY,GAAZ,EACA,IAAAH,cAAA,IAAS,EAAT,gBACA,IAAAyT,cAAA,IAAS,EAAT,KAEF1c,KAAKugC,aAAaxhC,EAAQ+hC,EAAOnkB,EAAM6R,EAAK8R,GAC5CtgC,KAAKihC,kBAAkBliC,EAAQ2d,GAE3BtT,IAAWrK,EAAOke,KAAK7T,WAAY,GACnCH,IAAQlK,EAAOke,KAAKhU,OAAS,IAAEtE,EAAG,EAAGG,EAAG,EAAGF,EAAG,GAAMqE,KAGlD,YAAA83B,SAAR,SAAiBG,GACP,IAEJJ,EAFIpvB,EAAA,EAAAA,MAAO3S,EAAA,EAAAA,OAAQ64B,EAAA,EAAAA,OAAQ0I,EAAA,EAAAA,KAG/B,OAAQ5uB,GACN,IAAK,QACHovB,EAAQ3P,EAAsBpyB,EAAQ,CAAEwS,KAAM,OAAQgpB,SAAS,IAC/D,MACF,IAAK,MACHuG,EAAQ,IAAIx6B,KAAKisB,WAAW,IAAIjsB,KAAKwD,UAAU8tB,EAAOtlB,MAAQ,EAAGslB,EAAOrlB,OAAS,EAAGqlB,EAAO7lB,MAAQ,IACnG,MACF,IAAK,SACH+uB,EAAQ,IAAIx6B,KAAKitB,cAAcqE,EAAO7pB,QACtC,MACF,IAAK,WACH+yB,EAAQ,IAAIx6B,KAAKqsB,gBAAgB,IAAIrsB,KAAKwD,UAAU8tB,EAAOlkB,UAAWkkB,EAAOrlB,OAAS,EAAG,IACzF,MACF,IAAK,OACHuuB,EAAQ,IAAIx6B,KAAK2sB,YAAY2E,EAAO7pB,OAAQ6pB,EAAOrlB,QACnD,MACF,IAAK,QACHuuB,EL3UqB,SAACpkB,EAAmE4jB,GACvF,QAAAvyB,cAAA,IAAS,EAAT,IAAY,IAAAmG,YAAA,IAAO,EAAP,KAAY,IAAAE,uBAAA,IAAkB,EAAlB,IAE1B+sB,EAAU18B,KAAKuP,GACfotB,EAAehtB,EACfitB,EAAM58B,KAAKsH,KAAK,EAAMmI,EAAOA,EAAO,EAAMA,EAAOA,EAAOzP,KAAK68B,IAAK,EAAMH,EAAWC,IAEnF/O,EAAgB,IAAI/rB,KAAKwD,UAAUoK,EAAMitB,EAAUC,EAAe,GAAMC,EAAKntB,GAC7EqtB,EAAgB,IAAIj7B,KAAKqsB,gBAAgBN,GAC/CkP,EAAc1N,UAAU,KAQxB,IANA,IAAMqM,EAAgB,IAAI55B,KAAK65B,gBAEzBqB,EAAU,IAAIl7B,KAAKwD,UAAU,EAAG,EAAG,GACnC6I,EAAO,IAAIrM,KAAKwD,UAAU,EAAGiE,EAAQ,GACrC0zB,EAAW,IAAIn7B,KAAK0D,aAAas2B,EAAK37B,EAAG27B,EAAKx7B,EAAGw7B,EAAK17B,EAAG07B,EAAK90B,GAE3D7G,EAAI,EAAGA,EAAIy8B,EAAcz8B,IAAK,CACrC,IAAMmH,EAAa,EAAJnH,EAAUw8B,EAAWC,EAC9BjwB,EAAWwB,EAAK+uB,OAAOF,EAAS11B,GAChCjB,EAAY,IAAIvE,KAAK8X,YAC3BqjB,EAASt2B,YAAYq2B,EAAS11B,EAAQrH,KAAKuP,GAAK,GAChDnJ,EAAUwT,cACVxT,EAAU0T,UAAUpN,GACpBtG,EAAUM,YAAYs2B,GACtBvB,EAAcG,cAAcx1B,EAAW02B,GAGzC,OAAOrB,EK+SOyB,CAAc/J,EAAQ0I,GAC9B,MACF,IAAK,UACHQ,EAAQ,IAAIx6B,KAAKwsB,eAAe8E,EAAO7pB,OAAQ6pB,EAAOrlB,QACtD,MACF,IAAK,OACHuuB,EAAQ3P,EAAsBpyB,EAAQ,CAAEwS,KAAM,SAC9C,MACF,IAAK,OACHuvB,EAAQ3P,EAAsBpyB,EAAQ,CAAEwS,KAAM,SAC9C,MACF,IAAK,QACHuvB,EAAQ3P,EAAsBpyB,EAAQ,CAAEwS,KAAM,UAC9C,MACF,IAAK,aACHuvB,EAAQ3P,EAAsBpyB,EAAQ,CAAEwS,KAAM,OAAQgpB,SAAS,IAC/D,MACF,IAAK,cACHuG,EAAQ3P,EAAsBpyB,EAAQ,CAAEwS,KAAM,OAAQgpB,SAAS,IAInE,GAAIh5B,MAAM0P,QAAQ6vB,GAAQ,CACxB,IAAM,EAAgB,IAAIx6B,KAAK65B,gBAC/BW,EAAMl+B,SAAQ,SAAA8O,GACZ,IAAM7G,EAAY,IAAIvE,KAAK8X,YAC3BvT,EAAUwT,cACV,EAAcgiB,cAAcx1B,EAAW6G,MAEzCovB,EAAQ,EAGV,OAAOA,GAGC,YAAAc,gBAAV,SAA0BC,EAAmBllB,EAAc6R,EAAc8R,GACvE,IAAMz1B,EAAY,IAAIvE,KAAK8X,YAC3BvT,EAAUwT,cACVxT,EAAU0T,UAAU,IAAIjY,KAAKwD,UAAU0kB,EAAI7pB,EAAG6pB,EAAI1pB,EAAG0pB,EAAI5pB,IACzDiG,EAAUM,YAAY,IAAI7E,KAAK0D,aAAas2B,EAAK37B,EAAG27B,EAAKx7B,EAAGw7B,EAAK17B,EAAG07B,EAAK90B,IACzE,IAAMs2B,EAAc,IAAIx7B,KAAKy7B,qBAAqBl3B,GAC5Cm3B,EAAe,IAAI17B,KAAKwD,UAAU,EAAG,EAAG,GAC1C6S,EAAO,GACTklB,EAAaI,sBAAsBtlB,EAAMqlB,GAE3C,IAAME,EAAS,IAAI57B,KAAK67B,4BAA4BxlB,EAAMmlB,EAAaD,EAAcG,GAErF,OADkB,IAAI17B,KAAK2oB,YAAYiT,IAI/B,YAAA3B,aAAV,SACE6B,EACAP,EACAllB,EACA6R,EACA8R,EACArL,GAEAmN,EAAYjxB,SAASyW,KAAK4G,GAC1B4T,EAAY/W,WAAWzD,KAAK0Y,GAE5B,IAAM+B,EAAYriC,KAAK4hC,gBAAgBC,EAAcllB,EAAM6R,EAAK8R,GAEhE,GAAIrL,EAAO,CACT,IAAM+G,EAAa,IAAI11B,KAAKwD,UAAUmrB,EAAMtwB,EAAGswB,EAAMnwB,EAAGmwB,EAAMrwB,GAC9Di9B,EAAajG,gBAAgBI,GAC7B11B,KAAKob,QAAQsa,GAGXrf,EAAO,GAET0lB,EAAUC,mBAAmB,GAG/BtiC,KAAK6rB,YAAYrrB,KAAK4hC,GACtBpiC,KAAKgf,aAAauhB,aAAa8B,GAE/B,IAAMtW,EAAMhuB,OAAOiuB,OAAOqW,GAAW,GAErCA,EAAUzkC,KAAOwkC,EAAYxkC,KAC7BwkC,EAAYnlB,KAAO,IAAI,IAAYjd,KAAMqiC,GACzCD,EAAYr+B,SAAU,EAEtBq+B,EAAYrW,IAAMA,EAClB/rB,KAAKyc,YAAYsP,GAAOqW,GAGhB,YAAAnB,kBAAV,SAA4B7vB,EAAuBsL,GACzC,QAAA6lB,gBAAA,IAAW,EAAX,KAAgB,IAAA3lB,sBAAA,IAAiB,EAAjB,IACxBxL,EAAI6L,KAAK7P,kBAAkBwP,GAC3BxL,EAAI6L,KAAKzP,YAAY+0B,IAEzB,EA/XA,CAA0B,KAiY1B,IAAY,GAAa,CAAC,EAAS,EAAa,EAAQ,IClbxD","file":"enable3d.ammoPhysics.0.17.0.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ENABLE3D\"] = factory(require(\"THREE\"));\n\telse\n\t\troot[\"ENABLE3D\"] = factory(root[\"THREE\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar logger = function (msg) {\n    console.error(\"%c [enable3d] \" + msg + \" \", 'background: #222; color: #bada55');\n};\nexports.default = logger;\n//# sourceMappingURL=logger.js.map","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// https://www.typescriptlang.org/docs/handbook/mixins.html\nvar applyMixins = function (derivedCtor, baseCtors) {\n    baseCtors.forEach(function (baseCtor) {\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach(function (name) {\n            // @ts-ignore\n            Object.defineProperty(derivedCtor.prototype, name, Object.getOwnPropertyDescriptor(baseCtor.prototype, name));\n        });\n    });\n};\nexports.default = applyMixins;\n//# sourceMappingURL=applyMixins.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar logger_1 = __importDefault(require(\"./logger\"));\n/**\n * Extends the Object3D class from THREE.js and implements properties from Line, Mesh and Points.\n */\nvar ExtendedObject3D = /** @class */ (function (_super) {\n    __extends(ExtendedObject3D, _super);\n    function ExtendedObject3D() {\n        var _this = _super.call(this) || this;\n        _this.vector3 = new index_1.Vector3();\n        _this.hasBody = false;\n        _this.anims = {};\n        _this.currentAnimation = '';\n        _this.name = \"object-\" + _this.id;\n        return _this;\n    }\n    Object.defineProperty(ExtendedObject3D.prototype, \"world\", {\n        /** Returns all values relative to the world. */\n        get: function () {\n            return {\n                theta: this.worldTheta,\n                phi: this.worldPhi\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedObject3D.prototype, \"worldTheta\", {\n        /** Get the theta relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.atan2(this.vector3.x, this.vector3.z);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedObject3D.prototype, \"worldPhi\", {\n        /** Get the phi relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.acos(this.vector3.y);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtendedObject3D.prototype.setAction = function (name) {\n        var _a;\n        if (this.mixer && this.anims.hasOwnProperty(name)) {\n            var action = (_a = this.mixer) === null || _a === void 0 ? void 0 : _a.clipAction(this.anims[name]);\n            action.time = 0;\n            this.mixer.stopAllAction();\n            action.fadeIn(0.5);\n            action.play();\n            this.currentAnimation = name;\n        }\n        else {\n            logger_1.default(\"[Phaser3D] Can't set animation \" + name);\n        }\n    };\n    return ExtendedObject3D;\n}(index_1.Object3D));\nexports.default = ExtendedObject3D;\n//# sourceMappingURL=extendedObject3D.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar DefaultMaterial = /** @class */ (function () {\n    function DefaultMaterial() {\n        this._defaultMaterial = new index_1.MeshLambertMaterial({ color: 0xcccccc });\n    }\n    DefaultMaterial.prototype.get = function () {\n        return this._defaultMaterial;\n    };\n    return DefaultMaterial;\n}());\nexports.default = DefaultMaterial;\n//# sourceMappingURL=defaultMaterial.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar logger_1 = __importDefault(require(\"./logger\"));\nvar ExtendedMesh = /** @class */ (function (_super) {\n    __extends(ExtendedMesh, _super);\n    function ExtendedMesh(geometry, material) {\n        var _this = _super.call(this, geometry, material) || this;\n        _this.vector3 = new index_1.Vector3();\n        _this.hasBody = false;\n        _this.anims = {};\n        _this.currentAnimation = '';\n        _this.name = \"object-\" + _this.id;\n        return _this;\n    }\n    Object.defineProperty(ExtendedMesh.prototype, \"world\", {\n        /** Returns all values relative to the world. */\n        get: function () {\n            return {\n                theta: this.worldTheta,\n                phi: this.worldPhi\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedMesh.prototype, \"worldTheta\", {\n        /** Get the theta relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.atan2(this.vector3.x, this.vector3.z);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedMesh.prototype, \"worldPhi\", {\n        /** Get the phi relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.acos(this.vector3.y);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtendedMesh.prototype.setAction = function (name) {\n        var _a;\n        if (this.mixer && this.anims.hasOwnProperty(name)) {\n            var action = (_a = this.mixer) === null || _a === void 0 ? void 0 : _a.clipAction(this.anims[name]);\n            action.time = 0;\n            this.mixer.stopAllAction();\n            action.fadeIn(0.5);\n            action.play();\n            this.currentAnimation = name;\n        }\n        else {\n            logger_1.default(\"[Phaser3D] Can't set animation \" + name);\n        }\n    };\n    return ExtendedMesh;\n}(index_1.Mesh));\nexports.default = ExtendedMesh;\n//# sourceMappingURL=extendedMesh.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar wasmLoader_1 = __importDefault(require(\"./wasmLoader\"));\nvar PhysicsLoader = function (path, callback) {\n    if (typeof window !== 'undefined')\n        window.__loadPhysics = true;\n    wasmLoader_1.default(path, function () {\n        Ammo().then(function () {\n            callback();\n        });\n    });\n};\nexports.PhysicsLoader = PhysicsLoader;\n//# sourceMappingURL=physicsLoader.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar extendedObject3D_1 = __importDefault(require(\"./extendedObject3D\"));\nexports.ExtendedObject3D = extendedObject3D_1.default;\nvar extendedMesh_1 = __importDefault(require(\"./extendedMesh\"));\nexports.ExtendedMesh = extendedMesh_1.default;\n// TODO fix this export\n// export { ThirdPersonControls } from '../misc/thirdPersonControls'\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nexports.AnimationMixer = index_1.AnimationMixer;\nexports.AnimationClip = index_1.AnimationClip;\nexports.AnimationAction = index_1.AnimationAction;\nexports.Object3D = index_1.Object3D;\nexports.Mesh = index_1.Mesh;\nexports.Material = index_1.Material;\nexports.Line = index_1.Line;\nexports.Points = index_1.Points;\nexports.Group = index_1.Group;\n//# sourceMappingURL=types.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @author       Alex Bennett (https://github.com/timetocode)\n * @copyright    Copyright (c) 2014 Alex Bennett; Project Url: https://github.com/timetocode/node-game-loop\n * @license      {@link https://github.com/timetocode/node-game-loop/blob/master/LICENSE|MIT}\n */\n/**\n * A very precise server clock for you game loop.\n * Will fallback to setTimeout() if frame rate is below 25.\n */\nvar ServerClock = /** @class */ (function () {\n    function ServerClock(fps, autoStart) {\n        if (fps === void 0) { fps = 60; }\n        if (autoStart === void 0) { autoStart = true; }\n        /**\n         * Length of a tick in milliseconds. The denominator is your desired framerate.\n         * e.g. 1000 / 20 = 20 fps,  1000 / 60 = 60 fps\n         */\n        this.tickLengthMs = 1000 / 60;\n        /** timestamp of each loop */\n        this.previousTick = Date.now();\n        /** number of times ServerClock gets called */\n        this.actualTicks = 0;\n        /** store the delta value */\n        this._delta = 0;\n        /** store is the clock is running or not */\n        this._isRunning = false;\n        this._highAccuracy = true;\n        if (autoStart)\n            this.start(fps);\n    }\n    /**\n     * Start the clock.\n     * @param fps Interval in milliseconds. Default is 60 fps.\n     */\n    ServerClock.prototype.start = function (fps) {\n        if (fps === void 0) { fps = 60; }\n        if (fps <= 25)\n            this.disableHighAccuracy();\n        this.tickLengthMs = 1000 / fps;\n        this._isRunning = true;\n        this.startTime = Date.now();\n        this.loop();\n    };\n    /** Stop the clock */\n    ServerClock.prototype.stop = function () {\n        this._isRunning = false;\n    };\n    /** Is clock running? */\n    ServerClock.prototype.isRunning = function () {\n        return this._isRunning;\n    };\n    /** Returns the last delta value. */\n    ServerClock.prototype.getDelta = function () {\n        return this._delta;\n    };\n    /** Keeps track of the total time that the clock has been running. */\n    ServerClock.prototype.getElapsedTime = function () {\n        return Date.now() - this.startTime;\n    };\n    /** Event listener for every new tick. */\n    ServerClock.prototype.onTick = function (onTickCallback) {\n        this._onTickCallback = onTickCallback;\n    };\n    ServerClock.prototype.loop = function () {\n        var _this = this;\n        if (!this._isRunning)\n            return;\n        var now = Date.now();\n        this.actualTicks++;\n        if (this.previousTick + this.tickLengthMs <= now) {\n            this._delta = (now - this.previousTick) / 1000;\n            this.previousTick = now;\n            this._onTickCallback(this._delta);\n            // console.log(\n            //   'this._delta',\n            //   this._delta,\n            //   '(target: ' + this.tickLengthMs + ' fps)',\n            //   'node ticks',\n            //   this.actualTicks\n            // )\n            this.actualTicks = 0;\n        }\n        if (this._highAccuracy) {\n            if (Date.now() - this.previousTick < this.tickLengthMs - 16) {\n                setTimeout(function () { return _this.loop(); });\n            }\n            else {\n                setImmediate(function () { return _this.loop(); });\n            }\n        }\n        else {\n            setTimeout(function () {\n                _this.loop();\n            }, this.tickLengthMs);\n        }\n    };\n    /** Disable high accuracy to save some cpu power. This is very useful while developing. */\n    ServerClock.prototype.disableHighAccuracy = function () {\n        this._highAccuracy = false;\n    };\n    /** Enable hight accuracy. Much more precise but uses much more cpu power. */\n    ServerClock.prototype.enableHighAccuracy = function () {\n        this._highAccuracy = true;\n    };\n    return ServerClock;\n}());\nexports.ServerClock = ServerClock;\n//# sourceMappingURL=serverClock.js.map","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar PhysicsBody = /** @class */ (function () {\n    function PhysicsBody(physics, ammo) {\n        this.physics = physics;\n        this.ammo = ammo;\n        this.offset = { x: 0, y: 0, z: 0 };\n        this.errors = [];\n        this.checkCollisions = false;\n        this.breakable = false;\n        this.collided = false;\n        this.didUpdate = false;\n        this._emitUpdateEvents = false;\n        this._needUpdate = false;\n        this.tmpEuler = new index_1.Euler();\n        this.tmpQuaternion = new index_1.Quaternion();\n        this.tmpBtVector3 = new Ammo.btVector3();\n        this.tmpBtQuaternion = new Ammo.btQuaternion(0, 0, 0, 1);\n        // @ts-ignore\n        this.name = ammo.name;\n    }\n    PhysicsBody.prototype.setupEventEmitter = function () {\n        if (typeof this.eventEmitter === 'undefined')\n            this.eventEmitter = new eventemitter3_1.default();\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"needUpdate\", {\n        get: function () {\n            return this._needUpdate;\n        },\n        set: function (need) {\n            if (!need && this._needUpdate)\n                this.didUpdate = true;\n            this._needUpdate = need;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PhysicsBody.prototype.onUpdateEvent = function (updateCallback, once) {\n        if (once === void 0) { once = false; }\n        this.setupEventEmitter();\n        this._emitUpdateEvents = true;\n        if (once)\n            this.eventEmitter.once('update', function () {\n                updateCallback();\n            });\n        else\n            this.eventEmitter.on('update', function () {\n                updateCallback();\n            });\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"on\", {\n        get: function () {\n            var _this = this;\n            return {\n                update: function (updateCallback) { return _this.onUpdateEvent(updateCallback); },\n                collision: function (collisionCallback) {\n                    return _this.onCollision(collisionCallback);\n                }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PhysicsBody.prototype, \"once\", {\n        get: function () {\n            var _this = this;\n            return {\n                update: function (updateCallback) { return _this.onUpdateEvent(updateCallback, true); }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PhysicsBody.prototype.onCollision = function (collisionCallback) {\n        var _this = this;\n        this.checkCollisions = true;\n        this.physics.on('collision', function (data) {\n            var bodies = data.bodies, event = data.event;\n            if (bodies[0].name === _this.name)\n                collisionCallback(bodies[1], event);\n            else if (bodies[1].name === _this.name)\n                collisionCallback(bodies[0], event);\n        });\n    };\n    /** You have to call transform() before you can get or set the body's position or rotation. (for headless mode only) */\n    PhysicsBody.prototype.transform = function () {\n        var t = this.physics.tmpTrans;\n        this.ammo.getMotionState().getWorldTransform(t);\n    };\n    /** You have to call refresh() after you set the position or rotation of the body. (for headless mode only) */\n    PhysicsBody.prototype.refresh = function () {\n        var t = this.physics.tmpTrans;\n        this.ammo.getMotionState().setWorldTransform(t);\n    };\n    /** Set the rotation in radians. (for headless mode only) */\n    PhysicsBody.prototype.setRotation = function (x, y, z) {\n        var e = this.tmpEuler.set(x, y, z);\n        var q = this.tmpQuaternion.set(0, 0, 0, 1);\n        q.setFromEuler(e);\n        this.tmpBtQuaternion.setValue(0, 0, 0, 1);\n        var ammoQuat = this.tmpBtQuaternion;\n        ammoQuat.setValue(q.x, q.y, q.z, q.w);\n        var t = this.physics.tmpTrans;\n        t.setRotation(ammoQuat);\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"rotation\", {\n        /** Get the rotation in radians. (for headless mode only) */\n        get: function () {\n            var t = this.physics.tmpTrans;\n            var ammoQuat = t.getRotation();\n            var q = this.tmpQuaternion.set(ammoQuat.x(), ammoQuat.y(), ammoQuat.z(), ammoQuat.w());\n            var qx = q.x;\n            var qy = q.y;\n            var qz = q.z;\n            var qw = q.w;\n            // https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\n            var angle = 2 * Math.acos(qw);\n            var x = qx / Math.sqrt(1 - qw * qw);\n            var y = qy / Math.sqrt(1 - qw * qw);\n            var z = qz / Math.sqrt(1 - qw * qw);\n            return { x: x * angle || 0, y: y * angle || 0, z: z * angle || 0 };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /** Set position. (for headless mode only) */\n    PhysicsBody.prototype.setPosition = function (x, y, z) {\n        var t = this.physics.tmpTrans;\n        t.getOrigin().setValue(x, y, z);\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"position\", {\n        /** Get position. (for headless mode only) */\n        get: function () {\n            var t = this.physics.tmpTrans;\n            return { x: t.getOrigin().x(), y: t.getOrigin().y(), z: t.getOrigin().z() };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PhysicsBody.prototype, \"velocity\", {\n        get: function () {\n            return {\n                x: this.ammo.getLinearVelocity().x(),\n                y: this.ammo.getLinearVelocity().y(),\n                z: this.ammo.getLinearVelocity().z()\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PhysicsBody.prototype, \"angularVelocity\", {\n        get: function () {\n            return {\n                x: this.ammo.getAngularVelocity().x(),\n                y: this.ammo.getAngularVelocity().y(),\n                z: this.ammo.getAngularVelocity().z()\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PhysicsBody.prototype.setVelocity = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setVelocityX = function (value) {\n        this.tmpBtVector3.setValue(value, this.velocity.y, this.velocity.z);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setVelocityY = function (value) {\n        this.tmpBtVector3.setValue(this.velocity.x, value, this.velocity.z);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setVelocityZ = function (value) {\n        this.tmpBtVector3.setValue(this.velocity.x, this.velocity.y, value);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocity = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocityX = function (value) {\n        this.tmpBtVector3.setValue(value, this.angularVelocity.y, this.angularVelocity.z);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocityY = function (value) {\n        this.tmpBtVector3.setValue(this.angularVelocity.x, value, this.angularVelocity.z);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocityZ = function (value) {\n        this.tmpBtVector3.setValue(this.angularVelocity.x, this.angularVelocity.y, value);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForce = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForceX = function (value) {\n        this.tmpBtVector3.setValue(value, 0, 0);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForceY = function (value) {\n        this.tmpBtVector3.setValue(0, value, 0);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForceZ = function (value) {\n        this.tmpBtVector3.setValue(0, 0, value);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    /**\n     * Add the collision flags\n     * @param value 0 is DYNAMIC, 1 is STATIC, 2 is KINEMATIC, 4 GHOST\n     */\n    // https://github.com/bulletphysics/bullet3/blob/aae8048722f2596f7e2bdd52d2a1dcb52a218f2b/src/BulletCollision/CollisionDispatch/btCollisionObject.h#L128\n    PhysicsBody.prototype.setCollisionFlags = function (value) {\n        this.ammo.setCollisionFlags(value);\n    };\n    /**\n     * Get the collision flags\n     * @param value 0 is DYNAMIC, 1 is STATIC, 2 is KINEMATIC, 4 GHOST\n     */\n    PhysicsBody.prototype.getCollisionFlags = function () {\n        return this.ammo.getCollisionFlags();\n    };\n    /**\n     * Set the restitution (same as bounciness)\n     * @param value A number from 0 to 1.\n     */\n    PhysicsBody.prototype.setRestitution = function (value) {\n        this.ammo.setRestitution(value);\n    };\n    /**\n     * Set the bounciness (same as restitution)\n     * @param value A number from 0 to 1.\n     */\n    PhysicsBody.prototype.setBounciness = function (value) {\n        this.setRestitution(value);\n    };\n    /**\n     * Set the friction\n     * @param value A number from 0 to 1.\n     */\n    PhysicsBody.prototype.setFriction = function (value) {\n        this.ammo.setFriction(value);\n    };\n    /** Set per body gravity */\n    PhysicsBody.prototype.setGravity = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setGravity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setLinearFactor = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setLinearFactor(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularFactor = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setAngularFactor(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setCcdMotionThreshold = function (threshold) {\n        this.ammo.setCcdMotionThreshold(threshold);\n    };\n    PhysicsBody.prototype.setCcdSweptSphereRadius = function (radius) {\n        this.ammo.setCcdSweptSphereRadius(radius);\n    };\n    return PhysicsBody;\n}());\nexports.default = PhysicsBody;\n//# sourceMappingURL=physicsBody.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar extendedMesh_1 = __importDefault(require(\"./extendedMesh\"));\nvar logger_1 = __importDefault(require(\"./logger\"));\nvar defaultMaterial_1 = __importDefault(require(\"./defaultMaterial\"));\nvar Factories = /** @class */ (function () {\n    function Factories(scene) {\n        this.scene = scene;\n        this.isHeadless = scene === 'headless' ? true : false;\n        this.defaultMaterial = new defaultMaterial_1.default();\n    }\n    Object.defineProperty(Factories.prototype, \"make\", {\n        get: function () {\n            var _this = this;\n            return {\n                plane: function (planeConfig, materialConfig) {\n                    if (planeConfig === void 0) { planeConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makePlane(planeConfig, materialConfig);\n                },\n                box: function (boxConfig, materialConfig) {\n                    if (boxConfig === void 0) { boxConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeBox(boxConfig, materialConfig);\n                },\n                sphere: function (sphereConfig, materialConfig) {\n                    if (sphereConfig === void 0) { sphereConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeSphere(sphereConfig, materialConfig);\n                },\n                cylinder: function (cylinderConfig, materialConfig) {\n                    if (cylinderConfig === void 0) { cylinderConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeCylinder(cylinderConfig, materialConfig);\n                },\n                cone: function (coneConfig, materialConfig) {\n                    if (coneConfig === void 0) { coneConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeCone(coneConfig, materialConfig);\n                },\n                torus: function (torusConfig, materialConfig) {\n                    if (torusConfig === void 0) { torusConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeTorus(torusConfig, materialConfig);\n                },\n                extrude: function (extrudeConfig, materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeExtrude(extrudeConfig, materialConfig);\n                }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Factories.prototype, \"add\", {\n        get: function () {\n            var _this = this;\n            return {\n                // effectComposer: () => this.addEffectComposer(),\n                mesh: function (mesh) { return _this.addMesh(mesh); },\n                // group: (...children) => this.addGroup(children),\n                existing: function (object) { return _this.addExisting(object); },\n                //  Geometry\n                plane: function (planeConfig, materialConfig) {\n                    if (planeConfig === void 0) { planeConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addPlane(planeConfig, materialConfig);\n                },\n                box: function (boxConfig, materialConfig) {\n                    if (boxConfig === void 0) { boxConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addBox(boxConfig, materialConfig);\n                },\n                ground: function (groundConfig, materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addGround(groundConfig, materialConfig);\n                },\n                //...\n                sphere: function (sphereConfig, materialConfig) {\n                    if (sphereConfig === void 0) { sphereConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addSphere(sphereConfig, materialConfig);\n                },\n                cylinder: function (cylinderConfig, materialConfig) {\n                    if (cylinderConfig === void 0) { cylinderConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addCylinder(cylinderConfig, materialConfig);\n                },\n                cone: function (coneConfig, materialConfig) {\n                    if (coneConfig === void 0) { coneConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addCone(coneConfig, materialConfig);\n                },\n                torus: function (torusConfig, materialConfig) {\n                    if (torusConfig === void 0) { torusConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addTorus(torusConfig, materialConfig);\n                },\n                extrude: function (extrudeConfig, materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addExtrude(extrudeConfig, materialConfig);\n                },\n                //...\n                material: function (materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addMaterial(materialConfig);\n                }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Factories.prototype.addExisting = function () {\n        var _a;\n        var object = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            object[_i] = arguments[_i];\n        }\n        if (this.scene === 'headless')\n            return;\n        (_a = this.scene).add.apply(_a, object);\n    };\n    Factories.prototype.addMesh = function (mesh) {\n        if (Array.isArray(mesh)) {\n            for (var i = 0; i < mesh.length; i++) {\n                this.addExisting(mesh[i]);\n            }\n        }\n        else {\n            this.addExisting(mesh);\n        }\n        return this;\n    };\n    Factories.prototype.createMesh = function (geometry, material, position) {\n        var _a = position.x, x = _a === void 0 ? 0 : _a, _b = position.y, y = _b === void 0 ? 0 : _b, _c = position.z, z = _c === void 0 ? 0 : _c;\n        var obj;\n        switch (!Array.isArray(material) && material.type) {\n            case 'LineBasicMaterial':\n                obj = new index_1.Line(geometry, material);\n                break;\n            case 'PointsMaterial':\n                obj = new index_1.Points(geometry, material);\n                break;\n            default:\n                obj = new extendedMesh_1.default(geometry, material);\n                break;\n        }\n        obj.position.set(x, y, z);\n        obj.castShadow = obj.receiveShadow = true;\n        return obj;\n    };\n    Factories.prototype.makeExtrude = function (extrudeConfig, materialConfig) {\n        var x = extrudeConfig.x, y = extrudeConfig.y, z = extrudeConfig.z, name = extrudeConfig.name, shape = extrudeConfig.shape, _a = extrudeConfig.autoCenter, autoCenter = _a === void 0 ? true : _a, _b = extrudeConfig.breakable, breakable = _b === void 0 ? false : _b, _c = extrudeConfig.bufferGeometry, bufferGeometry = _c === void 0 ? true : _c, rest = __rest(extrudeConfig, [\"x\", \"y\", \"z\", \"name\", \"shape\", \"autoCenter\", \"breakable\", \"bufferGeometry\"]);\n        var _d = rest.depth, depth = _d === void 0 ? 1 : _d, _e = rest.bevelEnabled, bevelEnabled = _e === void 0 ? false : _e;\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.ExtrudeBufferGeometry(shape, __assign({ depth: depth, bevelEnabled: bevelEnabled }, rest))\n            : new index_1.ExtrudeGeometry(shape, __assign({ depth: depth, bevelEnabled: bevelEnabled }, rest));\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        // auto adjust the center for custom shapes\n        if (autoCenter)\n            mesh.geometry.center();\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'extrude';\n        return mesh;\n    };\n    Factories.prototype.addExtrude = function (extrudeConfig, materialConfig) {\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeExtrude(extrudeConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makePlane = function (planeConfig, materialConfig) {\n        var x = planeConfig.x, y = planeConfig.y, z = planeConfig.z, name = planeConfig.name, _a = planeConfig.breakable, breakable = _a === void 0 ? false : _a, _b = planeConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(planeConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.PlaneBufferGeometry(rest.width || 1, rest.height || 1, rest.widthSegments || 1, rest.heightSegments || 1)\n            : new index_1.PlaneGeometry(rest.width || 1, rest.height || 1, rest.widthSegments || 1, rest.heightSegments || 1);\n        var material = this.addMaterial(materialConfig);\n        material.side = index_1.DoubleSide;\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'plane';\n        return mesh;\n    };\n    Factories.prototype.addPlane = function (planeConfig, materialConfig) {\n        var obj = this.makePlane(planeConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeSphere = function (sphereConfig, materialConfig) {\n        var x = sphereConfig.x, y = sphereConfig.y, z = sphereConfig.z, name = sphereConfig.name, _a = sphereConfig.breakable, breakable = _a === void 0 ? false : _a, _b = sphereConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(sphereConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.SphereBufferGeometry(rest.radius || 1, rest.widthSegments || 16, rest.heightSegments || 12, rest.phiStart || undefined, rest.phiLength || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined)\n            : new index_1.SphereGeometry(rest.radius || 1, rest.widthSegments || 16, rest.heightSegments || 12, rest.phiStart || undefined, rest.phiLength || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'sphere';\n        return mesh;\n    };\n    Factories.prototype.addSphere = function (sphereConfig, materialConfig) {\n        if (sphereConfig === void 0) { sphereConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeSphere(sphereConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeBox = function (boxConfig, materialConfig) {\n        var x = boxConfig.x, y = boxConfig.y, z = boxConfig.z, name = boxConfig.name, _a = boxConfig.breakable, breakable = _a === void 0 ? false : _a, _b = boxConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(boxConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.BoxBufferGeometry(rest.width || 1, rest.height || 1, rest.depth || 1, rest.widthSegments || undefined, rest.heightSegments || undefined, rest.depthSegments || undefined)\n            : new index_1.BoxGeometry(rest.width || 1, rest.height || 1, rest.depth || 1, rest.widthSegments || undefined, rest.heightSegments || undefined, rest.depthSegments || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'box';\n        return mesh;\n    };\n    Factories.prototype.addBox = function (boxConfig, materialConfig) {\n        if (boxConfig === void 0) { boxConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeBox(boxConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.addGround = function (groundConfig, materialConfig) {\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeBox(groundConfig, materialConfig);\n        obj.rotateX(index_1.MathUtils.degToRad(90));\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeCylinder = function (cylinderConfig, materialConfig) {\n        if (cylinderConfig === void 0) { cylinderConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var x = cylinderConfig.x, y = cylinderConfig.y, z = cylinderConfig.z, name = cylinderConfig.name, _a = cylinderConfig.breakable, breakable = _a === void 0 ? false : _a, _b = cylinderConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(cylinderConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.CylinderBufferGeometry(rest.radiusTop || 1, rest.radiusBottom || 1, rest.height || 1, rest.radiusSegments || undefined, rest.heightSegments || undefined, rest.openEnded || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined)\n            : new index_1.CylinderGeometry(rest.radiusTop || 1, rest.radiusBottom || 1, rest.height || 1, rest.radiusSegments || undefined, rest.heightSegments || undefined, rest.openEnded || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'cylinder';\n        return mesh;\n    };\n    Factories.prototype.addCylinder = function (cylinderConfig, materialConfig) {\n        if (cylinderConfig === void 0) { cylinderConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeCylinder(cylinderConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeCone = function (coneConfig, materialConfig) {\n        if (coneConfig === void 0) { coneConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var x = coneConfig.x, y = coneConfig.y, z = coneConfig.z, name = coneConfig.name, _a = coneConfig.breakable, breakable = _a === void 0 ? false : _a, _b = coneConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(coneConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.ConeBufferGeometry(rest.radius || 1, rest.height || 1, rest.radiusSegments || 8, rest.heightSegments || 1, rest.openEnded || false, rest.thetaStart || 0, rest.thetaLength || 2 * Math.PI)\n            : new index_1.ConeBufferGeometry(rest.radius || 1, rest.height || 1, rest.radiusSegments || 8, rest.heightSegments || 1, rest.openEnded || false, rest.thetaStart || 0, rest.thetaLength || 2 * Math.PI);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'cone';\n        return mesh;\n    };\n    Factories.prototype.addCone = function (coneConfig, materialConfig) {\n        if (coneConfig === void 0) { coneConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeCone(coneConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    // https://threejs.org/docs/index.html#api/en/geometries/TorusBufferGeometry\n    Factories.prototype.makeTorus = function (torusConfig, materialConfig) {\n        if (torusConfig === void 0) { torusConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var x = torusConfig.x, y = torusConfig.y, z = torusConfig.z, name = torusConfig.name, _a = torusConfig.breakable, breakable = _a === void 0 ? false : _a, _b = torusConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(torusConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.TorusBufferGeometry(rest.radius || undefined, rest.tube || undefined, rest.radialSegments || undefined, rest.tubularSegments || undefined, rest.arc || undefined)\n            : new index_1.TorusGeometry(rest.radius || undefined, rest.tube || undefined, rest.radialSegments || undefined, rest.tubularSegments || undefined, rest.arc || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'torus';\n        return mesh;\n    };\n    Factories.prototype.addTorus = function (torusConfig, materialConfig) {\n        if (torusConfig === void 0) { torusConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeTorus(torusConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.addMaterial = function (materialConfig) {\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var type = Object.keys(materialConfig)[0];\n        var material;\n        // if (type) {\n        //   const { map } = materialConfig[type]\n        //   if (typeof map === 'string') materialConfig[type].map = this.loadTexture(map)\n        // }\n        // always share the same material in headless mode to save memory\n        if (this.scene === 'headless')\n            return this.defaultMaterial.get();\n        switch (type) {\n            case 'basic':\n                material = new index_1.MeshBasicMaterial(materialConfig.basic);\n                break;\n            case 'normal':\n                material = new index_1.MeshNormalMaterial(materialConfig.normal);\n                break;\n            case 'standard':\n                material = new index_1.MeshStandardMaterial(materialConfig.standard);\n                break;\n            case 'lambert':\n                material = new index_1.MeshLambertMaterial(materialConfig.lambert);\n                break;\n            case 'phong':\n                material = new index_1.MeshPhongMaterial(materialConfig.phong);\n                break;\n            case 'physical':\n                if (typeof materialConfig.physical !== 'undefined') {\n                    material = new index_1.MeshPhysicalMaterial(materialConfig.physical);\n                }\n                else {\n                    logger_1.default('You need to pass parameters to the physical material. (Fallback to default material)');\n                    material = this.defaultMaterial.get();\n                }\n                break;\n            case 'toon':\n                material = new index_1.MeshToonMaterial(materialConfig.toon);\n                break;\n            case 'line':\n                material = new index_1.LineBasicMaterial(materialConfig.line);\n                break;\n            case 'points':\n                material = new index_1.PointsMaterial(materialConfig.points);\n                break;\n            case 'custom':\n                material = materialConfig.custom || this.defaultMaterial.get();\n                break;\n            default:\n                material = this.defaultMaterial.get();\n                break;\n        }\n        return material;\n    };\n    return Factories;\n}());\nexports.default = Factories;\n//# sourceMappingURL=factories.js.map","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// Inspired by https://github.com/playcanvas/engine/blob/master/examples/wasm-loader.js\nvar wasmSupported = (function () {\n    try {\n        if (typeof WebAssembly === 'object' && typeof WebAssembly.instantiate === 'function') {\n            var module_1 = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\n            if (module_1 instanceof WebAssembly.Module)\n                return new WebAssembly.Instance(module_1) instanceof WebAssembly.Instance;\n        }\n    }\n    catch (e) { }\n    return false;\n})();\nvar loadScriptAsync = function (url, doneCallback) {\n    var tag = document.createElement('script');\n    tag.onload = function () {\n        doneCallback();\n    };\n    tag.onerror = function () {\n        throw new Error('failed to load ' + url);\n    };\n    tag.async = true;\n    tag.src = url;\n    document.head.appendChild(tag);\n};\nvar loadAmmoModule = function (path, doneCallback) {\n    // console.log(wasmSupported ? 'WebAssembly is supported' : 'WebAssembly is not supported')\n    if (wasmSupported)\n        loadScriptAsync(path + \"/ammo.wasm.js\", function () { return doneCallback(); });\n    else\n        loadScriptAsync(path + \"/ammo.js\", function () { return doneCallback(); });\n};\nexports.default = loadAmmoModule;\n//# sourceMappingURL=wasmLoader.js.map","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\n * Copied from three.js examples and added a fix\n */\n\n/**\n * @author yomboprime https://github.com/yomboprime\n *\n * @fileoverview This class can be used to subdivide a convex Geometry object into pieces.\n *\n * Usage:\n *\n * Use the function prepareBreakableObject to prepare a Mesh object to be broken.\n *\n * Then, call the various functions to subdivide the object (subdivideByImpact, cutByPlane)\n *\n * Sub-objects that are product of subdivision don't need prepareBreakableObject to be called on them.\n *\n * Requisites for the object:\n *\n *  - Mesh object must have a BufferGeometry (not Geometry) and a Material\n *\n *  - Vertex normals must be planar (not smoothed)\n *\n *  - The geometry must be convex (this is not checked in the library). You can create convex\n *  geometries with ConvexBufferGeometry. The BoxBufferGeometry, SphereBufferGeometry and other convex primitives\n *  can also be used.\n *\n * Note: This lib adds member variables to object's userData member (see prepareBreakableObject function)\n * Use with caution and read the code when using with other libs.\n *\n * @param {double} minSizeForBreak Min size a debris can have to break.\n * @param {double} smallDelta Max distance to consider that a point belongs to a plane.\n *\n */\n\nimport { Line3, Mesh, Plane, Vector3 } from '@enable3d/three-wrapper/dist/index'\nimport { ConvexBufferGeometry } from '@enable3d/three-wrapper/dist/index'\nimport logger from '@enable3d/common/dist/logger'\n\nconst ConvexObjectBreaker = function (minSizeForBreak?: number, smallDelta?: number) {\n  // @ts-ignore\n  this.minSizeForBreak = minSizeForBreak || 1.4\n  // @ts-ignore\n  this.smallDelta = smallDelta || 0.0001\n\n  // @ts-ignore\n  this.tempLine1 = new Line3()\n  // @ts-ignore\n  this.tempPlane1 = new Plane()\n  // @ts-ignore\n  this.tempPlane2 = new Plane()\n  // @ts-ignore\n  this.tempPlane_Cut = new Plane()\n  // @ts-ignore\n  this.tempCM1 = new Vector3()\n  // @ts-ignore\n  this.tempCM2 = new Vector3()\n  // @ts-ignore\n  this.tempVector3 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_2 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_3 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_P0 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_P1 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_P2 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_N0 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_N1 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_AB = new Vector3()\n  // @ts-ignore\n  this.tempVector3_CB = new Vector3()\n  // @ts-ignore\n  this.tempResultObjects = { object1: null, object2: null }\n\n  // @ts-ignore\n  this.segments = []\n  var n = 30 * 30\n  // @ts-ignore\n  for (var i = 0; i < n; i++) this.segments[i] = false\n}\n\nConvexObjectBreaker.prototype = {\n  constructor: ConvexObjectBreaker,\n\n  prepareBreakableObject: function (object: any, mass: any, velocity: any, angularVelocity: any, breakable: any) {\n    // object is a Object3d (normally a Mesh), must have a BufferGeometry, and it must be convex.\n    // Its material property is propagated to its children (sub-pieces)\n    // mass must be > 0\n\n    if (!object.geometry.isBufferGeometry) {\n      console.error('THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.')\n    }\n\n    var userData = object.userData\n    userData.mass = mass\n    userData.velocity = velocity.clone()\n    userData.angularVelocity = angularVelocity.clone()\n    userData.breakable = breakable\n  },\n\n  /*\n   * @param {int} maxRadialIterations Iterations for radial cuts.\n   * @param {int} maxRandomIterations Max random iterations for not-radial cuts\n   *\n   * Returns the array of pieces\n   */\n  subdivideByImpact: function (\n    object: any,\n    pointOfImpact: any,\n    normal: any,\n    maxRadialIterations: any,\n    maxRandomIterations: any\n  ) {\n    var debris: any = []\n\n    var tempPlane1 = this.tempPlane1\n    var tempPlane2 = this.tempPlane2\n\n    this.tempVector3.addVectors(pointOfImpact, normal)\n    tempPlane1.setFromCoplanarPoints(pointOfImpact, object.position, this.tempVector3)\n\n    var maxTotalIterations = maxRandomIterations + maxRadialIterations\n\n    var scope = this\n\n    function subdivideRadial(subObject: any, startAngle: any, endAngle: any, numIterations: any) {\n      if (Math.random() < numIterations * 0.05 || numIterations > maxTotalIterations) {\n        debris.push(subObject)\n\n        return\n      }\n\n      var angle = Math.PI\n\n      if (numIterations === 0) {\n        tempPlane2.normal.copy(tempPlane1.normal)\n        tempPlane2.constant = tempPlane1.constant\n      } else {\n        if (numIterations <= maxRadialIterations) {\n          angle = (endAngle - startAngle) * (0.2 + 0.6 * Math.random()) + startAngle\n\n          // Rotate tempPlane2 at impact point around normal axis and the angle\n          scope.tempVector3_2.copy(object.position).sub(pointOfImpact).applyAxisAngle(normal, angle).add(pointOfImpact)\n          tempPlane2.setFromCoplanarPoints(pointOfImpact, scope.tempVector3, scope.tempVector3_2)\n        } else {\n          angle = (0.5 * (numIterations & 1) + 0.2 * (2 - Math.random())) * Math.PI\n\n          // Rotate tempPlane2 at object position around normal axis and the angle\n          scope.tempVector3_2\n            .copy(pointOfImpact)\n            .sub(subObject.position)\n            .applyAxisAngle(normal, angle)\n            .add(subObject.position)\n          scope.tempVector3_3.copy(normal).add(subObject.position)\n          tempPlane2.setFromCoplanarPoints(subObject.position, scope.tempVector3_3, scope.tempVector3_2)\n        }\n      }\n\n      // Perform the cut\n      scope.cutByPlane(subObject, tempPlane2, scope.tempResultObjects)\n\n      var obj1 = scope.tempResultObjects.object1\n      var obj2 = scope.tempResultObjects.object2\n\n      if (obj1) {\n        subdivideRadial(obj1, startAngle, angle, numIterations + 1)\n      }\n\n      if (obj2) {\n        subdivideRadial(obj2, angle, endAngle, numIterations + 1)\n      }\n    }\n\n    subdivideRadial(object, 0, 2 * Math.PI, 0)\n\n    return debris\n  },\n\n  cutByPlane: function (object: any, plane: any, output: any) {\n    // Returns breakable objects in output.object1 and output.object2 members, the resulting 2 pieces of the cut.\n    // object2 can be null if the plane doesn't cut the object.\n    // object1 can be null only in case of internal error\n    // Returned value is number of pieces, 0 for error.\n\n    var geometry = object.geometry\n    var coords = geometry.attributes.position.array\n    var normals = geometry.attributes.normal.array\n\n    var numPoints = coords.length / 3\n    var numFaces = numPoints / 3\n\n    var indices = geometry.getIndex()\n\n    if (indices) {\n      indices = indices.array\n      numFaces = indices.length / 3\n    }\n\n    function getVertexIndex(faceIdx: any, vert: any) {\n      // vert = 0, 1 or 2.\n\n      var idx = faceIdx * 3 + vert\n\n      return indices ? indices[idx] : idx\n    }\n\n    var points1 = []\n    var points2 = []\n\n    var delta = this.smallDelta\n\n    // Reset segments mark\n    var numPointPairs = numPoints * numPoints\n    for (var i = 0; i < numPointPairs; i++) this.segments[i] = false\n\n    var p0 = this.tempVector3_P0\n    var p1 = this.tempVector3_P1\n    var n0 = this.tempVector3_N0\n    var n1 = this.tempVector3_N1\n\n    // Iterate through the faces to mark edges shared by coplanar faces\n    for (var i = 0; i < numFaces - 1; i++) {\n      var a1 = getVertexIndex(i, 0)\n      var b1 = getVertexIndex(i, 1)\n      var c1 = getVertexIndex(i, 2)\n\n      // Assuming all 3 vertices have the same normal\n      n0.set(normals[a1], normals[a1] + 1, normals[a1] + 2)\n\n      for (var j = i + 1; j < numFaces; j++) {\n        var a2 = getVertexIndex(j, 0)\n        var b2 = getVertexIndex(j, 1)\n        var c2 = getVertexIndex(j, 2)\n\n        // Assuming all 3 vertices have the same normal\n        n1.set(normals[a2], normals[a2] + 1, normals[a2] + 2)\n\n        var coplanar = 1 - n0.dot(n1) < delta\n\n        if (coplanar) {\n          if (a1 === a2 || a1 === b2 || a1 === c2) {\n            if (b1 === a2 || b1 === b2 || b1 === c2) {\n              this.segments[a1 * numPoints + b1] = true\n              this.segments[b1 * numPoints + a1] = true\n            } else {\n              this.segments[c1 * numPoints + a1] = true\n              this.segments[a1 * numPoints + c1] = true\n            }\n          } else if (b1 === a2 || b1 === b2 || b1 === c2) {\n            this.segments[c1 * numPoints + b1] = true\n            this.segments[b1 * numPoints + c1] = true\n          }\n        }\n      }\n    }\n\n    // Transform the plane to object local space\n    var localPlane = this.tempPlane_Cut\n    object.updateMatrix()\n    ConvexObjectBreaker.transformPlaneToLocalSpace(plane, object.matrix, localPlane)\n\n    // Iterate through the faces adding points to both pieces\n    for (var i = 0; i < numFaces; i++) {\n      var va = getVertexIndex(i, 0)\n      var vb = getVertexIndex(i, 1)\n      var vc = getVertexIndex(i, 2)\n\n      for (var segment = 0; segment < 3; segment++) {\n        var i0 = segment === 0 ? va : segment === 1 ? vb : vc\n        var i1 = segment === 0 ? vb : segment === 1 ? vc : va\n\n        var segmentState = this.segments[i0 * numPoints + i1]\n\n        if (segmentState) continue // The segment already has been processed in another face\n\n        // Mark segment as processed (also inverted segment)\n        this.segments[i0 * numPoints + i1] = true\n        this.segments[i1 * numPoints + i0] = true\n\n        p0.set(coords[3 * i0], coords[3 * i0 + 1], coords[3 * i0 + 2])\n        p1.set(coords[3 * i1], coords[3 * i1 + 1], coords[3 * i1 + 2])\n\n        // mark: 1 for negative side, 2 for positive side, 3 for coplanar point\n        var mark0 = 0\n\n        var d = localPlane.distanceToPoint(p0)\n\n        if (d > delta) {\n          mark0 = 2\n          points2.push(p0.clone())\n        } else if (d < -delta) {\n          mark0 = 1\n          points1.push(p0.clone())\n        } else {\n          mark0 = 3\n          points1.push(p0.clone())\n          points2.push(p0.clone())\n        }\n\n        // mark: 1 for negative side, 2 for positive side, 3 for coplanar point\n        var mark1 = 0\n\n        var d = localPlane.distanceToPoint(p1)\n\n        if (d > delta) {\n          mark1 = 2\n          points2.push(p1.clone())\n        } else if (d < -delta) {\n          mark1 = 1\n          points1.push(p1.clone())\n        } else {\n          mark1 = 3\n          points1.push(p1.clone())\n          points2.push(p1.clone())\n        }\n\n        if ((mark0 === 1 && mark1 === 2) || (mark0 === 2 && mark1 === 1)) {\n          // Intersection of segment with the plane\n\n          this.tempLine1.start.copy(p0)\n          this.tempLine1.end.copy(p1)\n\n          var intersection = new Vector3()\n          intersection = localPlane.intersectLine(this.tempLine1, intersection)\n\n          if (intersection === undefined) {\n            // Shouldn't happen\n            console.error('Internal error: segment does not intersect plane.')\n            output.segmentedObject1 = null\n            output.segmentedObject2 = null\n            return 0\n          }\n\n          points1.push(intersection)\n          points2.push(intersection.clone())\n        }\n      }\n    }\n\n    // Calculate debris mass (very fast and imprecise):\n    var newMass = object.userData.mass * 0.5\n\n    // Calculate debris Center of Mass (again fast and imprecise)\n    this.tempCM1.set(0, 0, 0)\n    var radius1 = 0\n    var numPoints1 = points1.length\n\n    if (numPoints1 > 0) {\n      for (var i = 0; i < numPoints1; i++) this.tempCM1.add(points1[i])\n\n      this.tempCM1.divideScalar(numPoints1)\n      for (var i = 0; i < numPoints1; i++) {\n        var p = points1[i]\n        p.sub(this.tempCM1)\n        radius1 = Math.max(radius1, p.x, p.y, p.z)\n      }\n      this.tempCM1.add(object.position)\n    }\n\n    this.tempCM2.set(0, 0, 0)\n    var radius2 = 0\n    var numPoints2 = points2.length\n    if (numPoints2 > 0) {\n      for (var i = 0; i < numPoints2; i++) this.tempCM2.add(points2[i])\n\n      this.tempCM2.divideScalar(numPoints2)\n      for (var i = 0; i < numPoints2; i++) {\n        var p = points2[i]\n        p.sub(this.tempCM2)\n        radius2 = Math.max(radius2, p.x, p.y, p.z)\n      }\n      this.tempCM2.add(object.position)\n    }\n\n    var object1 = null\n    var object2 = null\n\n    var numObjects = 0\n\n    /**\n     * MOD: Wrapped in try catch block to avoid errors\n     */\n    if (numPoints1 > 4) {\n      try {\n        object1 = new Mesh(new ConvexBufferGeometry(points1), object.material)\n        object1.position.copy(this.tempCM1)\n        object1.quaternion.copy(object.quaternion)\n\n        this.prepareBreakableObject(\n          object1,\n          newMass,\n          object.userData.velocity,\n          object.userData.angularVelocity,\n          2 * radius1 > this.minSizeForBreak\n        )\n\n        numObjects++\n      } catch (error) {\n        logger('Error in ConvexObjectBreaker.ts')\n      }\n    }\n\n    if (numPoints2 > 4) {\n      try {\n        object2 = new Mesh(new ConvexBufferGeometry(points2), object.material)\n        object2.position.copy(this.tempCM2)\n        object2.quaternion.copy(object.quaternion)\n\n        this.prepareBreakableObject(\n          object2,\n          newMass,\n          object.userData.velocity,\n          object.userData.angularVelocity,\n          2 * radius2 > this.minSizeForBreak\n        )\n\n        numObjects++\n      } catch (error) {\n        logger('Error in ConvexObjectBreaker.ts')\n      }\n    }\n\n    output.object1 = object1\n    output.object2 = object2\n\n    return numObjects\n  }\n}\n\nConvexObjectBreaker.transformFreeVector = function (v: any, m: any) {\n  // input:\n  // vector interpreted as a free vector\n  // THREE.Matrix4 orthogonal matrix (matrix without scale)\n\n  var x = v.x,\n    y = v.y,\n    z = v.z\n  var e = m.elements\n\n  v.x = e[0] * x + e[4] * y + e[8] * z\n  v.y = e[1] * x + e[5] * y + e[9] * z\n  v.z = e[2] * x + e[6] * y + e[10] * z\n\n  return v\n}\n\nConvexObjectBreaker.transformFreeVectorInverse = function (v: any, m: any) {\n  // input:\n  // vector interpreted as a free vector\n  // THREE.Matrix4 orthogonal matrix (matrix without scale)\n\n  var x = v.x,\n    y = v.y,\n    z = v.z\n  var e = m.elements\n\n  v.x = e[0] * x + e[1] * y + e[2] * z\n  v.y = e[4] * x + e[5] * y + e[6] * z\n  v.z = e[8] * x + e[9] * y + e[10] * z\n\n  return v\n}\n\nConvexObjectBreaker.transformTiedVectorInverse = function (v: any, m: any) {\n  // input:\n  // vector interpreted as a tied (ordinary) vector\n  // THREE.Matrix4 orthogonal matrix (matrix without scale)\n\n  var x = v.x,\n    y = v.y,\n    z = v.z\n  var e = m.elements\n\n  v.x = e[0] * x + e[1] * y + e[2] * z - e[12]\n  v.y = e[4] * x + e[5] * y + e[6] * z - e[13]\n  v.z = e[8] * x + e[9] * y + e[10] * z - e[14]\n\n  return v\n}\n\nConvexObjectBreaker.transformPlaneToLocalSpace = (function () {\n  var v1 = new Vector3()\n\n  return function transformPlaneToLocalSpace(plane: any, m: any, resultPlane: any) {\n    resultPlane.normal.copy(plane.normal)\n    resultPlane.constant = plane.constant\n\n    var referencePoint = ConvexObjectBreaker.transformTiedVectorInverse(plane.coplanarPoint(v1), m)\n\n    ConvexObjectBreaker.transformFreeVectorInverse(resultPlane.normal, m)\n\n    // recalculate constant (like in setFromNormalAndCoplanarPoint)\n    resultPlane.constant = -referencePoint.dot(resultPlane.normal)\n  }\n})()\n\nexport { ConvexObjectBreaker }\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport {\n  SphereConfig,\n  MaterialConfig,\n  BoxConfig,\n  GroundConfig,\n  CylinderConfig,\n  ExtendedObject3D,\n  ExtrudeConfig,\n  TorusConfig,\n  AddExistingConfig,\n  PlaneConfig,\n  ConeConfig\n} from '@enable3d/common/dist/types'\nimport Factories from '@enable3d/common/dist/factories'\n\ninterface Shapes {}\n\nclass Shapes {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n  protected objectsAmmo: { [ptr: number]: any } = {}\n  protected addExisting: (object: ExtendedObject3D, config?: AddExistingConfig) => void\n  protected factory: Factories\n\n  protected addPlane(planeConfig: PlaneConfig = {}, materialConfig: MaterialConfig = {}) {\n    const plane = this.factory.add.plane(planeConfig, materialConfig)\n    this.addExisting(plane, planeConfig)\n    return plane\n  }\n\n  protected addSphere(sphereConfig: SphereConfig = {}, materialConfig: MaterialConfig = {}) {\n    const sphere = this.factory.add.sphere(sphereConfig, materialConfig)\n    this.addExisting(sphere, sphereConfig)\n    return sphere\n  }\n\n  protected addBox(boxConfig: BoxConfig = {}, materialConfig: MaterialConfig = {}) {\n    const box = this.factory.add.box(boxConfig, materialConfig)\n    this.addExisting(box, boxConfig)\n    return box\n  }\n\n  protected addGround(groundConfig: GroundConfig, materialConfig: MaterialConfig = {}) {\n    const ground = this.factory.add.ground(groundConfig, materialConfig)\n    const config = { ...groundConfig, mass: 0, collisionFlags: 1 }\n    this.addExisting(ground, config)\n    return ground\n  }\n\n  protected addCylinder(cylinderConfig: CylinderConfig = {}, materialConfig: MaterialConfig = {}) {\n    const cylinder = this.factory.add.cylinder(cylinderConfig, materialConfig)\n    this.addExisting(cylinder, cylinderConfig)\n    return cylinder\n  }\n\n  protected addCone(coneConfig: ConeConfig = {}, materialConfig: MaterialConfig = {}) {\n    const cone = this.factory.add.cone(coneConfig, materialConfig)\n    this.addExisting(cone, coneConfig)\n    return cone\n  }\n\n  protected addTorus(torusConfig: TorusConfig = {}, materialConfig: MaterialConfig = {}) {\n    const torus = this.factory.add.torus(torusConfig, materialConfig)\n    this.addExisting(torus, torusConfig)\n    return torus\n  }\n\n  protected addExtrude(extrudeConfig: ExtrudeConfig, materialConfig: MaterialConfig = {}) {\n    const object = this.factory.add.extrude(extrudeConfig, materialConfig)\n    object.translateX(1)\n    this.addExisting(object)\n    return object\n  }\n}\n\nexport default Shapes\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\n// Inspired by https://github.com/donmccurdy/aframe-physics-system/blob/master/src/components/ammo-constraint.js\n\nimport PhysicsBody from '@enable3d/common/dist/physicsBody'\nimport { XYZ } from '@enable3d/common/dist/types'\nimport Physics from './physics'\n\nexport default class Constraints {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n\n  protected tmpBtVector3: Ammo.btVector3\n\n  constructor() {}\n\n  private toAmmoV3(v?: XYZ, d: number = 0) {\n    return new Ammo.btVector3(\n      typeof v?.x !== 'undefined' ? v.x : d,\n      typeof v?.y !== 'undefined' ? v.y : d,\n      typeof v?.z !== 'undefined' ? v.z : d\n    )\n  }\n\n  protected get addConstraints() {\n    return {\n      lock: (body: PhysicsBody, targetBody: PhysicsBody) => this.lock(body, targetBody),\n      fixed: (body: PhysicsBody, targetBody: PhysicsBody) => this.fixed(body, targetBody),\n      pointToPoint: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          pivotA?: XYZ\n          pivotB?: XYZ\n        }\n      ) => this.pointToPoint(body, targetBody, config),\n      hinge: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          pivotA?: XYZ\n          pivotB?: XYZ\n          axisA?: XYZ\n          axisB?: XYZ\n        }\n      ) => this.hinge(body, targetBody, config),\n      slider: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          frameA?: XYZ\n          frameB?: XYZ\n          linearLowerLimit?: number\n          linearUpperLimit?: number\n          angularLowerLimit?: number\n          angularUpperLimit?: number\n        } = {}\n      ) => this.slider(body, targetBody, config),\n      spring: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          stiffness?: number\n          damping?: number\n          angularLock?: boolean\n          linearLowerLimit?: XYZ\n          linearUpperLimit?: XYZ\n        } = {}\n      ) => this.spring(body, targetBody, config),\n      coneTwist: (bodyA: PhysicsBody, bodyB: PhysicsBody, frameA: XYZ = {}, frameB: XYZ = {}) =>\n        this.coneTwist(bodyA, bodyB, frameA, frameB),\n      dof: (\n        bodyA: PhysicsBody,\n        bodyB: PhysicsBody,\n        config?: {\n          linearLowerLimit?: XYZ\n          linearUpperLimit?: XYZ\n          angularLowerLimit?: XYZ\n          angularUpperLimit?: XYZ\n          center?: boolean\n          offset?: XYZ\n        }\n      ) => this.dof(bodyA, bodyB, config)\n    }\n  }\n\n  private getTransform(\n    bodyA: Ammo.btRigidBody,\n    bodyB: Ammo.btRigidBody,\n    offset: { x: number; y: number; z: number } = { x: 0, y: 0, z: 0 },\n    center: boolean = false\n  ) {\n    offset = { x: 0, y: 0, z: 0, ...offset }\n\n    const centerVector = (v1: Ammo.btVector3, v2: Ammo.btVector3) => {\n      var dx = (v1.x() - v2.x()) / 2 + offset.x\n      var dy = (v1.y() - v2.y()) / 2 + offset.y\n      var dz = (v1.z() - v2.z()) / 2 + offset.z\n      return new Ammo.btVector3(dx, dy, dz)\n    }\n\n    const transformB = new Ammo.btTransform()\n    transformB.setIdentity()\n\n    if (!center) {\n      // offset\n      transformB.setOrigin(new Ammo.btVector3(offset.x, offset.y, offset.z))\n\n      const transformA = bodyA\n        .getCenterOfMassTransform()\n        .inverse()\n        .op_mul(bodyB.getWorldTransform())\n        .op_mul(transformB)\n\n      return { transformA: transformA, transformB: transformB }\n    } else {\n      const center = centerVector(bodyA.getWorldTransform().getOrigin(), bodyB.getWorldTransform().getOrigin())\n\n      const transformB = new Ammo.btTransform()\n      transformB.setIdentity()\n      transformB.setOrigin(center)\n\n      const transformA = bodyA\n        .getCenterOfMassTransform()\n        .inverse()\n        .op_mul(bodyB.getWorldTransform())\n\n      transformA.op_mul(transformB)\n\n      return { transformA: transformA, transformB: transformB }\n    }\n  }\n\n  private lock(bodyA: PhysicsBody, bodyB: PhysicsBody) {\n    const zero = { x: 0, y: 0, z: 0 }\n    return this.dof(bodyA, bodyB, { angularLowerLimit: zero, angularUpperLimit: zero })\n  }\n\n  private fixed(bodyA: PhysicsBody, bodyB: PhysicsBody) {\n    const transform = this.getTransform(bodyA.ammo, bodyB.ammo)\n    transform.transformA.setRotation(bodyA.ammo.getWorldTransform().getRotation())\n    transform.transformB.setRotation(bodyB.ammo.getWorldTransform().getRotation())\n    const constraint = new Ammo.btFixedConstraint(bodyA.ammo, bodyB.ammo, transform.transformA, transform.transformB)\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  private pointToPoint(\n    body: PhysicsBody,\n    targetBody: PhysicsBody,\n    config: {\n      pivotA?: XYZ\n      pivotB?: XYZ\n    } = {}\n  ) {\n    const { pivotA, pivotB } = config\n    const pivotV3 = new Ammo.btVector3(pivotA?.x || 0, pivotA?.y || 0, pivotA?.z || 0)\n    const targetPivotV3 = new Ammo.btVector3(pivotB?.x || 0, pivotB?.y || 0, pivotB?.z || 0)\n    const constraint = new Ammo.btPoint2PointConstraint(body.ammo, targetBody.ammo, pivotV3, targetPivotV3)\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  private hinge(\n    body: PhysicsBody,\n    targetBody: PhysicsBody,\n    config: {\n      pivotA?: XYZ\n      pivotB?: XYZ\n      axisA?: XYZ\n      axisB?: XYZ\n    } = {}\n  ) {\n    const { pivotA, pivotB, axisA, axisB } = config\n    const pivotV3 = new Ammo.btVector3(pivotA?.x || 0, pivotA?.y || 0, pivotA?.z || 0)\n    const targetPivotV3 = new Ammo.btVector3(pivotB?.x || 0, pivotB?.y || 0, pivotB?.z || 0)\n    const axisV3 = new Ammo.btVector3(axisA?.x || 0, axisA?.y || 0, axisA?.z || 0)\n    const targetAxisV3 = new Ammo.btVector3(axisB?.x || 0, axisB?.y || 0, axisB?.z || 0)\n    const constraint = new Ammo.btHingeConstraint(\n      body.ammo,\n      targetBody.ammo,\n      pivotV3,\n      targetPivotV3,\n      axisV3,\n      targetAxisV3,\n      true\n    )\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  // https://pybullet.org/Bullet/phpBB3/viewtopic.php?f=9&t=12690&p=42152&hilit=btSliderConstraint#p42152\n  private slider(\n    bodyA: PhysicsBody,\n    bodyB: PhysicsBody,\n    config: {\n      frameA?: XYZ\n      frameB?: XYZ\n      linearLowerLimit?: number\n      linearUpperLimit?: number\n      angularLowerLimit?: number\n      angularUpperLimit?: number\n    } = {}\n  ) {\n    const transform = this.getTransform(bodyA.ammo, bodyB.ammo)\n\n    const {\n      frameA = {},\n      frameB = {},\n      linearLowerLimit: lll = 0,\n      linearUpperLimit: lul = 0,\n      angularLowerLimit: all = 0,\n      angularUpperLimit: aul = 0\n    } = config\n\n    const rotationA = transform.transformA.getRotation()\n    rotationA.setEulerZYX(frameA.x || 0, frameA.y || 0, frameA.z || 0)\n    transform.transformA.setRotation(rotationA)\n\n    const rotationB = transform.transformB.getRotation()\n    rotationB.setEulerZYX(frameB.x || 0, frameB.y || 0, frameB.z || 0)\n    transform.transformB.setRotation(rotationB)\n\n    const constraint = new Ammo.btSliderConstraint(\n      bodyA.ammo,\n      bodyB.ammo,\n      transform.transformA,\n      transform.transformB,\n      true\n    )\n\n    constraint.setLowerLinLimit(lll)\n    constraint.setUpperLinLimit(lul)\n    constraint.setLowerAngLimit(all)\n    constraint.setUpperAngLimit(aul)\n\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  private spring(\n    body: PhysicsBody,\n    targetBody: PhysicsBody,\n    config: {\n      stiffness?: number\n      damping?: number\n      angularLock?: boolean\n      linearLowerLimit?: XYZ\n      linearUpperLimit?: XYZ\n    } = {}\n  ) {\n    const {\n      stiffness = 50,\n      damping = 0.01,\n      angularLock = false,\n      linearLowerLimit: lll = {},\n      linearUpperLimit: lul = {}\n    } = config\n\n    const transform = this.getTransform(body.ammo, targetBody.ammo)\n    const constraint = new Ammo.btGeneric6DofSpringConstraint(\n      body.ammo,\n      targetBody.ammo,\n      transform.transformA,\n      transform.transformB,\n      true\n    )\n\n    this.tmpBtVector3.setValue(lll.x || 0, lll.y || 0, lll.z || 0)\n    constraint.setLinearLowerLimit(this.tmpBtVector3)\n\n    this.tmpBtVector3.setValue(lul.x || 0, lul.y || 0, lul.z || 0)\n    constraint.setLinearUpperLimit(this.tmpBtVector3)\n\n    if (angularLock) {\n      this.tmpBtVector3.setValue(0, 0, 0)\n      constraint.setAngularLowerLimit(this.tmpBtVector3)\n      constraint.setAngularUpperLimit(this.tmpBtVector3)\n    }\n\n    for (let i = 0; i < 3; i++) {\n      constraint.enableSpring(i, true)\n      constraint.setStiffness(i, stiffness)\n      constraint.setDamping(i, damping)\n    }\n\n    // I have no idea what setEquilibriumPoint does :/\n    // constraint.setEquilibriumPoint()\n\n    this.physicsWorld.addConstraint(constraint)\n\n    return constraint\n  }\n\n  private coneTwist(bodyA: PhysicsBody, bodyB: PhysicsBody, frameA: XYZ = {}, frameB: XYZ = {}) {\n    const rbAFrame = new Ammo.btTransform()\n    rbAFrame.setIdentity()\n    rbAFrame.getOrigin().setValue(frameA?.x || 0, frameA?.y || 0, frameA?.z || 0)\n\n    const rbBFrame = new Ammo.btTransform()\n    rbBFrame.setIdentity()\n    rbBFrame.getOrigin().setValue(frameB?.x || 0, frameB?.y || 0, frameB?.z || 0)\n\n    const t = this.getTransform(bodyA.ammo, bodyB.ammo)\n\n    const constraint = new Ammo.btConeTwistConstraint(bodyB.ammo, bodyA.ammo, rbAFrame, rbBFrame)\n\n    // does not work at all :/\n    // constraint.setLimit(-Math.PI / 50, Math.PI / 50)\n\n    constraint.setAngularOnly(true)\n\n    this.physicsWorld.addConstraint(constraint)\n\n    return constraint\n  }\n\n  private dof(\n    bodyA: PhysicsBody,\n    bodyB: PhysicsBody,\n    config: {\n      linearLowerLimit?: XYZ\n      linearUpperLimit?: XYZ\n      angularLowerLimit?: XYZ\n      angularUpperLimit?: XYZ\n      center?: boolean\n      offset?: XYZ\n    } = {}\n  ) {\n    const { offset, center = false } = config\n    const off = { x: 0, y: 0, z: 0, ...offset }\n\n    const transform = this.getTransform(bodyA.ammo, bodyB.ammo, off, center)\n\n    const constraint = new Ammo.btGeneric6DofConstraint(\n      bodyA.ammo,\n      bodyB.ammo,\n      transform.transformA,\n      transform.transformB,\n      true\n    )\n\n    const { linearLowerLimit, linearUpperLimit, angularLowerLimit, angularUpperLimit } = config\n\n    const lll = this.toAmmoV3(linearLowerLimit)\n    const lul = this.toAmmoV3(linearUpperLimit)\n    const all = this.toAmmoV3(angularLowerLimit, -Math.PI)\n    const aul = this.toAmmoV3(angularUpperLimit, Math.PI)\n\n    constraint.setLinearLowerLimit(lll)\n    constraint.setLinearUpperLimit(lul)\n    constraint.setAngularLowerLimit(all)\n    constraint.setAngularUpperLimit(aul)\n\n    Ammo.destroy(lll)\n    Ammo.destroy(lul)\n    Ammo.destroy(all)\n    Ammo.destroy(aul)\n\n    this.physicsWorld.addConstraint(constraint, false)\n\n    return constraint\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport EventEmitter from 'eventemitter3'\nimport { ExtendedObject3D } from '@enable3d/common/dist/types'\n\nexport default class Events extends EventEmitter {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n\n  protected addCollider(\n    object1: ExtendedObject3D,\n    object2: ExtendedObject3D,\n    eventCallback: (event: 'start' | 'collision' | 'end') => void\n  ) {\n    if (!object1.body || !object2.body) return\n\n    object1.body.checkCollisions = true\n    object2.body.checkCollisions = true\n\n    this.on('collision', data => {\n      const { bodies, event } = data\n      if (bodies[0]?.name && bodies[1]?.name && object1?.name && object2?.name) {\n        if (bodies[0].name === object1.name && bodies[1].name === object2.name) eventCallback(event)\n        else if (bodies[1].name === object1.name && bodies[0].name === object2.name) eventCallback(event)\n      }\n    })\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @description  This is a modified version of the original code from Kevin Lee\n */\n\n/**\n * @author       Kevin Lee (https://github.com/InfiniteLee)\n * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer\n * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}\n */\n\nimport {\n  Scene,\n  BufferGeometry,\n  BufferAttribute,\n  LineBasicMaterial,\n  LineSegments,\n  StaticDrawUsage\n} from '@enable3d/three-wrapper/dist/index'\n\nconst AmmoDebugConstants = {\n  NoDebug: 0,\n  DrawWireframe: 1,\n  DrawAabb: 2,\n  DrawFeaturesText: 4,\n  DrawContactPoints: 8,\n  NoDeactivation: 16,\n  NoHelpText: 32,\n  DrawText: 64,\n  ProfileTimings: 128,\n  EnableSatComparison: 256,\n  DisableBulletLCP: 512,\n  EnableCCD: 1024,\n  DrawConstraints: 1 << 11, //2048\n  DrawConstraintLimits: 1 << 12, //4096\n  FastWireframe: 1 << 13, //8192\n  DrawNormals: 1 << 14, //16384\n  DrawOnTop: 1 << 15, //32768\n  MAX_DEBUG_DRAW_MODE: 0xffffffff\n}\n\n/**\n * An implementation of the btIDebugDraw interface in Ammo.js, for debug rendering of Ammo shapes\n */\nclass DebugDrawer {\n  debugDrawMode: number\n  geometry: BufferGeometry\n  index: number\n  mesh: LineSegments\n  enabled: boolean\n  debugDrawer: Ammo.DebugDrawer\n  warnedOnce: boolean\n  constructor(public scene: Scene, public world: Ammo.btCollisionWorld, public options: any = {}) {\n    this.debugDrawMode = options.debugDrawMode || AmmoDebugConstants.DrawWireframe\n    const drawOnTop = this.debugDrawMode & AmmoDebugConstants.DrawOnTop || false\n    const maxBufferSize = options.maxBufferSize || 1000000\n\n    this.geometry = new BufferGeometry()\n    const vertices = new Float32Array(maxBufferSize * 3)\n    const colors = new Float32Array(maxBufferSize * 3)\n\n    /*\n    I do not know the difference, just using the first one.\n    export const StaticDrawUsage: Usage;\n    export const DynamicDrawUsage: Usage;\n    export const StreamDrawUsage: Usage;\n    export const StaticReadUsage: Usage;\n    export const DynamicReadUsage: Usage;\n    export const StreamReadUsage: Usage;\n    export const StaticCopyUsage: Usage;\n    export const DynamicCopyUsage: Usage;\n    export const StreamCopyUsage: Usage;\n     */\n    this.geometry.setAttribute('position', new BufferAttribute(vertices, 3).setUsage(StaticDrawUsage))\n    this.geometry.setAttribute('color', new BufferAttribute(colors, 3).setUsage(StaticDrawUsage))\n\n    this.index = 0\n\n    const material = new LineBasicMaterial({\n      vertexColors: true,\n      depthTest: !drawOnTop\n    })\n\n    this.mesh = new LineSegments(this.geometry, material)\n    if (drawOnTop) this.mesh.renderOrder = 999\n    this.mesh.frustumCulled = false\n\n    this.enabled = false\n\n    this.debugDrawer = new Ammo.DebugDrawer()\n    this.debugDrawer.drawLine = this.drawLine.bind(this)\n    this.debugDrawer.drawContactPoint = this.drawContactPoint.bind(this)\n    this.debugDrawer.reportErrorWarning = this.reportErrorWarning.bind(this)\n    this.debugDrawer.draw3dText = this.draw3dText.bind(this)\n    this.debugDrawer.setDebugMode = this.setDebugMode.bind(this)\n    this.debugDrawer.getDebugMode = this.getDebugMode.bind(this)\n\n    this.world.setDebugDrawer(this.debugDrawer)\n  }\n\n  enable() {\n    this.enabled = true\n    this.scene.add(this.mesh)\n  }\n\n  disable() {\n    this.enabled = false\n    this.scene.remove(this.mesh)\n  }\n\n  update() {\n    if (!this.enabled) {\n      return\n    }\n\n    if (this.index != 0) {\n      // @ts-ignore\n      this.geometry.attributes.position.needsUpdate = true\n      // @ts-ignore\n      this.geometry.attributes.color.needsUpdate = true\n    }\n\n    this.index = 0\n    this.world.debugDrawWorld()\n    this.geometry.setDrawRange(0, this.index)\n  }\n\n  drawLine(from: any, to: any, color: any) {\n    // @ts-ignore\n    const heap = Ammo.HEAPF32\n    const r = heap[(color + 0) / 4]\n    const g = heap[(color + 4) / 4]\n    const b = heap[(color + 8) / 4]\n\n    const fromX = heap[(from + 0) / 4]\n    const fromY = heap[(from + 4) / 4]\n    const fromZ = heap[(from + 8) / 4]\n    this.geometry.attributes.position.setXYZ(this.index, fromX, fromY, fromZ)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n\n    const toX = heap[(to + 0) / 4]\n    const toY = heap[(to + 4) / 4]\n    const toZ = heap[(to + 8) / 4]\n    this.geometry.attributes.position.setXYZ(this.index, toX, toY, toZ)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n  }\n\n  //TODO: figure out how to make lifeTime work\n  drawContactPoint(pointOnB: any, normalOnB: any, distance: any, _lifeTime: any, color: any) {\n    // @ts-ignore\n    const heap = Ammo.HEAPF32\n    const r = heap[(color + 0) / 4]\n    const g = heap[(color + 4) / 4]\n    const b = heap[(color + 8) / 4]\n\n    const x = heap[(pointOnB + 0) / 4]\n    const y = heap[(pointOnB + 4) / 4]\n    const z = heap[(pointOnB + 8) / 4]\n    this.geometry.attributes.position.setXYZ(this.index, x, y, z)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n\n    const dx = heap[(normalOnB + 0) / 4] * distance\n    const dy = heap[(normalOnB + 4) / 4] * distance\n    const dz = heap[(normalOnB + 8) / 4] * distance\n    this.geometry.attributes.position.setXYZ(this.index, x + dx, y + dy, z + dz)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n  }\n\n  reportErrorWarning(warningString: string) {\n    if (Ammo.hasOwnProperty('Pointer_stringify')) {\n      // @ts-ignore\n      console.warn(Ammo.Pointer_stringify(warningString))\n    } else if (!this.warnedOnce) {\n      this.warnedOnce = true\n      console.warn(\"Cannot print warningString, please rebuild Ammo.js using 'debug' flag\")\n    }\n  }\n\n  draw3dText(_location: any, _textString: any) {\n    //TODO\n    console.warn('TODO: draw3dText')\n  }\n\n  setDebugMode(debugMode: any) {\n    this.debugDrawMode = debugMode\n  }\n\n  getDebugMode() {\n    return this.debugDrawMode\n  }\n}\n\nexport default DebugDrawer\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport DebugDrawer from './debugDrawer'\nimport EventEmitter from 'eventemitter3'\nimport { ExtendedObject3D, Phaser3DConfig } from '@enable3d/common/dist/types'\nimport { Vector3, Scene, Quaternion, Euler } from '@enable3d/three-wrapper/dist/index'\nimport { ConvexObjectBreaker } from './convexObjectBreaker'\nimport DefaultMaterial from '@enable3d/common/dist/defaultMaterial'\nimport PhysicsBody from '@enable3d/common/dist/physicsBody'\n\nclass Physics extends EventEmitter {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n  protected dispatcher: Ammo.btCollisionDispatcher\n  protected rigidBodies: ExtendedObject3D[] = []\n  protected objectsAmmo: { [ptr: number]: any } = {}\n  protected earlierDetectedCollisions: { combinedName: string; collision: boolean }[] = []\n  protected debugDrawer: DebugDrawer\n  private convexBreaker: any\n  protected addRigidBody: (threeObject: ExtendedObject3D, physicsShape: any, mass: any, pos: any, quat: any) => void\n  private objectsToRemove: any[]\n  private numObjectsToRemove: number\n  protected gravity: { x: number; y: number; z: number }\n\n  protected emptyV3: Vector3\n  protected impactPoint: Vector3\n  protected impactNormal: Vector3\n\n  protected tmpEuler: Euler\n  protected tmpQuaternion: Quaternion\n  protected tmpVector3: Vector3\n  protected tmpBtVector3: Ammo.btVector3\n  protected tmpBtQuaternion: Ammo.btQuaternion\n\n  protected defaultMaterial: DefaultMaterial\n\n  constructor(protected scene: Scene | 'headless', public config: Phaser3DConfig = {}) {\n    super()\n  }\n\n  /** Destroys a physics body. */\n  public destroy(body: PhysicsBody) {\n    if (typeof body?.ammo === 'undefined') return\n\n    const ptr = Object.values(body.ammo)[0]\n    const name = Object.values(body.ammo)[1]\n    const obj = this.objectsAmmo[ptr]\n\n    // TODO: Remember why I track objectsAmmo and rigidBodies?\n    // console.log(this.objectsAmmo)\n    // console.log(this.rigidBodies)\n\n    if (ptr && name && obj) {\n      if (obj?.body?.ammo) {\n        // remove from physics world\n        this.physicsWorld.removeRigidBody(obj.body.ammo)\n\n        // reset properties\n        obj.body = undefined\n        obj.hasBody = false\n\n        // remove from this.objectAmmo\n        delete this.objectsAmmo[ptr]\n        // remove from this.rigidBodies\n        for (var i = 0; i < this.rigidBodies.length; i++) {\n          if (this.rigidBodies[i].name === name) {\n            this.rigidBodies.splice(i, 1)\n            i--\n          }\n        }\n      }\n    }\n  }\n\n  protected setup() {\n    if (this.scene !== 'headless') {\n      // Initialize convexBreaker\n      // @ts-ignore\n      this.convexBreaker = new ConvexObjectBreaker()\n\n      this.objectsToRemove = []\n      this.numObjectsToRemove = 0\n      for (var i = 0; i < 500; i++) {\n        this.objectsToRemove[i] = null\n      }\n    }\n\n    // setup ammo physics\n    this.setupPhysicsWorld()\n\n    if (this.scene !== 'headless') this.debugDrawer = new DebugDrawer(this.scene, this.physicsWorld, {})\n\n    /**\n     * TODO add ghost object\n     */\n    // const ghost = new Ammo.btGhostObject()\n    // ghost.setCollisionShape(new Ammo.btSphereShape(10))\n    // ghost.setWorldTransform(new Ammo.btTransform(new Ammo.btQuaternion(0, 0, 0, 1), new Ammo.btVector3(0, 15, 0)))\n    // ghost.setCollisionFlags(4)\n    // this.physicsWorld.addCollisionObject(ghost)\n\n    // run the phaser update method\n    /*if (!this.phaser3D.isXrEnabled)\n      this.scene.events.on('update', (_time: number, delta: number) => {\n        this.update(delta)\n        this.updateDebugger()\n      })*/\n  }\n\n  public updateDebugger() {\n    if (this.scene === 'headless') return\n\n    if (this.debugDrawer && this.debugDrawer.enabled) this.debugDrawer.update()\n  }\n\n  protected setupPhysicsWorld() {\n    const g = this.gravity\n\n    const collisionConfiguration = new Ammo.btDefaultCollisionConfiguration()\n    const dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration)\n    const broadphase = new Ammo.btDbvtBroadphase()\n    const solver = new Ammo.btSequentialImpulseConstraintSolver()\n    this.physicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, broadphase, solver, collisionConfiguration)\n    this.physicsWorld.setGravity(new Ammo.btVector3(g.x, g.y, g.z))\n\n    this.dispatcher = dispatcher\n    this.tmpTrans = new Ammo.btTransform()\n  }\n\n  private createDebrisFromBreakableObject(object: ExtendedObject3D, parent: ExtendedObject3D) {\n    if (this.scene === 'headless') return\n\n    object.material = this.defaultMaterial.get()\n    object.shape = 'hull'\n    object.fragmentDepth = parent.fragmentDepth + 1\n\n    // Add the object to the scene\n    this.scene.add(object)\n\n    // Add physics to the object\n    // @ts-ignore\n    this.addExisting(object)\n\n    object.body.breakable = false\n    // make this fragment breakable in 2.5seconds\n    setTimeout(() => {\n      object.body.breakable = true\n    }, 2500)\n  }\n\n  private removeDebris(object: any) {\n    if (this.scene === 'headless') return\n\n    this.scene.remove(object)\n    this.physicsWorld.removeRigidBody(object.body.ammo)\n    delete this.objectsAmmo[object.ptr]\n  }\n\n  public update(delta: number) {\n    // reset these vectors\n    this.impactPoint.set(0, 0, 0)\n    this.impactNormal.set(0, 0, 0)\n\n    const detectedCollisions: { combinedName: string; collision: boolean }[] = []\n\n    // Step world\n    const deltaTime = delta / 1000\n    this.physicsWorld.stepSimulation(deltaTime, this.config.maxSubSteps || 1, this.config.fixedTimeStep || 1 / 60)\n\n    /**\n     * Update rigid bodies\n     */\n    for (var i = 0, il = this.rigidBodies.length; i < il; i++) {\n      var objThree = this.rigidBodies[i]\n      var objPhys = objThree.body.ammo\n      var ms = objPhys.getMotionState()\n\n      if (ms) {\n        ms.getWorldTransform(this.tmpTrans)\n\n        // check if object did an update since last call\n        if (objThree.body.didUpdate) {\n          // @ts-ignore\n          if (objThree.body._emitUpdateEvents) objThree.body.eventEmitter.emit('update')\n          objThree.body.didUpdate = false\n        }\n\n        // update positions\n        if (objThree.body.ammo.isKinematicObject() && objThree.body.needUpdate) {\n          // get position and rotation\n          objThree.getWorldQuaternion(this.tmpQuaternion)\n          objThree.getWorldPosition(this.tmpVector3)\n          // adjust tmp variables\n          this.tmpBtVector3.setValue(this.tmpVector3.x, this.tmpVector3.y, this.tmpVector3.z)\n          this.tmpBtQuaternion.setValue(\n            this.tmpQuaternion.x,\n            this.tmpQuaternion.y,\n            this.tmpQuaternion.z,\n            this.tmpQuaternion.w\n          )\n          // set position and rotation\n          this.tmpTrans.setOrigin(this.tmpBtVector3)\n          this.tmpTrans.setRotation(this.tmpBtQuaternion)\n          // set transform\n          ms.setWorldTransform(this.tmpTrans)\n          // reset needsUpdate\n          objThree.body.needUpdate = false\n        } else {\n          // get position and rotation\n          let p = this.tmpTrans.getOrigin()\n          let q = this.tmpTrans.getRotation()\n          // body offset\n          let o = objThree.body.offset\n          // set position and rotation\n          objThree.position.set(p.x() + o.x, p.y() + o.y, p.z() + o.z)\n          objThree.quaternion.set(q.x(), q.y(), q.z(), q.w())\n        }\n\n        objThree.body.collided = false\n      }\n    }\n\n    /**\n     * Check collisions\n     */\n    for (var i = 0, il = this.dispatcher.getNumManifolds(); i < il; i++) {\n      const contactManifold = this.dispatcher.getManifoldByIndexInternal(i)\n      const key = Object.keys(contactManifold.getBody0())[0]\n\n      // @ts-ignore\n      const body0 = Ammo.castObject(contactManifold.getBody0(), Ammo.btRigidBody)\n      // @ts-ignore\n      const body1 = Ammo.castObject(contactManifold.getBody1(), Ammo.btRigidBody)\n\n      // do not check collision between 2 unnamed objects\n      // (fragments do not have a name, for example)\n      if (body0.name === '' && body1.name === '') continue\n\n      // @ts-ignore\n      const ptr0 = body0[key]\n      // @ts-ignore\n      const ptr1 = body1[key]\n      const threeObject0 = this.objectsAmmo[ptr0] as ExtendedObject3D\n      const threeObject1 = this.objectsAmmo[ptr1] as ExtendedObject3D\n\n      if (!threeObject0 || !threeObject1) {\n        continue\n      }\n\n      /**\n       * Get some information\n       */\n      const breakable0 = threeObject0.body.breakable\n      const breakable1 = threeObject1.body.breakable\n\n      const collided0 = threeObject0.body.collided\n      const collided1 = threeObject1.body.collided\n\n      const checkCollisions0 = threeObject0.body?.checkCollisions\n      const checkCollisions1 = threeObject1.body?.checkCollisions\n\n      /**\n       * Handle collision events\n       */\n      if (checkCollisions0 || checkCollisions1) {\n        // check if a collision between these object has already been processed\n        const names = [threeObject0.name, threeObject1.name].sort()\n        const combinedName = `${names[0]}__${names[1]}`\n        let event\n        if (this.earlierDetectedCollisions.find(el => el.combinedName === combinedName)) event = 'colliding'\n        else event = 'start'\n        detectedCollisions.push({ combinedName, collision: true })\n        this.emit('collision', { bodies: [threeObject0, threeObject1], event })\n      }\n\n      if ((!breakable0 && !breakable1) || (collided0 && collided1)) {\n        continue\n      }\n\n      let contact = false\n      let maxImpulse = 0\n      for (var j = 0, jl = contactManifold.getNumContacts(); j < jl; j++) {\n        var contactPoint = contactManifold.getContactPoint(j)\n\n        if (contactPoint.getDistance() < 0) {\n          contact = true\n          var impulse = contactPoint.getAppliedImpulse()\n\n          if (impulse > maxImpulse) {\n            maxImpulse = impulse\n            var pos = contactPoint.get_m_positionWorldOnB()\n            var normal = contactPoint.get_m_normalWorldOnB()\n            this.impactPoint.set(pos.x(), pos.y(), pos.z())\n            this.impactNormal.set(normal.x(), normal.y(), normal.z())\n          }\n\n          break\n        }\n      }\n\n      // If no point has contact, abort\n      if (!contact) continue\n\n      /**\n       * Check for breakable objects (subdivision)\n       */\n      const fractureImpulse = 5 //250\n      const MAX_FRAGMENT_DEPTH = 2\n\n      // since the library convexBreaker makes use of three's userData\n      // we have to clone the necessary params to threeObjectX.userData\n      // TODO improve this\n\n      this.emptyV3.set(0, 0, 0)\n      threeObject0.userData = {\n        mass: 1,\n        velocity: this.emptyV3,\n        angularVelocity: this.emptyV3,\n        breakable: breakable0,\n        physicsBody: body0\n      }\n      threeObject1.userData = {\n        mass: 1,\n        velocity: this.emptyV3,\n        angularVelocity: this.emptyV3,\n        breakable: breakable1,\n        physicsBody: body1\n      }\n      if (typeof threeObject0.fragmentDepth === 'undefined') threeObject0.fragmentDepth = 0\n      if (typeof threeObject1.fragmentDepth === 'undefined') threeObject1.fragmentDepth = 0\n\n      // threeObject0\n      if (breakable0 && !collided0 && maxImpulse > fractureImpulse && threeObject0.fragmentDepth < MAX_FRAGMENT_DEPTH) {\n        var debris = this.convexBreaker.subdivideByImpact(threeObject0, this.impactPoint, this.impactNormal, 1, 2) //, 1.5)\n\n        var numObjects = debris.length\n        for (var j = 0; j < numObjects; j++) {\n          var vel = body0.getLinearVelocity()\n          var angVel = body0.getAngularVelocity()\n          var fragment = debris[j] as ExtendedObject3D\n          fragment.userData.velocity.set(vel.x(), vel.y(), vel.z())\n          fragment.userData.angularVelocity.set(angVel.x(), angVel.y(), angVel.z())\n\n          this.createDebrisFromBreakableObject(fragment, threeObject0)\n        }\n\n        this.objectsToRemove[this.numObjectsToRemove++] = threeObject0\n        threeObject0.body.collided = true\n      }\n\n      // threeObject1\n      if (breakable1 && !collided1 && maxImpulse > fractureImpulse && threeObject1.fragmentDepth < MAX_FRAGMENT_DEPTH) {\n        var debris = this.convexBreaker.subdivideByImpact(threeObject1, this.impactPoint, this.impactNormal, 1, 2) //, 1.5)\n\n        var numObjects = debris.length\n        for (var j = 0; j < numObjects; j++) {\n          var vel = body1.getLinearVelocity()\n          var angVel = body1.getAngularVelocity()\n          var fragment = debris[j] as ExtendedObject3D\n          fragment.userData.velocity.set(vel.x(), vel.y(), vel.z())\n          fragment.userData.angularVelocity.set(angVel.x(), angVel.y(), angVel.z())\n\n          this.createDebrisFromBreakableObject(fragment, threeObject1)\n        }\n\n        this.objectsToRemove[this.numObjectsToRemove++] = threeObject1\n        threeObject1.body.collided = true\n      }\n    }\n\n    /**\n     * Remove objects\n     */\n    for (var i = 0; i < this.numObjectsToRemove; i++) {\n      this.removeDebris(this.objectsToRemove[i])\n    }\n    this.numObjectsToRemove = 0\n\n    /**\n     * Handle collision end events\n     */\n    this.earlierDetectedCollisions.forEach(el => {\n      const { combinedName } = el\n      if (!detectedCollisions.find(el => el.combinedName === combinedName)) {\n        const split = combinedName.split('__')\n        const obj0 = this.rigidBodies.find(obj => obj.name === split[0])\n        const obj1 = this.rigidBodies.find(obj => obj.name === split[1])\n        if (obj0 && obj1) this.emit('collision', { bodies: [obj0, obj1], event: 'end' })\n      }\n    })\n    this.earlierDetectedCollisions = [...detectedCollisions]\n  }\n}\n\nexport default Physics\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @description  This is a modified version of the original code from Kevin Lee\n */\n\n/**\n * @author       Kevin Lee (https://github.com/InfiniteLee)\n * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo\n * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}\n */\n\n'use strict'\n/* global Ammo */\n\nconst TYPE = {\n  BOX: 'box',\n  CYLINDER: 'cylinder',\n  SPHERE: 'sphere',\n  CAPSULE: 'capsule',\n  CONE: 'cone',\n  HULL: 'hull',\n  HACD: 'hacd', //Hierarchical Approximate Convex Decomposition\n  VHACD: 'vhacd', //Volumetric Hierarchical Approximate Convex Decomposition\n  MESH: 'mesh',\n  HEIGHTFIELD: 'heightfield'\n}\n\nconst FIT = {\n  ALL: 'all', //A single shape is automatically sized to bound all meshes within the entity.\n  MANUAL: 'manual' //A single shape is sized manually. Requires halfExtents or sphereRadius.\n}\n\nconst HEIGHTFIELD_DATA_TYPE = {\n  short: 'short',\n  float: 'float'\n}\n\nimport ExtendedObject3d from '@enable3d/common/dist/extendedObject3D'\nimport { Vector3, Matrix4, BufferGeometry, Quaternion, Box3 } from '@enable3d/three-wrapper/dist/index'\nimport logger from '@enable3d/common/dist/logger'\n\nconst hasUpdateMatricesFunction = ExtendedObject3d.prototype.hasOwnProperty('updateMatrices')\n\nexport const createCollisionShapes = function (root, options) {\n  switch (options.type) {\n    case TYPE.BOX:\n      return createBoxShape(root, options)\n    case TYPE.CYLINDER:\n      return createCylinderShape(root, options)\n    case TYPE.CAPSULE:\n      return createCapsuleShape(root, options)\n    case TYPE.CONE:\n      return createConeShape(root, options)\n    case TYPE.SPHERE:\n      return createSphereShape(root, options)\n    case TYPE.HULL:\n      return createHullShape(root, options)\n    case TYPE.HACD:\n      return createHACDShapes(root, options)\n    case TYPE.VHACD:\n      return createVHACDShapes(root, options)\n    case TYPE.MESH:\n      return createTriMeshShape(root, options)\n    case TYPE.HEIGHTFIELD:\n      return createHeightfieldTerrainShape(root, options)\n    default:\n      logger(options.type + ' is not currently supported')\n      return []\n  }\n}\n\n//TODO: support gimpact (dynamic trimesh) and heightmap\n\nexport const createBoxShape = function (root, options) {\n  options.type = TYPE.BOX\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const btHalfExtents = new Ammo.btVector3(options.halfExtents.x, options.halfExtents.y, options.halfExtents.z)\n  const collisionShape = new Ammo.btBoxShape(btHalfExtents)\n  Ammo.destroy(btHalfExtents)\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createCylinderShape = function (root, options) {\n  options.type = TYPE.CYLINDER\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const btHalfExtents = new Ammo.btVector3(options.halfExtents.x, options.halfExtents.y, options.halfExtents.z)\n  const collisionShape = (() => {\n    switch (options.cylinderAxis) {\n      case 'y':\n        return new Ammo.btCylinderShape(btHalfExtents)\n      case 'x':\n        return new Ammo.btCylinderShapeX(btHalfExtents)\n      case 'z':\n        return new Ammo.btCylinderShapeZ(btHalfExtents)\n    }\n    return null\n  })()\n  Ammo.destroy(btHalfExtents)\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createCapsuleShape = function (root, options) {\n  options.type = TYPE.CAPSULE\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const { x, y, z } = options.halfExtents\n  const collisionShape = (() => {\n    switch (options.cylinderAxis) {\n      case 'y':\n        return new Ammo.btCapsuleShape(Math.max(x, z), y * 2)\n      case 'x':\n        return new Ammo.btCapsuleShapeX(Math.max(y, z), x * 2)\n      case 'z':\n        return new Ammo.btCapsuleShapeZ(Math.max(x, y), z * 2)\n    }\n    return null\n  })()\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createConeShape = function (root, options) {\n  options.type = TYPE.CONE\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const { x, y, z } = options.halfExtents\n  const collisionShape = (() => {\n    switch (options.cylinderAxis) {\n      case 'y':\n        return new Ammo.btConeShape(Math.max(x, z), y * 2)\n      case 'x':\n        return new Ammo.btConeShapeX(Math.max(y, z), x * 2)\n      case 'z':\n        return new Ammo.btConeShapeZ(Math.max(x, y), z * 2)\n    }\n    return null\n  })()\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createSphereShape = function (root, options) {\n  options.type = TYPE.SPHERE\n  _setOptions(options)\n\n  let radius\n  if (options.fit === FIT.MANUAL && !isNaN(options.sphereRadius)) {\n    radius = options.sphereRadius\n  } else {\n    radius = _computeRadius(root, options, _computeBounds(root, options))\n  }\n\n  const collisionShape = new Ammo.btSphereShape(radius)\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n\n  return collisionShape\n}\n\nexport const createHullShape = (function () {\n  const vertex = new Vector3()\n  const center = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.HULL\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: hull')\n      return null\n    }\n\n    const bounds = _computeBounds(root, options)\n\n    const btVertex = new Ammo.btVector3()\n    const originalHull = new Ammo.btConvexHullShape()\n    originalHull.setMargin(options.margin)\n    center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5)\n\n    let vertexCount = 0\n    _iterateGeometries(root, options, geo => {\n      vertexCount += geo.attributes.position.array.length / 3\n    })\n\n    const maxVertices = options.hullMaxVertices || 100000\n    // todo: might want to implement this in a deterministic way that doesn't do O(verts) calls to Math.random\n    if (vertexCount > maxVertices) {\n      console.warn(`too many vertices for hull shape; sampling ~${maxVertices} from ~${vertexCount} vertices`)\n    }\n    const p = Math.min(1, maxVertices / vertexCount)\n\n    _iterateGeometries(root, options, (geo, transform) => {\n      adjustGeometryTranslateEXPERIMENTAL(geo, transform)\n\n      const components = geo.attributes.position.array\n      for (let i = 0; i < components.length; i += 3) {\n        if (Math.random() <= p) {\n          vertex\n            .set(components[i], components[i + 1], components[i + 2])\n            .applyMatrix4(transform)\n            .sub(center)\n          btVertex.setValue(vertex.x, vertex.y, vertex.z)\n          originalHull.addPoint(btVertex, i === components.length - 3) // todo: better to recalc AABB only on last geometry\n        }\n      }\n    })\n\n    let collisionShape = originalHull\n    if (originalHull.getNumVertices() >= 100) {\n      //Bullet documentation says don't use convexHulls with 100 verts or more\n      const shapeHull = new Ammo.btShapeHull(originalHull)\n      shapeHull.buildHull(options.margin)\n      Ammo.destroy(originalHull)\n      collisionShape = new Ammo.btConvexHullShape(\n        Ammo.getPointer(shapeHull.getVertexPointer()),\n        shapeHull.numVertices()\n      )\n      Ammo.destroy(shapeHull) // btConvexHullShape makes a copy\n    }\n\n    Ammo.destroy(btVertex)\n\n    _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n    return collisionShape\n  }\n})()\n\nexport const createHACDShapes = (function () {\n  const v = new Vector3()\n  const center = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.HACD\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: hacd')\n      return []\n    }\n\n    if (!Ammo.hasOwnProperty('HACD')) {\n      console.warn(\n        'HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.'\n      )\n      return []\n    }\n\n    const bounds = _computeBounds(root)\n    const scale = _computeScale(root, options)\n\n    let vertexCount = 0\n    let triCount = 0\n    center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5)\n\n    _iterateGeometries(root, options, geo => {\n      vertexCount += geo.attributes.position.array.length / 3\n      if (geo.index) {\n        triCount += geo.index.array.length / 3\n      } else {\n        triCount += geo.attributes.position.array.length / 9\n      }\n    })\n\n    const hacd = new Ammo.HACD()\n    if (options.hasOwnProperty('compacityWeight')) hacd.SetCompacityWeight(options.compacityWeight)\n    if (options.hasOwnProperty('volumeWeight')) hacd.SetVolumeWeight(options.volumeWeight)\n    if (options.hasOwnProperty('nClusters')) hacd.SetNClusters(options.nClusters)\n    if (options.hasOwnProperty('nVerticesPerCH')) hacd.SetNVerticesPerCH(options.nVerticesPerCH)\n    if (options.hasOwnProperty('concavity')) hacd.SetConcavity(options.concavity)\n\n    const points = Ammo._malloc(vertexCount * 3 * 8)\n    const triangles = Ammo._malloc(triCount * 3 * 4)\n    hacd.SetPoints(points)\n    hacd.SetTriangles(triangles)\n    hacd.SetNPoints(vertexCount)\n    hacd.SetNTriangles(triCount)\n\n    const pptr = points / 8,\n      tptr = triangles / 4\n    _iterateGeometries(root, options, (geo, transform) => {\n      adjustGeometryTranslateEXPERIMENTAL(geo, transform)\n\n      const components = geo.attributes.position.array\n      const indices = geo.index ? geo.index.array : null\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i + 0], components[i + 1], components[i + 2])\n          .applyMatrix4(transform)\n          .sub(center)\n        Ammo.HEAPF64[pptr + i + 0] = v.x\n        Ammo.HEAPF64[pptr + i + 1] = v.y\n        Ammo.HEAPF64[pptr + i + 2] = v.z\n      }\n      if (indices) {\n        for (let i = 0; i < indices.length; i++) {\n          Ammo.HEAP32[tptr + i] = indices[i]\n        }\n      } else {\n        for (let i = 0; i < components.length / 3; i++) {\n          Ammo.HEAP32[tptr + i] = i\n        }\n      }\n    })\n\n    hacd.Compute()\n    Ammo._free(points)\n    Ammo._free(triangles)\n    const nClusters = hacd.GetNClusters()\n\n    const shapes = []\n    for (let i = 0; i < nClusters; i++) {\n      const hull = new Ammo.btConvexHullShape()\n      hull.setMargin(options.margin)\n      const nPoints = hacd.GetNPointsCH(i)\n      const nTriangles = hacd.GetNTrianglesCH(i)\n      const hullPoints = Ammo._malloc(nPoints * 3 * 8)\n      const hullTriangles = Ammo._malloc(nTriangles * 3 * 4)\n      hacd.GetCH(i, hullPoints, hullTriangles)\n\n      const pptr = hullPoints / 8\n      for (let pi = 0; pi < nPoints; pi++) {\n        const btVertex = new Ammo.btVector3()\n        const px = Ammo.HEAPF64[pptr + pi * 3 + 0]\n        const py = Ammo.HEAPF64[pptr + pi * 3 + 1]\n        const pz = Ammo.HEAPF64[pptr + pi * 3 + 2]\n        btVertex.setValue(px, py, pz)\n        hull.addPoint(btVertex, pi === nPoints - 1)\n        Ammo.destroy(btVertex)\n      }\n\n      _finishCollisionShape(hull, options, scale)\n      shapes.push(hull)\n    }\n\n    return shapes\n  }\n})()\n\nexport const createVHACDShapes = (function () {\n  const v = new Vector3()\n  const center = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.VHACD\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: vhacd')\n      return []\n    }\n\n    if (!Ammo.hasOwnProperty('VHACD')) {\n      console.warn(\n        'VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.'\n      )\n      return []\n    }\n\n    const bounds = _computeBounds(root, options)\n    const scale = _computeScale(root, options)\n\n    let vertexCount = 0\n    let triCount = 0\n    center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5)\n\n    _iterateGeometries(root, options, geo => {\n      vertexCount += geo.attributes.position.count\n      if (geo.index) {\n        triCount += geo.index.count / 3\n      } else {\n        triCount += geo.attributes.position.count / 3\n      }\n    })\n\n    const vhacd = new Ammo.VHACD()\n    const params = new Ammo.Parameters()\n    //https://kmamou.blogspot.com/2014/12/v-hacd-20-parameters-description.html\n    if (options.hasOwnProperty('resolution')) params.set_m_resolution(options.resolution)\n    if (options.hasOwnProperty('depth')) params.set_m_depth(options.depth)\n    if (options.hasOwnProperty('concavity')) params.set_m_concavity(options.concavity)\n    if (options.hasOwnProperty('planeDownsampling')) params.set_m_planeDownsampling(options.planeDownsampling)\n    if (options.hasOwnProperty('convexhullDownsampling'))\n      params.set_m_convexhullDownsampling(options.convexhullDownsampling)\n    if (options.hasOwnProperty('alpha')) params.set_m_alpha(options.alpha)\n    if (options.hasOwnProperty('beta')) params.set_m_beta(options.beta)\n    if (options.hasOwnProperty('gamma')) params.set_m_gamma(options.gamma)\n    if (options.hasOwnProperty('pca')) params.set_m_pca(options.pca)\n    if (options.hasOwnProperty('mode')) params.set_m_mode(options.mode)\n    if (options.hasOwnProperty('maxNumVerticesPerCH')) params.set_m_maxNumVerticesPerCH(options.maxNumVerticesPerCH)\n    if (options.hasOwnProperty('minVolumePerCH')) params.set_m_minVolumePerCH(options.minVolumePerCH)\n    if (options.hasOwnProperty('convexhullApproximation'))\n      params.set_m_convexhullApproximation(options.convexhullApproximation)\n    if (options.hasOwnProperty('oclAcceleration')) params.set_m_oclAcceleration(options.oclAcceleration)\n\n    const points = Ammo._malloc(vertexCount * 3 * 8)\n    const triangles = Ammo._malloc(triCount * 3 * 4)\n\n    let pptr = points / 8,\n      tptr = triangles / 4\n    _iterateGeometries(root, options, (geo, transform) => {\n      adjustGeometryTranslateEXPERIMENTAL(geo, transform)\n\n      const components = geo.attributes.position.array\n      const indices = geo.index ? geo.index.array : null\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i + 0], components[i + 1], components[i + 2])\n          .applyMatrix4(transform)\n          .sub(center)\n        Ammo.HEAPF64[pptr + 0] = v.x\n        Ammo.HEAPF64[pptr + 1] = v.y\n        Ammo.HEAPF64[pptr + 2] = v.z\n        pptr += 3\n      }\n      if (indices) {\n        for (let i = 0; i < indices.length; i++) {\n          Ammo.HEAP32[tptr] = indices[i]\n          tptr++\n        }\n      } else {\n        for (let i = 0; i < components.length / 3; i++) {\n          Ammo.HEAP32[tptr] = i\n          tptr++\n        }\n      }\n    })\n\n    vhacd.Compute(points, 3, vertexCount, triangles, 3, triCount, params)\n    Ammo._free(points)\n    Ammo._free(triangles)\n    const nHulls = vhacd.GetNConvexHulls()\n\n    const shapes = []\n    const ch = new Ammo.ConvexHull()\n    for (let i = 0; i < nHulls; i++) {\n      vhacd.GetConvexHull(i, ch)\n      const nPoints = ch.get_m_nPoints()\n      const hullPoints = ch.get_m_points()\n\n      const hull = new Ammo.btConvexHullShape()\n      hull.setMargin(options.margin)\n\n      for (let pi = 0; pi < nPoints; pi++) {\n        const btVertex = new Ammo.btVector3()\n        const px = ch.get_m_points(pi * 3 + 0)\n        const py = ch.get_m_points(pi * 3 + 1)\n        const pz = ch.get_m_points(pi * 3 + 2)\n        btVertex.setValue(px, py, pz)\n        hull.addPoint(btVertex, pi === nPoints - 1)\n        Ammo.destroy(btVertex)\n      }\n\n      _finishCollisionShape(hull, options, scale)\n      shapes.push(hull)\n    }\n    Ammo.destroy(ch)\n    Ammo.destroy(vhacd)\n\n    return shapes\n  }\n})()\n\nexport const createTriMeshShape = (function () {\n  const va = new Vector3()\n  const vb = new Vector3()\n  const vc = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.MESH\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: mesh')\n      return null\n    }\n\n    const scale = _computeScale(root, options)\n\n    const bta = new Ammo.btVector3()\n    const btb = new Ammo.btVector3()\n    const btc = new Ammo.btVector3()\n    const triMesh = new Ammo.btTriangleMesh(true, false)\n\n    _iterateGeometries(root, options, (geo, transform) => {\n      const components = geo.attributes.position.array\n      if (geo.index) {\n        for (let i = 0; i < geo.index.count; i += 3) {\n          const ai = geo.index.array[i] * 3\n          const bi = geo.index.array[i + 1] * 3\n          const ci = geo.index.array[i + 2] * 3\n          va.set(components[ai], components[ai + 1], components[ai + 2]).applyMatrix4(transform)\n          vb.set(components[bi], components[bi + 1], components[bi + 2]).applyMatrix4(transform)\n          vc.set(components[ci], components[ci + 1], components[ci + 2]).applyMatrix4(transform)\n          bta.setValue(va.x, va.y, va.z)\n          btb.setValue(vb.x, vb.y, vb.z)\n          btc.setValue(vc.x, vc.y, vc.z)\n          triMesh.addTriangle(bta, btb, btc, false)\n        }\n      } else {\n        for (let i = 0; i < components.length; i += 9) {\n          va.set(components[i + 0], components[i + 1], components[i + 2]).applyMatrix4(transform)\n          vb.set(components[i + 3], components[i + 4], components[i + 5]).applyMatrix4(transform)\n          vc.set(components[i + 6], components[i + 7], components[i + 8]).applyMatrix4(transform)\n          bta.setValue(va.x, va.y, va.z)\n          btb.setValue(vb.x, vb.y, vb.z)\n          btc.setValue(vc.x, vc.y, vc.z)\n          triMesh.addTriangle(bta, btb, btc, false)\n        }\n      }\n    })\n\n    let collisionShape\n    if (options.concave) collisionShape = new Ammo.btBvhTriangleMeshShape(triMesh, true, true)\n    else collisionShape = new Ammo.btConvexTriangleMeshShape(triMesh, true)\n\n    collisionShape.resources = [triMesh]\n\n    Ammo.destroy(bta)\n    Ammo.destroy(btb)\n    Ammo.destroy(btc)\n\n    _finishCollisionShape(collisionShape, options, scale)\n    return collisionShape\n  }\n})()\n\nexport const createHeightfieldTerrainShape = function (root, options) {\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    console.warn('cannot use fit: all with type: heightfield')\n    return null\n  }\n  const heightfieldDistance = options.heightfieldDistance || 1\n  const heightfieldData = options.heightfieldData || []\n  const heightScale = options.heightScale || 0\n  const upAxis = options.hasOwnProperty('upAxis') ? options.upAxis : 1 // x = 0; y = 1; z = 2\n  const hdt = (() => {\n    switch (options.heightDataType) {\n      case 'short':\n        return Ammo.PHY_SHORT\n      case 'float':\n        return Ammo.PHY_FLOAT\n      default:\n        return Ammo.PHY_FLOAT\n    }\n  })()\n  const flipQuadEdges = options.hasOwnProperty('flipQuadEdges') ? options.flipQuadEdges : true\n\n  const heightStickLength = heightfieldData.length\n  const heightStickWidth = heightStickLength > 0 ? heightfieldData[0].length : 0\n\n  const data = Ammo._malloc(heightStickLength * heightStickWidth * 4)\n  const ptr = data / 4\n\n  let minHeight = Number.POSITIVE_INFINITY\n  let maxHeight = Number.NEGATIVE_INFINITY\n  let index = 0\n  for (let l = 0; l < heightStickLength; l++) {\n    for (let w = 0; w < heightStickWidth; w++) {\n      const height = heightfieldData[l][w]\n      Ammo.HEAPF32[ptr + index] = height\n      index++\n      minHeight = Math.min(minHeight, height)\n      maxHeight = Math.max(maxHeight, height)\n    }\n  }\n\n  const collisionShape = new Ammo.btHeightfieldTerrainShape(\n    heightStickWidth,\n    heightStickLength,\n    data,\n    heightScale,\n    minHeight,\n    maxHeight,\n    upAxis,\n    hdt,\n    flipQuadEdges\n  )\n\n  const scale = new Ammo.btVector3(heightfieldDistance, 1, heightfieldDistance)\n  collisionShape.setLocalScaling(scale)\n  Ammo.destroy(scale)\n\n  collisionShape.heightfieldData = data\n\n  _finishCollisionShape(collisionShape, options)\n  return collisionShape\n}\n\nfunction _setOptions(options) {\n  options.fit = options.hasOwnProperty('fit') ? options.fit : FIT.ALL\n  options.type = options.type || TYPE.HULL\n  options.minHalfExtent = options.hasOwnProperty('minHalfExtent') ? options.minHalfExtent : 0\n  options.maxHalfExtent = options.hasOwnProperty('maxHalfExtent') ? options.maxHalfExtent : Number.POSITIVE_INFINITY\n  options.cylinderAxis = options.cylinderAxis || 'y'\n  options.margin = options.hasOwnProperty('margin') ? options.margin : 0.05\n  options.includeInvisible = options.hasOwnProperty('includeInvisible') ? options.includeInvisible : false\n\n  if (!options.offset) {\n    options.offset = new Vector3()\n  }\n\n  if (!options.orientation) {\n    options.orientation = new Quaternion()\n  }\n}\n\nconst _finishCollisionShape = function (collisionShape, options, scale) {\n  collisionShape.type = options.type\n  collisionShape.setMargin(options.margin)\n  collisionShape.destroy = () => {\n    for (let res of collisionShape.resources || []) {\n      Ammo.destroy(res)\n    }\n    if (collisionShape.heightfieldData) {\n      Ammo._free(collisionShape.heightfieldData)\n    }\n    Ammo.destroy(collisionShape)\n  }\n\n  // const localTransform = new Ammo.btTransform()\n  // const rotation = new Ammo.btQuaternion()\n  // localTransform.setIdentity()\n\n  // localTransform.getOrigin().setValue(options.offset.x, options.offset.y, options.offset.z)\n  // rotation.setValue(options.orientation.x, options.orientation.y, options.orientation.z, options.orientation.w)\n\n  // localTransform.setRotation(rotation)\n  // Ammo.destroy(rotation)\n\n  if (scale) {\n    const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z)\n    collisionShape.setLocalScaling(localScale)\n    Ammo.destroy(localScale)\n  }\n\n  // collisionShape.localTransform = localTransform\n}\n\n// Calls `cb(geo, transform)` for each geometry under `root` whose vertices we should take into account for the physics shape.\n// `transform` is the transform required to transform the given geometry's vertices into root-local space.\nconst _iterateGeometries = (function () {\n  const transform = new Matrix4()\n  const inverse = new Matrix4()\n  const bufferGeometry = new BufferGeometry()\n  return function (root, options, cb) {\n    inverse.getInverse(root.matrixWorld)\n    root.traverse(mesh => {\n      if (\n        mesh.isMesh /*&&\n        (!Sky || mesh.__proto__ != Sky.prototype) &&\n        (options.includeInvisible || (mesh.el && mesh.el.object3D.visible) || mesh.visible)*/\n      ) {\n        if (mesh === root) {\n          transform.identity()\n        } else {\n          if (hasUpdateMatricesFunction) mesh.updateMatrices()\n          transform.multiplyMatrices(inverse, mesh.matrixWorld)\n        }\n        // todo: might want to return null xform if this is the root so that callers can avoid multiplying\n        // things by the identity matrix\n        cb(mesh.geometry.isBufferGeometry ? mesh.geometry : bufferGeometry.fromGeometry(mesh.geometry), transform)\n      }\n    })\n  }\n})()\n\nconst _computeScale = function (root, options) {\n  // const scale = new Vector3(1, 1, 1)\n  // if (options.fit === FIT.ALL) {\n  //   scale.setFromMatrixScale(root.matrixWorld)\n  // }\n  // return scale\n  const { scale } = root\n  return scale\n}\n\nconst _computeRadius = (function () {\n  const v = new Vector3()\n  const center = new Vector3()\n  return function (root, options, bounds) {\n    let maxRadiusSq = 0\n    let { x: cx, y: cy, z: cz } = bounds.getCenter(center)\n    _iterateGeometries(root, options, (geo, transform) => {\n      const components = geo.attributes.position.array\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i], components[i + 1], components[i + 2]).applyMatrix4(transform)\n        const dx = cx - v.x\n        const dy = cy - v.y\n        const dz = cz - v.z\n        maxRadiusSq = Math.max(maxRadiusSq, dx * dx + dy * dy + dz * dz)\n      }\n    })\n    return Math.sqrt(maxRadiusSq)\n  }\n})()\n\nconst _computeHalfExtents = function (root, bounds, minHalfExtent, maxHalfExtent) {\n  const halfExtents = new Vector3()\n  return halfExtents.subVectors(bounds.max, bounds.min).multiplyScalar(0.5).clampScalar(minHalfExtent, maxHalfExtent)\n}\n\nconst _computeLocalOffset = function (matrix, bounds, target) {\n  target.addVectors(bounds.max, bounds.min).multiplyScalar(0.5).applyMatrix4(matrix)\n  return target\n}\n\n// returns the bounding box for the geometries underneath `root`.\nconst _computeBounds = (function () {\n  const v = new Vector3()\n  return function (root, options) {\n    const bounds = new Box3()\n    let minX = +Infinity\n    let minY = +Infinity\n    let minZ = +Infinity\n    let maxX = -Infinity\n    let maxY = -Infinity\n    let maxZ = -Infinity\n    bounds.min.set(0, 0, 0)\n    bounds.max.set(0, 0, 0)\n    _iterateGeometries(root, options, (geo, transform) => {\n      const components = geo.attributes.position.array\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i], components[i + 1], components[i + 2]).applyMatrix4(transform)\n        if (v.x < minX) minX = v.x\n        if (v.y < minY) minY = v.y\n        if (v.z < minZ) minZ = v.z\n        if (v.x > maxX) maxX = v.x\n        if (v.y > maxY) maxY = v.y\n        if (v.z > maxZ) maxZ = v.z\n      }\n    })\n    bounds.min.set(minX, minY, minZ)\n    bounds.max.set(maxX, maxY, maxZ)\n    return bounds\n  }\n})()\n\n// adjusts the translate of the geometry\n// https://threejs.org/docs/#api/en/core/BufferGeometry.translate\nconst adjustGeometryTranslateEXPERIMENTAL = (geo, transform) => {\n  geo.computeBoundingBox()\n  const target = new Vector3()\n  geo.boundingBox.getCenter(target)\n  transform.makeTranslation(target.x, target.y, target.z)\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport { Quaternion } from '@enable3d/three-wrapper/dist/index'\n\n// https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=7228\nexport const addTorusShape = (config: { radius: number; tube: number; tubularSegments: number }, quat: Quaternion) => {\n  const { radius = 1, tube = 0.4, tubularSegments = 8 } = config\n\n  const SIMD_PI = Math.PI\n  const subdivisions = tubularSegments\n  const gap = Math.sqrt(2.0 * tube * tube - 2.0 * tube * tube * Math.cos((2.0 * SIMD_PI) / subdivisions))\n\n  const btHalfExtents = new Ammo.btVector3(tube, SIMD_PI / subdivisions + 0.5 * gap, tube)\n  const cylinderShape = new Ammo.btCylinderShape(btHalfExtents)\n  cylinderShape.setMargin(0.05)\n\n  const compoundShape = new Ammo.btCompoundShape()\n\n  const forward = new Ammo.btVector3(0, 0, 1)\n  const side = new Ammo.btVector3(0, radius, 0)\n  const rotation = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w)\n\n  for (let x = 0; x < subdivisions; x++) {\n    const angle = (x * 2.0 * SIMD_PI) / subdivisions\n    const position = side.rotate(forward, angle)\n    const transform = new Ammo.btTransform()\n    rotation.setRotation(forward, angle + Math.PI / 2)\n    transform.setIdentity()\n    transform.setOrigin(position)\n    transform.setRotation(rotation)\n    compoundShape.addChildShape(transform, cylinderShape)\n  }\n\n  return compoundShape\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport Physics from '../physics'\nimport { ExtendedObject3D } from '@enable3d/common/dist/types'\n\nexport default class ClosestRayResultCallback {\n  protected _tmpBtVector3: Ammo.btVector3\n  protected _btRayCallback: Ammo.ClosestRayResultCallback\n\n  constructor(protected physics: Physics) {}\n\n  getHitPointWorld(): { x: number; y: number; z: number } {\n    const h = this._btRayCallback.get_m_hitPointWorld() as Ammo.btVector3\n\n    const point = { x: h.x(), y: h.y(), z: h.z() }\n\n    return point\n  }\n\n  getCollisionObject(): ExtendedObject3D {\n    const getPtr = (obj: any) => {\n      return Object.values(obj)[0]\n    }\n\n    const ptr = getPtr(this._btRayCallback.get_m_collisionObject())\n    // @ts-ignore\n    return this.physics.objectsAmmo[ptr]\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport Physics from '../physics'\nimport { ExtendedObject3D } from '@enable3d/common/dist/types'\n\nexport default class AllHitsRayResultCallback {\n  protected _tmpBtVector3: Ammo.btVector3\n  protected _btRayCallback: Ammo.AllHitsRayResultCallback\n\n  constructor(protected physics: Physics) {}\n\n  getHitPointWorld(): { x: number; y: number; z: number }[] {\n    const h = this._btRayCallback.get_m_hitPointWorld() as Ammo.btVector3Array\n\n    const points = []\n    for (let i = h.size() - 1; i >= 0; i--) {\n      const hh = h.at(i)\n      points.push({ x: hh.x(), y: hh.y(), z: hh.z() })\n    }\n\n    return points\n  }\n\n  getCollisionObjects(): ExtendedObject3D[] {\n    const getPtr = (obj: any) => {\n      return Object.values(obj)[0]\n    }\n\n    const obs = []\n    // @ts-ignore\n    const o = this._btRayCallback.get_m_collisionObjects()\n    for (let i = o.size() - 1; i >= 0; i--) {\n      const ptr = getPtr(o.at(i))\n      // @ts-ignore\n      obs.push(this.physics.objectsAmmo[ptr])\n    }\n    return obs\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport Physics from '../physics'\nimport applyMixins from '@enable3d/common/dist/applyMixins'\nimport ClosestRayResultCallback from './closestRayResultCallback'\nimport AllHitsRayResultCallback from './allHitsRayResultCallback'\n\nclass Raycaster {\n  protected _tmpBtVector3: Ammo.btVector3\n  protected _btRayFrom: Ammo.btVector3\n  protected _btRayTo: Ammo.btVector3\n  protected _btRayCallback: any\n  protected initCallback: any\n\n  constructor(protected physics: Physics) {}\n\n  setRayFromWorld(x = 0, y = 0, z = 0) {\n    this._btRayFrom.setValue(x, y, z)\n    this._btRayCallback.set_m_rayFromWorld(this._btRayFrom)\n  }\n\n  setRayToWorld(x = 0, y = 0, z = 0) {\n    this._btRayTo.setValue(x, y, z)\n    this._btRayCallback.set_m_rayToWorld(this._btRayTo)\n  }\n\n  hasHit() {\n    return this._btRayCallback.hasHit()\n  }\n\n  rayTest() {\n    this.physics.physicsWorld.rayTest(this._btRayFrom, this._btRayTo, this._btRayCallback)\n  }\n\n  destroy() {\n    Ammo.destroy(this._tmpBtVector3)\n    Ammo.destroy(this._btRayFrom)\n    Ammo.destroy(this._btRayTo)\n    Ammo.destroy(this._btRayCallback)\n  }\n}\n\ninterface ClosestRaycaster extends Raycaster, ClosestRayResultCallback {}\ninterface AllHitsRaycaster extends Raycaster, AllHitsRayResultCallback {}\n\nclass ClosestRaycaster {\n  protected _tmpBtVector3: Ammo.btVector3 = new Ammo.btVector3(0, 0, 0)\n  protected _btRayFrom = new Ammo.btVector3(0, 0, 0)\n  protected _btRayTo = new Ammo.btVector3(0, 0, 0)\n\n  protected _btRayCallback: Ammo.ClosestRayResultCallback = new Ammo.ClosestRayResultCallback(\n    this._tmpBtVector3,\n    this._tmpBtVector3\n  )\n\n  constructor(protected physics: Physics) {}\n}\n\nclass AllHitsRaycaster {\n  protected _tmpBtVector3: Ammo.btVector3 = new Ammo.btVector3(0, 0, 0)\n  protected _btRayFrom = new Ammo.btVector3(0, 0, 0)\n  protected _btRayTo = new Ammo.btVector3(0, 0, 0)\n\n  protected _btRayCallback: Ammo.AllHitsRayResultCallback = new Ammo.AllHitsRayResultCallback(\n    this._tmpBtVector3,\n    this._tmpBtVector3\n  )\n\n  constructor(protected physics: Physics) {}\n}\n\napplyMixins(ClosestRaycaster, [Raycaster, ClosestRayResultCallback])\napplyMixins(AllHitsRaycaster, [Raycaster, AllHitsRayResultCallback])\n\nexport { ClosestRaycaster, AllHitsRaycaster }\n","/**\n * @author yandeu\n * @description Ported to TypeScript\n */\n\n/**\n * @author alteredq / http://alteredqualia.com/\n */\n\n/**\n * This is the Clock class THREE provides.\n */\nclass Clock {\n  autoStart: boolean\n  startTime: number\n  oldTime: number\n  elapsedTime: number\n  running: boolean\n\n  constructor(autoStart = true) {\n    this.autoStart = autoStart !== undefined ? autoStart : true\n    this.startTime = 0\n    this.oldTime = 0\n    this.elapsedTime = 0\n    this.running = false\n  }\n\n  start() {\n    this.startTime = (typeof performance === 'undefined' ? Date : performance).now() // see #10732\n\n    this.oldTime = this.startTime\n    this.elapsedTime = 0\n    this.running = true\n  }\n\n  stop() {\n    this.getElapsedTime()\n    this.running = false\n    this.autoStart = false\n  }\n\n  getElapsedTime() {\n    this.getDelta()\n    return this.elapsedTime\n  }\n\n  getDelta() {\n    let diff = 0\n\n    if (this.autoStart && !this.running) {\n      this.start()\n      return 0\n    }\n\n    if (this.running) {\n      let newTime = (typeof performance === 'undefined' ? Date : performance).now()\n\n      diff = (newTime - this.oldTime) / 1000\n      this.oldTime = newTime\n\n      this.elapsedTime += diff\n    }\n\n    return diff\n  }\n}\n\nexport { Clock }\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport logger from '@enable3d/common/dist/logger'\nimport PhysicsBody from '@enable3d/common/dist/physicsBody'\nimport {\n  PlaneConfig,\n  SphereConfig,\n  GroundConfig,\n  MaterialConfig,\n  BoxConfig,\n  CylinderConfig,\n  ConeConfig,\n  ExtrudeConfig,\n  Phaser3DConfig,\n  AddExistingConfig,\n  TorusConfig\n} from '@enable3d/common/dist/types'\nimport applyMixins from '@enable3d/common/dist/applyMixins'\nimport ExtendedObject3D from '@enable3d/common/dist/extendedObject3D'\nimport Shapes from './shapes'\nimport Constraints from './constraints'\nimport Events from './events'\nimport EventEmitter from 'eventemitter3'\nimport Physics from './physics'\nimport { Vector3, Quaternion, Scene, Mesh, Euler } from '@enable3d/three-wrapper/dist/index'\nimport { createCollisionShapes } from './three-to-ammo'\nimport { addTorusShape } from './torusShape'\nimport Factories from '@enable3d/common/dist/factories'\nimport { REVISION } from '@enable3d/three-wrapper/dist/index'\n\nimport { PhysicsLoader } from '@enable3d/common/dist/physicsLoader'\nimport DefaultMaterial from '@enable3d/common/dist/defaultMaterial'\nexport { PhysicsLoader }\n\nimport * as Types from '@enable3d/common/dist/types'\nimport { ClosestRaycaster, AllHitsRaycaster } from './raycaster/raycaster'\nexport { ClosestRaycaster, AllHitsRaycaster }\nexport { Types }\n\n// Export THREE.Clock\nexport { Clock } from './lib/Clock'\nexport { ServerClock } from '@enable3d/common/dist/serverClock'\n\ninterface AmmoPhysics extends Physics, Constraints, Shapes, Events {}\n\nclass AmmoPhysics extends EventEmitter {\n  public tmpTrans: Ammo.btTransform\n  public factory: Factories\n  public isHeadless: boolean\n\n  protected rigidBodies: ExtendedObject3D[] = []\n  protected objectsAmmo: { [ptr: number]: any } = {}\n  protected earlierDetectedCollisions: { combinedName: string; collision: boolean }[] = []\n  protected gravity: { x: number; y: number; z: number }\n\n  protected tmpEuler: Euler\n  protected tmpQuaternion: Quaternion\n  protected tmpVector3: Vector3\n  protected tmpBtVector3: Ammo.btVector3\n  protected tmpBtQuaternion: Ammo.btQuaternion\n\n  protected defaultMaterial: DefaultMaterial\n\n  constructor(public scene: Scene | 'headless', public config: Phaser3DConfig = {}) {\n    super()\n\n    this.isHeadless = scene === 'headless' ? true : false\n    this.tmpEuler = new Euler()\n    this.tmpQuaternion = new Quaternion()\n    this.tmpVector3 = new Vector3()\n    this.tmpBtVector3 = new Ammo.btVector3()\n    this.tmpBtQuaternion = new Ammo.btQuaternion(0, 0, 0, 1)\n\n    if (scene !== 'headless') {\n      this.defaultMaterial = new DefaultMaterial()\n\n      const version = `three.js version ${REVISION}`\n      console.log(\n        `%c %c %c %c %c ${version} %c https://threejs.org/`,\n        'background: #ff0000',\n        'background: #ffff00',\n        'background: #00ff00',\n        'background: #00ffff',\n        'color: #fff; background: #000000;',\n        'background: none'\n      )\n    }\n\n    this.factory = new Factories(scene)\n\n    this.emptyV3 = new Vector3()\n    this.impactPoint = new Vector3()\n    this.impactNormal = new Vector3()\n\n    this.gravity = config.gravity || { x: 0, y: -9.81, z: 0 }\n\n    this.start()\n  }\n\n  public get debug() {\n    if (this.isHeadless) return null\n\n    return {\n      enable: () => {\n        this.debugDrawer.enable()\n      },\n      mode: (debugMode: number = 1) => {\n        this.debugDrawer.setDebugMode(debugMode)\n      },\n      disable: () => {\n        this.debugDrawer.disable()\n      }\n    }\n  }\n\n  private start() {\n    if (typeof Ammo === 'undefined') {\n      logger('Are you sure you included ammo.js?')\n      return\n    }\n\n    if (typeof Ammo === 'function')\n      Ammo().then(() => {\n        this.setup()\n      })\n    else this.setup()\n  }\n\n  public get add() {\n    return {\n      collider: (\n        object1: ExtendedObject3D,\n        object2: ExtendedObject3D,\n        eventCallback: (event: 'start' | 'collision' | 'end') => void\n      ) => this.addCollider(object1, object2, eventCallback),\n      constraints: this.addConstraints,\n      existing: (object: ExtendedObject3D, config?: AddExistingConfig) => this.addExisting(object, config),\n      plane: (planeConfig: PlaneConfig = {}, materialConfig: MaterialConfig = {}) =>\n        this.addPlane(planeConfig, materialConfig),\n      sphere: (sphereConfig: SphereConfig = {}, materialConfig: MaterialConfig = {}) =>\n        this.addSphere(sphereConfig, materialConfig),\n      ground: (groundConfig: GroundConfig = {}, materialConfig: MaterialConfig = {}) =>\n        this.addGround(groundConfig, materialConfig),\n      box: (boxConfig: BoxConfig = {}, materialConfig: MaterialConfig = {}) => this.addBox(boxConfig, materialConfig),\n      cylinder: (cylinderConfig: CylinderConfig = {}, materialConfig: MaterialConfig = {}) =>\n        this.addCylinder(cylinderConfig, materialConfig),\n      cone: (coneConfig: ConeConfig = {}, materialConfig: MaterialConfig = {}) =>\n        this.addCone(coneConfig, materialConfig),\n      torus: (torusConfig: TorusConfig = {}, materialConfig: MaterialConfig = {}) =>\n        this.addTorus(torusConfig, materialConfig),\n      extrude: (extrudeConfig: ExtrudeConfig, materialConfig: MaterialConfig = {}) =>\n        this.addExtrude(extrudeConfig, materialConfig),\n      /**\n       * Creates a new Raycaster\n       * @param type Returns only the closes body by default. Can be 'closest' or 'allHits'.\n       */\n      raycaster: (type = 'closest') => {\n        if (type === 'closest') return new ClosestRaycaster(this) as ClosestRaycaster\n        else return new AllHitsRaycaster(this) as AllHitsRaycaster\n      }\n    }\n  }\n\n  public addCompoundShape(shapes: any) {\n    const compoundShape = new Ammo.btCompoundShape()\n    shapes.forEach((obj: any, i: number) => {\n      const transform = new Ammo.btTransform()\n\n      const pos = new Vector3(obj.x || 0, obj.y || 0, obj.z || 0)\n      if (obj.tmp?.offset) {\n        const o = obj.tmp.offset\n        pos.add(new Vector3(o.x, o.y, o.z))\n      }\n      transform.setIdentity()\n      transform.setOrigin(new Ammo.btVector3(pos.x || 0, pos.y || 0, pos.z || 0))\n      // TODO add rotation\n      // transform.setRotation(new Ammo.btQuaternion(quat.x || 0, quat.y || 0, quat.z || 0, quat.w || 1))\n      compoundShape.addChildShape(transform, shapes[i])\n    })\n    return compoundShape\n  }\n\n  protected addExisting(object: ExtendedObject3D, config: AddExistingConfig = {}): any {\n    const { position: pos, quaternion: quat, hasBody } = object\n\n    const {\n      mass = 1,\n      autoCenter = false,\n      offset = undefined,\n      shapes = [],\n      breakable = false,\n      addRigidBody = true,\n      addChildren = true\n    } = config\n\n    const defaultParams = {\n      width: 1,\n      height: 1,\n      depth: 1,\n      radius: 1,\n      radiusTop: 1, // for the cylinder\n      radiusBottom: 1, // for the cylinder\n      tube: 0.4, // for the torus\n      tubularSegments: 6 // for the torus\n    }\n\n    // check if the object has children\n    const children: any[] = []\n    if (addChildren && object.children.length >= 1) {\n      object.children.forEach((child: any) => {\n        if (child.isMesh) {\n          const shape = this.addExisting(child, { addRigidBody: false })\n          shape.tmp = { offset: child.position.clone() }\n          children.push(shape)\n        }\n      })\n    }\n\n    let shape = 'box'\n    const type = object.geometry?.type || 'box'\n    // retrieve the shape from the geometry\n    if (/box/i.test(type)) shape = 'box'\n    else if (/cone/i.test(type)) shape = 'cone'\n    else if (/cylinder/i.test(type)) shape = 'cylinder'\n    else if (/extrude/i.test(type)) shape = 'extrude'\n    else if (/plane/i.test(type)) shape = 'plane'\n    else if (/sphere/i.test(type)) shape = 'sphere'\n    else if (/torus/i.test(type)) shape = 'torus'\n\n    let params = {}\n    if (config.shape) {\n      params = { ...defaultParams, ...config }\n      shape = config.shape\n    } else if (object.shape) {\n      // @ts-ignore\n      params = { ...defaultParams, ...object?.geometry?.parameters }\n      shape = object.shape\n    } else {\n      // @ts-ignore\n      params = { ...defaultParams, ...object?.geometry?.parameters }\n    }\n\n    // Add default params if undefined\n    Object.keys(params).forEach(key => {\n      // @ts-ignore\n      if (typeof params[key] === 'undefined' && defaultParams[key]) {\n        // @ts-ignore\n        params[key] = defaultParams[key]\n      }\n    })\n\n    if (hasBody) {\n      logger(`Object \"${object.name}\" already has a physical body!`)\n      return\n    }\n\n    // auto adjust the center for custom shapes\n    if (autoCenter) object.geometry.center()\n\n    // some aliases\n    if (shape === 'extrude') shape = 'hacd'\n    if (shape === 'mesh' || shape === 'convex') shape = 'convexMesh'\n    if (shape === 'concave') shape = 'concaveMesh'\n\n    let Shape: any\n\n    // combine multiple shapes to one compound shape\n    if (shapes.length > 0) {\n      const tmp: any[] = [] // stores all the raw shapes\n\n      shapes.forEach(obj => {\n        const s = this.addShape({ shape: obj.shape, params: { ...obj } })\n        // @ts-ignore\n        s.tmp = { offset: { x: obj.x || 0, y: obj.y || 0, z: obj.z || 0 } }\n        // TODO add rotation as well\n        tmp.push(s)\n      })\n\n      Shape = this.addCompoundShape(tmp)\n    } else {\n      Shape = this.addShape({ shape, shapes, params, object, quat })\n    }\n\n    if (!Shape) {\n      logger(`Could not recognize shape \"${shape}\"!`)\n      return\n    }\n\n    if (children.length >= 1) {\n      Shape = this.addCompoundShape([Shape, ...children])\n    }\n\n    Shape.setMargin(0.05)\n\n    if (!addRigidBody) return Shape\n\n    this.addRigidBodyToShape(object, Shape, { mass, pos, quat, breakable, offset, config })\n  }\n\n  public addRigidBodyToShape(object: any, Shape: any, options: any) {\n    const {\n      mass = 1,\n      pos = new Vector3(0, 0, 0),\n      quat = new Quaternion(0, 0, 0, 1),\n      breakable = false,\n      offset = { x: 0, y: 0, z: 0 },\n      config = {}\n    } = options\n    this.addRigidBody(object, Shape, mass, pos, quat)\n    this.addBodyProperties(object, config)\n\n    if (breakable) object.body.breakable = true\n    if (offset) object.body.offset = { x: 0, y: 0, z: 0, ...offset }\n  }\n\n  private addShape(opts: any) {\n    const { shape, object, params, quat } = opts\n\n    let Shape\n    switch (shape) {\n      case 'plane':\n        Shape = createCollisionShapes(object, { type: 'mesh', concave: false })\n        break\n      case 'box':\n        Shape = new Ammo.btBoxShape(new Ammo.btVector3(params.width / 2, params.height / 2, params.depth / 2))\n        break\n      case 'sphere':\n        Shape = new Ammo.btSphereShape(params.radius)\n        break\n      case 'cylinder':\n        Shape = new Ammo.btCylinderShape(new Ammo.btVector3(params.radiusTop, params.height / 2, 0))\n        break\n      case 'cone':\n        Shape = new Ammo.btConeShape(params.radius, params.height)\n        break\n      case 'torus':\n        Shape = addTorusShape(params, quat)\n        break\n      case 'capsule':\n        Shape = new Ammo.btCapsuleShape(params.radius, params.height)\n        break\n      case 'hull':\n        Shape = createCollisionShapes(object, { type: 'hull' })\n        break\n      case 'hacd':\n        Shape = createCollisionShapes(object, { type: 'hacd' })\n        break\n      case 'vhacd':\n        Shape = createCollisionShapes(object, { type: 'vhacd' })\n        break\n      case 'convexMesh':\n        Shape = createCollisionShapes(object, { type: 'mesh', concave: false })\n        break\n      case 'concaveMesh':\n        Shape = createCollisionShapes(object, { type: 'mesh', concave: true })\n        break\n    }\n\n    if (Array.isArray(Shape)) {\n      const compoundShape = new Ammo.btCompoundShape()\n      Shape.forEach(shape => {\n        const transform = new Ammo.btTransform()\n        transform.setIdentity()\n        compoundShape.addChildShape(transform, shape)\n      })\n      Shape = compoundShape\n    }\n\n    return Shape\n  }\n\n  protected createRigidBody(physicsShape: any, mass: number, pos: Vector3, quat: Quaternion) {\n    const transform = new Ammo.btTransform()\n    transform.setIdentity()\n    transform.setOrigin(new Ammo.btVector3(pos.x, pos.y, pos.z))\n    transform.setRotation(new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w))\n    const motionState = new Ammo.btDefaultMotionState(transform)\n    const localInertia = new Ammo.btVector3(0, 0, 0)\n    if (mass > 0) {\n      physicsShape.calculateLocalInertia(mass, localInertia)\n    }\n    const rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, motionState, physicsShape, localInertia)\n    const rigidBody = new Ammo.btRigidBody(rbInfo)\n    return rigidBody\n  }\n\n  protected addRigidBody(\n    threeObject: ExtendedObject3D,\n    physicsShape: any,\n    mass: number,\n    pos: Vector3,\n    quat: Quaternion,\n    scale?: { x: number; y: number; z: number }\n  ) {\n    threeObject.position.copy(pos)\n    threeObject.quaternion.copy(quat)\n\n    const rigidBody = this.createRigidBody(physicsShape, mass, pos, quat)\n\n    if (scale) {\n      const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z)\n      physicsShape.setLocalScaling(localScale)\n      Ammo.destroy(localScale)\n    }\n\n    if (mass > 0) {\n      // Disable deactivation\n      rigidBody.setActivationState(4)\n    }\n\n    this.rigidBodies.push(threeObject)\n    this.physicsWorld.addRigidBody(rigidBody)\n\n    const ptr = Object.values(rigidBody)[0]\n    // @ts-ignore\n    rigidBody.name = threeObject.name\n    threeObject.body = new PhysicsBody(this, rigidBody)\n    threeObject.hasBody = true\n    // @ts-ignore\n    threeObject.ptr = ptr\n    this.objectsAmmo[ptr] = threeObject\n  }\n\n  protected addBodyProperties(obj: ExtendedObject3D, config: any) {\n    const { friction = 0.5, collisionFlags = 0 } = config\n    obj.body.setCollisionFlags(collisionFlags)\n    obj.body.setFriction(friction)\n  }\n}\n\napplyMixins(AmmoPhysics, [Physics, Constraints, Shapes, Events])\n\nexport { AmmoPhysics }\n","/**\n * To create the UMD bundle\n */\nexport * from './index'\n\n// import * as THREE from '@enable3d/three-wrapper/dist/index'\n// export { THREE }\n"],"sourceRoot":""}